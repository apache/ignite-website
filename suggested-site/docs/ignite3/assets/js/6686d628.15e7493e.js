"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2233],{28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>c});var r=n(96540);const i={},s=r.createContext(i);function o(e){const t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:t},e.children)}},92188:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"configure-and-operate/configuration/metrics-configuration","title":"Configuring Metrics","description":"Metric management is performed through the Ignite CLI tool.","source":"@site/docs/configure-and-operate/configuration/metrics.md","sourceDirName":"configure-and-operate/configuration","slug":"/configure-and-operate/configuration/metrics-configuration","permalink":"/docs/ignite3/3.1.0/configure-and-operate/configuration/metrics-configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ignite-3/tree/main/docs/docs/configure-and-operate/configuration/metrics.md","tags":[],"version":"current","frontMatter":{"id":"metrics-configuration","title":"Configuring Metrics","sidebar_label":"Metrics"},"sidebar":"tutorialSidebar","previous":{"title":"SSL/TLS","permalink":"/docs/ignite3/3.1.0/configure-and-operate/configuration/config-ssl-tls"},"next":{"title":"Cluster Security","permalink":"/docs/ignite3/3.1.0/configure-and-operate/configuration/config-cluster-security"}}');var i=n(74848),s=n(28453);const o={id:"metrics-configuration",title:"Configuring Metrics",sidebar_label:"Metrics"},c=void 0,l={},d=[{value:"Listing Metric Sources",id:"listing-metric-sources",level:2},{value:"Listing Metrics",id:"listing-metrics",level:2},{value:"Enabling Metric Sources",id:"enabling-metric-sources",level:2},{value:"Disabling Metric Sources",id:"disabling-metric-sources",level:2},{value:"Configuring Metrics Exporters",id:"configuring-metrics-exporters",level:2},{value:"JMX",id:"jmx",level:3},{value:"Log Exporter",id:"log-exporter",level:3},{value:"OpenTelemetry",id:"opentelemetry",level:3},{value:"Connection to Grafana",id:"connection-to-grafana",level:4},{value:"Connection to Prometheus",id:"connection-to-prometheus",level:4}];function a(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["Metric management is performed through the ",(0,i.jsx)(t.a,{href:"/3.1.0/tools/cli-commands",children:"Ignite CLI tool"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"listing-metric-sources",children:"Listing Metric Sources"}),"\n",(0,i.jsx)(t.p,{children:"You can list all available metric sources for a node or for the entire cluster."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"node metric source list\ncluster metric source list\n"})}),"\n",(0,i.jsx)(t.h2,{id:"listing-metrics",children:"Listing Metrics"}),"\n",(0,i.jsx)(t.p,{children:"You can list all metrics for a node."}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsxs)(t.p,{children:["To see the list of metrics, you need to enable the relevant metric sources, see ",(0,i.jsx)(t.a,{href:"#enabling-metric-sources",children:"Enabling Metric Sources"}),"."]})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"node metric list\n"})}),"\n",(0,i.jsx)(t.p,{children:"The above command returns the list of all currently available metrics organized with their exporters."}),"\n",(0,i.jsx)(t.h2,{id:"enabling-metric-sources",children:"Enabling Metric Sources"}),"\n",(0,i.jsx)(t.p,{children:"Metric collection might affect the performance of an application. Therefore, by default, all metric sources are disabled."}),"\n",(0,i.jsx)(t.p,{children:"Metric sources can be enabled:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["On per-node basis: you can specify the node to interact with by using the ",(0,i.jsx)(t.code,{children:"-u"})," parameter to specify node URL or ",(0,i.jsx)(t.code,{children:"-n"})," parameter to specify node name."]}),"\n",(0,i.jsx)(t.li,{children:"For the entire cluster."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"For example:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"node metric source enable -n=defaultNode jvm\ncluster metric source enable jvm\n"})}),"\n",(0,i.jsx)(t.h2,{id:"disabling-metric-sources",children:"Disabling Metric Sources"}),"\n",(0,i.jsx)(t.p,{children:"Metric sources can be disabled:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["On per-node basis: you can specify the node to interact with by using the ",(0,i.jsx)(t.code,{children:"-u"})," parameter to specify node URL or ",(0,i.jsx)(t.code,{children:"-n"})," parameter to specify node name."]}),"\n",(0,i.jsx)(t.li,{children:"For the entire cluster."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"For example:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"node metric source disable -n=defaultNode jvm\ncluster metric source disable jvm\n"})}),"\n",(0,i.jsx)(t.h2,{id:"configuring-metrics-exporters",children:"Configuring Metrics Exporters"}),"\n",(0,i.jsx)(t.p,{children:"To access the collected metrics with external tools, you need to configure metrics exporters."}),"\n",(0,i.jsx)(t.h3,{id:"jmx",children:"JMX"}),"\n",(0,i.jsx)(t.p,{children:"The JMX exporter provides information about Ignite nodes in JMX(Java Management Extensions) format. When the exporter is enabled, the node exposes the metrics to monitoring tools."}),"\n",(0,i.jsx)(t.p,{children:"You can enable the JMX exporter in the following way:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"cluster config update ignite.metrics.exporters.myJmxExporter.exporterName=jmx\n"})}),"\n",(0,i.jsx)(t.p,{children:"After you do, JMX monitoring tools will be able to collect enabled metrics from the specified nodes."}),"\n",(0,i.jsx)(t.p,{children:"You can also open internal JDK modules required for JMX, enable the remote JMX agent, configure the connection port, authentication, and SSL. Add the following JVM options to your Ignite node configuration:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"--add-opens=jdk.management/com.sun.management.internal=ALL-UNNAMED\n\n-Dcom.sun.management.jmxremote\n-Dcom.sun.management.jmxremote.port=<PORT_NUMBER>\n-Dcom.sun.management.jmxremote.authenticate=true|false\n-Dcom.sun.management.jmxremote.ssl=true|false\n"})}),"\n",(0,i.jsx)(t.h3,{id:"log-exporter",children:"Log Exporter"}),"\n",(0,i.jsx)(t.p,{children:"Log exporter writes metrics data to the application log, so they can be consumed by log collectors or inspected manually. To configure it, use the following parameters:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Name"}),(0,i.jsx)(t.th,{children:"Description"}),(0,i.jsx)(t.th,{children:"Default value"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"periodMillis"}),(0,i.jsx)(t.td,{children:"Export interval for the metrics, in milliseconds."}),(0,i.jsx)(t.td,{children:"30000"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"oneLinePerMetricSource"}),(0,i.jsx)(t.td,{children:"Define whether to print all metrics from one metric source on a single log line."}),(0,i.jsx)(t.td,{children:"true"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"enabledMetrics"}),(0,i.jsxs)(t.td,{children:["List of enabled metric sources. If this list is non-empty, only the listed metric sources will be printed, all others will be skipped. A wildcard can be used to match a prefix (for example, ",(0,i.jsx)(t.code,{children:"jvm.*"}),"). By default, the metrics of some background activities are printed."]}),(0,i.jsx)(t.td,{children:'"metastorage", "placement-driver", "resource.vacuum"'})]})]})]}),"\n",(0,i.jsxs)(t.p,{children:["To add log exporter to cluster exporters list, run the following command and define all the metrics to print in ",(0,i.jsx)(t.code,{children:"enabledMetrics"})," list:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'cluster config update ignite.metrics.exporters.logPush \'{"exporterName":"logPush","periodMillis":30000,"oneLinePerMetricSource":true,"enabledMetrics":[]}\'\n'})}),"\n",(0,i.jsx)(t.p,{children:"Updated exporters configuration should look like this:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-hocon",children:"exporters=[\n    {\n        enabledMetrics=[]\n        exporterName=logPush\n        name=logPush\n        oneLinePerMetricSource=true\n        periodMillis=30000\n    }\n]\n"})}),"\n",(0,i.jsx)(t.h3,{id:"opentelemetry",children:"OpenTelemetry"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.a,{href:"https://opentelemetry.io/",children:"OpenTelemetry"})," exporter connects to an OpenTelemetry service that is provided in configuration and sends cluster information to it. Each node sends metrics independently, and requires access to the specified endpoint."]}),"\n",(0,i.jsx)(t.p,{children:"The example below shows the basic OpenTelemetry configuration. As OpenTelemetry services require different URL formats and may require headers, this example may not work for your environment."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'cluster config update ignite.metrics.exporters.test: {exporterName:otlp, endpoint:"http://localhost:9090/api/v1/otlp/v1/metrics", protocol:"http/protobuf"}\n'})}),"\n",(0,i.jsx)(t.p,{children:"OpenTelemetry exporter created by this command will look like this:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-hocon",children:'{\n    compression=gzip\n    endpoint="http://localhost:9090/api/v1/otlp/v1/metrics"\n    exporterName=otlp\n    headers=[]\n    name=test\n    periodMillis=30000\n    protocol="http/protobuf"\n    ssl {\n        ciphers=""\n        clientAuth=none\n        enabled=false\n        keyStore {\n            password="********"\n            path=""\n            type=PKCS12\n        }\n        trustStore {\n            password="********"\n            path=""\n            type=PKCS12\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"Below are the descriptions of configuration parameters:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Name"}),(0,i.jsx)(t.th,{children:"Description"}),(0,i.jsx)(t.th,{children:"Default value"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"compression"}),(0,i.jsxs)(t.td,{children:["How the payload is compressed. Possible values: ",(0,i.jsx)(t.code,{children:"none"}),", ",(0,i.jsx)(t.code,{children:"gzip"}),"."]}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"gzip"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"endpoint"}),(0,i.jsx)(t.td,{children:"The OpenTelemetry endpoint. Each node resolves the endpoint individually."}),(0,i.jsx)(t.td,{})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"exporterName"}),(0,i.jsxs)(t.td,{children:["Exporter name. Must be ",(0,i.jsx)(t.code,{children:"otlp"})," to use OpenTelemetry."]}),(0,i.jsx)(t.td,{})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"headers"}),(0,i.jsx)(t.td,{children:"Request headers, if any."}),(0,i.jsx)(t.td,{})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"name"}),(0,i.jsx)(t.td,{children:"User-defined exporter name, used to refer to it in Ignite."}),(0,i.jsx)(t.td,{})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"periodMillis"}),(0,i.jsx)(t.td,{children:"Export interval for the metrics, in milliseconds."}),(0,i.jsx)(t.td,{children:"30000"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"protocol"}),(0,i.jsxs)(t.td,{children:["The protocol that is used to send OpenTelemetry data. Possible values: ",(0,i.jsx)(t.code,{children:"grpc"}),", ",(0,i.jsx)(t.code,{children:"http/protobuf"}),"."]}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"grpc"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ssl.ciphers"}),(0,i.jsx)(t.td,{children:"List of ciphers to enable, comma-separated. Empty for automatic cipher selection."}),(0,i.jsx)(t.td,{})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ssl.clientAuth"}),(0,i.jsx)(t.td,{children:"Whether the SSL client authentication is enabled and whether it is mandatory."}),(0,i.jsx)(t.td,{})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ssl.enabled"}),(0,i.jsx)(t.td,{children:"Defines if SSL is enabled."}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"false"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ssl.keyStore.password"}),(0,i.jsx)(t.td,{children:"SSL keystore password."}),(0,i.jsx)(t.td,{})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ssl.keyStore.path"}),(0,i.jsx)(t.td,{children:"Path to the SSL keystore."}),(0,i.jsx)(t.td,{})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ssl.keyStore.type"}),(0,i.jsx)(t.td,{children:"Keystore type."}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"PKCS12"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ssl.trustStore.password"}),(0,i.jsx)(t.td,{children:"Truststore password."}),(0,i.jsx)(t.td,{})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ssl.trustStore.path"}),(0,i.jsx)(t.td,{children:"Path to the truststore."}),(0,i.jsx)(t.td,{})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"ssl.trustStore.type"}),(0,i.jsx)(t.td,{children:"Truststore type."}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"PKCS12"})})]})]})]}),"\n",(0,i.jsx)(t.h4,{id:"connection-to-grafana",children:"Connection to Grafana"}),"\n",(0,i.jsx)(t.p,{children:"When connecting to Grafana Cloud, you need to use the protobuf protocol and pass the authorization header in the configuration:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:'cluster config update ignite.metrics.exporters.test: {exporterName:otlp, endpoint:"https://otlp-gateway-prod-eu-west-2.grafana.net/otlp", protocol:"http/protobuf", headers {Authorization.header="Basic myBasicAuthKey"}}\n'})}),"\n",(0,i.jsx)(t.h4,{id:"connection-to-prometheus",children:"Connection to Prometheus"}),"\n",(0,i.jsxs)(t.p,{children:["When connecting to Prometheus, you need to use the protobuf protocol and send metrics to the ",(0,i.jsx)(t.code,{children:"/api/v1/otlp/v1/metrics"})," after the OTLP metrics receiver is enabled as described in ",(0,i.jsx)(t.a,{href:"https://prometheus.io/docs/guides/opentelemetry/",children:"Prometheus documentation"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:'cluster config update ignite.metrics.exporters.test: {exporterName:otlp, endpoint:"http://localhost:9090/api/v1/otlp/v1/metrics", protocol:"http/protobuf"}\n'})})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);