"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[6946],{28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>o});var i=t(96540);const s={},a=i.createContext(s);function l(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(a.Provider,{value:n},e.children)}},45599:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"configure-and-operate/installation/install-kubernetes","title":"Install on Kubernetes","description":"You can install Apache Ignite 3 and run an Apache Ignite cluster on Kubernetes cluster. This section describes all the necessary steps, as well as provides the configurations and manifests that you can copy and paste into your environment.","source":"@site/docs/configure-and-operate/installation/kubernetes.md","sourceDirName":"configure-and-operate/installation","slug":"/configure-and-operate/installation/install-kubernetes","permalink":"/docs/ignite3/3.1.0/configure-and-operate/installation/install-kubernetes","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ignite-3/tree/main/docs/docs/configure-and-operate/installation/kubernetes.md","tags":[],"version":"current","frontMatter":{"id":"install-kubernetes","title":"Install on Kubernetes","sidebar_label":"Kubernetes"},"sidebar":"tutorialSidebar","previous":{"title":"Docker","permalink":"/docs/ignite3/3.1.0/configure-and-operate/installation/install-docker"},"next":{"title":"Configuration","permalink":"/docs/ignite3/3.1.0/configure-and-operate/configuration/"}}');var s=t(74848),a=t(28453);const l={id:"install-kubernetes",title:"Install on Kubernetes",sidebar_label:"Kubernetes"},o=void 0,r={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Recommended Kubernetes Version",id:"recommended-kubernetes-version",level:3},{value:"Installation Steps",id:"installation-steps",level:2},{value:"Create ConfigMaps",id:"create-configmaps",level:3},{value:"Create and Deploy the Service",id:"create-and-deploy-the-service",level:3},{value:"Deploy the StatefulSet",id:"deploy-the-statefulset",level:3},{value:"Wait for Pods to Start",id:"wait-for-pods-to-start",level:3},{value:"Deploy the Job",id:"deploy-the-job",level:3},{value:"Installation Verification",id:"installation-verification",level:2},{value:"Installation Troubleshooting",id:"installation-troubleshooting",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"You can install Apache Ignite 3 and run an Apache Ignite cluster on Kubernetes cluster. This section describes all the necessary steps, as well as provides the configurations and manifests that you can copy and paste into your environment."}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Using a Helm chart is recommended for production deployments, however, if you choose not to use Helm, this guide will walk you through installing Apache Ignite on Kubernetes manually."})}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.h3,{id:"recommended-kubernetes-version",children:"Recommended Kubernetes Version"}),"\n",(0,s.jsx)(n.p,{children:"Apache Ignite 3 requires Kubernetes 1.20 or later."}),"\n",(0,s.jsx)(n.h2,{id:"installation-steps",children:"Installation Steps"}),"\n",(0,s.jsx)(n.h3,{id:"create-configmaps",children:"Create ConfigMaps"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create the Apache Ignite configuration file. The minimum node configuration is as follows:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="ignite-config.conf"',children:'ignite: {\n  network: {\n    # Apache Ignite 3 node port\n    port = 3344\n    nodeFinder = {\n      netClusterNodes = [\n        # Kubernetes service to access the Apache Ignite 3 cluster on the Kubernetes network\n        "ignite-svc-headless:3344"\n      ]\n    }\n  }\n\n  storage: {\n    profiles = [\n      {\n        engine = "aipersist"\n        name = "default"\n        replacementMode = "CLOCK"\n        # Explicit storage size configuration\n        sizeBytes = 2147483648\n      }\n    ]\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"Create the ConfigMap object for Apache Ignite configuration:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"kubectl create configmap ignite-config -n <namespace> --from-file=ignite-config.conf\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Replace ",(0,s.jsx)(n.code,{children:"<namespace>"})," with the name of the namespace where you want to deploy Apache Ignite."]}),"\n",(0,s.jsxs)(n.admonition,{type:"note",children:[(0,s.jsxs)(n.p,{children:["In Kubernetes deployments, the ",(0,s.jsx)(n.code,{children:"ignite-config.conf"})," file is mounted as a read-only ConfigMap, so any attempt to update it with the ",(0,s.jsx)(n.code,{children:"node config update"})," command will fail."]}),(0,s.jsx)(n.p,{children:"To update Apache Ignite node configuration, modify the existing ConfigMap and restart all Apache Ignite pods."})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Modify previously configured ConfigMap object:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl edit configmap ignite-config -n <namespace>\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Restart Apache Ignite pod, repeat for every pod:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl delete pod <Apache Ignite pod name> -n <namespace>\n"})}),"\n",(0,s.jsx)(n.h3,{id:"create-and-deploy-the-service",children:"Create and Deploy the Service"}),"\n",(0,s.jsx)(n.p,{children:"Depending on your requirements, define and deploy a Kubernetes service. Apache Ignite 3 use two types of services: one for internal cluster discovery, and the other for external client access."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["First, choose a type of service you need and prepare the ",(0,s.jsx)(n.code,{children:"service.yaml"})," file."]}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For communication inside the Kubernetes cluster, Use a headless service by setting the ",(0,s.jsx)(n.code,{children:"clusterIP"})," parameter to ",(0,s.jsx)(n.code,{children:"None"}),". This will expose each pod's IP, enabling Apache Ignite to be partition-aware: clients discover every node's address, determine which partition resides on which node, and send requests directly where the data is located."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="service.yaml"',children:"apiVersion: v1\nkind: Service\nmetadata:\n  # The name must be equal to netClusterNodes.\n  name: ignite-svc-headless\n  # Place your namespace name here.\n  namespace: <namespace>\nspec:\n  clusterIP: None\n  internalTrafficPolicy: Cluster\n  ipFamilies:\n  - IPv4\n  ipFamilyPolicy: SingleStack\n  ports:\n  - name: management\n    port: 10300\n    protocol: TCP\n    targetPort: 10300\n  - name: rest\n    port: 10800\n    protocol: TCP\n    targetPort: 10800\n  - name: cluster\n    port: 3344\n    protocol: TCP\n    targetPort: 3344\n  selector:\n    # Must be equal to the label set for pods.\n    app: ignite\n  # Include not-yet-ready nodes.\n  publishNotReadyAddresses: True\n  sessionAffinity: None\n  type: ClusterIP\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Use a ",(0,s.jsx)(n.code,{children:"LoadBalancer"})," service to allow external clients to connect. Keep in mind, that with this option you giving up partition awareness."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If your environments does not support ",(0,s.jsx)(n.code,{children:"LoadBalancer"}),", you can use ",(0,s.jsx)(n.code,{children:"type: NodePort"})," instead. Refer to the Kubernetes ",(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/access-application-cluster/create-external-load-balancer/",children:"documentation"})," for details."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: ignite-loadbalancer\n  labels:\n    app: ignite\nspec:\n  type: LoadBalancer\n  selector:\n    app: ignite\n  ports:\n    - name: rest\n      protocol: TCP\n      port: 10800\n      targetPort: 10800\n    - name: client\n      port: 10300\n      protocol: TCP\n      targetPort: 10300\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["Then apply the ",(0,s.jsx)(n.code,{children:"service.yaml"})," file to set up this service:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f service.yaml\n"})}),"\n",(0,s.jsx)(n.h3,{id:"deploy-the-statefulset",children:"Deploy the StatefulSet"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Prepare the ",(0,s.jsx)(n.code,{children:"statefulset.yaml"})," file for StatefulSet deployment:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="statefulset.yaml"',children:'apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  # The cluster name.\n  name: ignite-cluster\n  # Place your namespace name.\n  namespace: <namespace>\nspec:\n  # The initial number of pods to be started by Kubernetes.\n  replicas: 2\n  # Kubernetes service to access the Ignite 3 cluster on the Kubernetes network.\n  serviceName: ignite-svc-headless\n  selector:\n    matchLabels:\n      app: ignite\n  template:\n    metadata:\n      labels:\n        app: ignite\n    spec:\n      terminationGracePeriodSeconds: 60000\n      containers:\n        # Custom pod name.\n      - name: ignite-node\n        # Limits and requests for the Ignite container.\n        resources:\n          limits:\n            cpu: "4"\n            memory: 4Gi\n          requests:\n            cpu: "4"\n            memory: 4Gi\n        env:\n          # Must be specified to ensure that Apache Ignite 3 cluster replicas are visible to each other.\n          - name: IGNITE_NODE_NAME\n            valueFrom:\n              fieldRef:\n                fieldPath: metadata.name\n          # Apache Ignite 3 working directory.\n          - name: IGNITE_WORK_DIR\n            value: /ai3-work\n        # Apache Ignite Docker image and its version.\n        image: apache/ignite3:{version}\n        ports:\n        - containerPort: 10300\n        - containerPort: 10800\n        - containerPort: 3344\n        volumeMounts:\n        # The config will be placed at this path in the container.\n        - mountPath: /opt/ignite/etc/ignite-config.conf\n          name: config-vol\n          subPath: ignite-config.conf\n        # Ignite 3 working directory.\n        - mountPath: /ai3-work\n          name: persistence\n      volumes:\n      - name: config-vol\n        configMap:\n          name: ignite-config\n  volumeClaimTemplates:\n  - apiVersion: v1\n    kind: PersistentVolumeClaim\n    metadata:\n      name: persistence\n    spec:\n      accessModes:\n      - ReadWriteOnce\n      resources:\n        requests:\n          storage: 10Gi # Provide enough space for your application data.\n      volumeMode: Filesystem\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["Apply the ",(0,s.jsx)(n.code,{children:"statefulset.yaml"})," file to deploy the main components of Apache Ignite 3:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f statefulset.yaml\n"})}),"\n",(0,s.jsx)(n.h3,{id:"wait-for-pods-to-start",children:"Wait for Pods to Start"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Monitor the status of the pods:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"kubectl get pods -n <namespace> -w\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["Ensure that all pods' ",(0,s.jsx)(n.code,{children:"STATUS"})," is ",(0,s.jsx)(n.code,{children:"Running"})," before proceeding."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"deploy-the-job",children:"Deploy the Job"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Prepare the ",(0,s.jsx)(n.code,{children:"job.yaml"})," file for deploying the job:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="job.yaml"',children:"apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: cluster-init\n  # Place your namespace name here.\n  namespace: <namespace>\nspec:\n  template:\n    spec:\n      containers:\n      # Command to init the cluster. URL and host must be the name of the service you created before. Port is 10300 as the management port.\n      - args:\n        - -ec\n        - |\n          apt update && apt-get install -y bind9-host\n          IGNITE_NODES=$(host -tsrv _cluster._tcp.ignite-svc-headless | grep 'SRV record' | awk '{print $8}' | awk -F. '{print $1}' | paste -sd ',')\n          /opt/ignite3cli/bin/ignite3 cluster init --name=ignite --url=http://ignite-svc-headless:10300\n        command:\n        - /bin/sh\n        # Specify the Docker image with the Apache Ignite 3 CLI and its version.\n        image: apache/ignite3:{version}\n        imagePullPolicy: IfNotPresent\n        name: cluster-init\n        resources: {}\n      restartPolicy: Never\n      terminationGracePeriodSeconds: 120\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["Apply the ",(0,s.jsx)(n.code,{children:"job.yaml"})," file to complete installation:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f job.yaml\n"})}),"\n",(0,s.jsx)(n.h2,{id:"installation-verification",children:"Installation Verification"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Check the status of all resources in your namespace:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"kubectl get all -n <namespace>\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["Ensure that all components are running as expected, without errors, and that the initialization job is in the ",(0,s.jsx)(n.code,{children:"Completed"})," status."]}),"\n",(0,s.jsx)(n.li,{children:"Verify that your cluster is initialized and running:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"kubectl exec -it ignite-cluster-0 bash -n <namespace>\n/opt/ignite3cli/bin/ignite3 cluster status\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The command output must include the name of your cluster and the number of nodes. The status must be ",(0,s.jsx)(n.code,{children:"ACTIVE"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"installation-troubleshooting",children:"Installation Troubleshooting"}),"\n",(0,s.jsx)(n.p,{children:"If any issues occur during the installation:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Check the logs of specific pods:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"kubectl logs <pod-name> -n <namespace>\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Review events in the namespace:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"kubectl get events -n <namespace>\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);