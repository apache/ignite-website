"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[4821],{11470:(e,t,n)=>{n.d(t,{A:()=>f});var r=n(96540),l=n(34164),a=n(17559),s=n(23104),i=n(56347),o=n(205),c=n(57485),u=n(31682),d=n(70679);function h(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function p(e){const{values:t,children:n}=e;return(0,r.useMemo)(()=>{const e=t??function(e){return h(e).map(({props:{value:e,label:t,attributes:n,default:r}})=>({value:e,label:t,attributes:n,default:r}))}(n);return function(e){const t=(0,u.XI)(e,(e,t)=>e.value===t.value);if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[t,n])}function b({value:e,tabValues:t}){return t.some(t=>t.value===e)}function m({queryString:e=!1,groupId:t}){const n=(0,i.W6)(),l=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,c.aZ)(l),(0,r.useCallback)(e=>{if(!l)return;const t=new URLSearchParams(n.location.search);t.set(l,e),n.replace({...n.location,search:t.toString()})},[l,n])]}function j(e){const{defaultValue:t,queryString:n=!1,groupId:l}=e,a=p(e),[s,i]=(0,r.useState)(()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!b({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const n=t.find(e=>e.default)??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:a})),[c,u]=m({queryString:n,groupId:l}),[h,j]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,l]=(0,d.Dv)(t);return[n,(0,r.useCallback)(e=>{t&&l.set(e)},[t,l])]}({groupId:l}),g=(()=>{const e=c??h;return b({value:e,tabValues:a})?e:null})();(0,o.A)(()=>{g&&i(g)},[g]);return{selectedValue:s,selectValue:(0,r.useCallback)(e=>{if(!b({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);i(e),u(e),j(e)},[u,j,a]),tabValues:a}}var g=n(92303);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var v=n(74848);function w({className:e,block:t,selectedValue:n,selectValue:r,tabValues:a}){const i=[],{blockElementScrollPositionUntilNextRender:o}=(0,s.a_)(),c=e=>{const t=e.currentTarget,l=i.indexOf(t),s=a[l].value;s!==n&&(o(t),r(s))},u=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=i.indexOf(e.currentTarget)+1;t=i[n]??i[0];break}case"ArrowLeft":{const n=i.indexOf(e.currentTarget)-1;t=i[n]??i[i.length-1];break}}t?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.A)("tabs",{"tabs--block":t},e),children:a.map(({value:e,label:t,attributes:r})=>(0,v.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{i.push(e)},onKeyDown:u,onClick:c,...r,className:(0,l.A)("tabs__item",x.tabItem,r?.className,{"tabs__item--active":n===e}),children:t??e},e))})}function y({lazy:e,children:t,selectedValue:n}){const a=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=a.find(e=>e.props.value===n);return e?(0,r.cloneElement)(e,{className:(0,l.A)("margin-top--md",e.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:a.map((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))})}function C(e){const t=j(e);return(0,v.jsxs)("div",{className:(0,l.A)(a.G.tabs.container,"tabs-container",x.tabList),children:[(0,v.jsx)(w,{...t,...e}),(0,v.jsx)(y,{...t,...e})]})}function f(e){const t=(0,g.A)();return(0,v.jsx)(C,{...e,children:h(e.children)},String(t))}},19365:(e,t,n)=>{n.d(t,{A:()=>s});n(96540);var r=n(34164);const l={tabItem:"tabItem_Ymn6"};var a=n(74848);function s({children:e,hidden:t,className:n}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,r.A)(l.tabItem,n),hidden:t,children:e})}},28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>i});var r=n(96540);const l={},a=r.createContext(l);function s(e){const t=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),r.createElement(a.Provider,{value:t},e.children)}},80767:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"develop/work-with-data/serialization","title":"Object Serialization","description":"Apache Ignite provides a way to serialize your java objects and types and send the data between servers and clients.","source":"@site/docs/develop/work-with-data/serialization.md","sourceDirName":"develop/work-with-data","slug":"/develop/work-with-data/serialization","permalink":"/suggested-site/docs/3.1.0/develop/work-with-data/serialization","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/ignite-3/tree/main/docs/docs/develop/work-with-data/serialization.md","tags":[],"version":"current","frontMatter":{"id":"serialization","title":"Object Serialization"},"sidebar":"tutorialSidebar","previous":{"title":"Distributed Computing","permalink":"/suggested-site/docs/3.1.0/develop/work-with-data/compute"},"next":{"title":"Code Deployment","permalink":"/suggested-site/docs/3.1.0/develop/work-with-data/code-deployment"}}');var l=n(74848),a=n(28453),s=n(11470),i=n(19365);const o={id:"serialization",title:"Object Serialization"},c=void 0,u={},d=[{value:"Native Types",id:"native-types",level:2},{value:"Tuples",id:"tuples",level:2},{value:"User Objects",id:"user-objects",level:2},{value:"Server-Side",id:"server-side",level:3},{value:"Client-Side",id:"client-side",level:3}];function h(e){const t={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.p,{children:"Apache Ignite provides a way to serialize your java objects and types and send the data between servers and clients."}),"\n",(0,l.jsx)(t.h2,{id:"native-types",children:"Native Types"}),"\n",(0,l.jsx)(t.p,{children:"Apache Ignite handles native type serialization automatically. For example, the following Compute job accepts an Integer and returns an Integer:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",children:"class IntegerComputeJob implements ComputeJob<Integer, Integer> {\n    @Override\n    public @Nullable CompletableFuture<Integer> executeAsync(\n        JobExecutionContext context, @Nullable Integer arg\n    ) {\n        return completedFuture(arg - 1);\n    }\n}\n"})}),"\n",(0,l.jsx)(t.p,{children:"Since both the argument and the result are native types and are serialized automatically, you do not need any additional code to handle the serialization:"}),"\n",(0,l.jsxs)(s.A,{children:[(0,l.jsx)(i.A,{value:"java",label:"Java",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",children:'try (IgniteClient client = IgniteClient.builder().addresses("address/to/cluster:port").build()) {\nInteger result = client.compute().execute(\nJobTarget.anyNode(client.clusterNodes()),\nJobDescriptor.builder(IntegerComputeJob.class).build(),\n1\n);\n}\n'})})}),(0,l.jsx)(i.A,{value:"dotnet",label:".NET",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:'using var client = await IgniteClient.StartAsync(\n    new IgniteClientConfiguration("address/to/cluster:port"));\n\nIJobExecution<int> jobExec = await client.Compute.SubmitAsync(\n    JobTarget.AnyNode(await client.GetClusterNodesAsync()),\n    new JobDescriptor<int, int>("org.example.IntegerComputeJob"),\n    1);\n\nint result = await jobExec.GetResultAsync();\n'})})})]}),"\n",(0,l.jsx)(t.h2,{id:"tuples",children:"Tuples"}),"\n",(0,l.jsx)(t.p,{children:"Apache Ignite is designed around working with Tuples, and handles tuple serialization automatically. For example, the following Job accepts Tuple and returns Tuple:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",children:'class TupleComputeJob implements ComputeJob<Tuple, Tuple> {\n    @Override\n    public @Nullable CompletableFuture<Tuple> executeAsync(JobExecutionContext context, @Nullable Tuple arg) {\n        Tuple resultTuple = Tuple.copy(arg);\n        resultTuple.set("col", "new value");\n\n        return completedFuture(resultTuple);\n    }\n}\n'})}),"\n",(0,l.jsx)(t.p,{children:"Since both the argument and the result are tuples, they are serialized automatically, and you do not need to handle serialization:"}),"\n",(0,l.jsxs)(s.A,{children:[(0,l.jsx)(i.A,{value:"java",label:"Java",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",children:'try (IgniteClient client = IgniteClient.builder().addresses("address/to/cluster:port").build()) {\nTuple resultTuple = client.compute().execute(\nJobTarget.anyNode(client.clusterNodes()),\nJobDescriptor.builder(TupleComputeJob.class).build(),\nTuple.create().set("col", "value")\n);\n}\n'})})}),(0,l.jsx)(i.A,{value:"dotnet",label:".NET",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:'using var client = await IgniteClient.StartAsync(\n    new IgniteClientConfiguration("address/to/cluster:port"));\n\nIJobExecution<IIgniteTuple> jobExec = await client.Compute.SubmitAsync(\n    JobTarget.AnyNode(await client.GetClusterNodesAsync()),\n    new JobDescriptor<IIgniteTuple, IIgniteTuple>("org.example.TupleComputeJob"),\n    new IgniteTuple { ["col"] = "value" });\n\nIIgniteTuple result = await jobExec.GetResultAsync();\n'})})})]}),"\n",(0,l.jsx)(t.h2,{id:"user-objects",children:"User Objects"}),"\n",(0,l.jsx)(t.p,{children:"User objects are marshalled automatically in the following way:"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:"If a custom marshaller is defined, it is used."}),"\n",(0,l.jsx)(t.li,{children:"If no marshaller is defined, user Java objects are marshalled to binary tuples."}),"\n",(0,l.jsx)(t.li,{children:"If there are nested objects, they are recursively marshalled to tuples."}),"\n"]}),"\n",(0,l.jsxs)(t.p,{children:["Below is an example of user objects marshalled with custom logic (using JSON serialization with ",(0,l.jsx)(t.code,{children:"ObjectMapper"}),", but you can do whatever you think is good for your use case)."]}),"\n",(0,l.jsx)(t.p,{children:"Let's start with Compute job definition that should be a part of the same deployment unit."}),"\n",(0,l.jsx)(t.h3,{id:"server-side",children:"Server-Side"}),"\n",(0,l.jsx)(t.p,{children:"The code below shows how to handle marshalling on a server, so that it can properly send the data to the clients and receive their responses:"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsx)(t.p,{children:"This is the custom object that we will be using as an argument the job:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",children:"class ArgumentCustomServerObject {\n    int arg1;\n    String arg2;\n}\n"})}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsxs)(t.p,{children:["We need to define a marshaller for it using the ",(0,l.jsx)(t.code,{children:"ObjectMapper"})," object:"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",children:"final ObjectMapper MAPPER = new ObjectMapper();\n\nclass ArgumentCustomServerObjectMarshaller implements Marshaller<ArgumentCustomServerObject, byte[]> {\n    @Override\n    public byte @Nullable [] marshal(@Nullable ArgumentCustomServerObject object) throws UnsupportedObjectTypeMarshallingException {\n        try {\n            return MAPPER.writeValueAsBytes(object);\n        } catch (JsonProcessingException e) {\n            throw new RuntimeException(e);\n        }\n    }\n\n    @Override\n    public @Nullable ArgumentCustomServerObject unmarshal(byte @Nullable [] raw) throws UnsupportedObjectTypeMarshallingException {\n        try {\n            return MAPPER.readValue(raw, ArgumentCustomServerObject.class);\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n"})}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsx)(t.p,{children:"Let's also create another object that will be used to store Compute job results, and the corresponding marshaller:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",children:"class ResultCustomServerObject {\n    int res1;\n    String res2;\n    long res3;\n}\n\nclass ResultCustomServerObjectMarshaller implements Marshaller<ResultCustomServerObject, byte[]> {\n    @Override\n    public byte @Nullable [] marshal(@Nullable ResultCustomServerObject object) throws UnsupportedObjectTypeMarshallingException {\n        try {\n            return MAPPER.writeValueAsBytes(object);\n        } catch (JsonProcessingException e) {\n            throw new RuntimeException(e);\n        }\n    }\n\n    @Override\n    public @Nullable ResultCustomServerObject unmarshal(byte @Nullable [] raw) throws UnsupportedObjectTypeMarshallingException {\n        try {\n            return MAPPER.readValue(raw, ResultCustomServerObject.class);\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(t.p,{children:["The marshallers above define how to represent corresponding objects as ",(0,l.jsx)(t.code,{children:"byte[]"}),", and how to read these objects from ",(0,l.jsx)(t.code,{children:"byte[]"}),". However, defining these classes does not enable custom serialization, as you need to specify the marshaller to use when serializing objects. In Apache Ignite, this is done by overriding two methods in  Compute job definition to use them as factory methods for marshallers:"]}),"\n",(0,l.jsx)(t.p,{children:"The code below provides an example of implementing marshallers in a compute job:"}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",children:"class PojoComputeJob implements ComputeJob<ArgumentCustomServerObject, ResultCustomServerObject> {\n\n    @Override\n    public @Nullable CompletableFuture<ResultCustomServerObject> executeAsync(\n        JobExecutionContext context,\n        @Nullable ArgumentCustomServerObject arg\n    ) {\n        ResultCustomServerObject res = new ResultCustomServerObject();\n        res.res1 = arg.arg1;\n        res.res2 = arg.arg2;\n        res.res3 = 1;\n\n        return completedFuture(res);\n    }\n\n    @Override\n    public Marshaller<ArgumentCustomServerObject, byte[]> inputMarshaller() {\n        return new ArgumentCustomServerObjectMarshaller();\n    }\n\n    @Override\n    public Marshaller<ResultCustomServerObject, byte[]> resultMarshaller() {\n        return new ResultCustomServerObjectMarshaller();\n    }\n}\n"})}),"\n",(0,l.jsx)(t.p,{children:"With this, the Apache Ignite server will be able to handle marshalling the required objects to sending them to clients, and unmarshalling the client responses."}),"\n",(0,l.jsx)(t.h3,{id:"client-side",children:"Client-Side"}),"\n",(0,l.jsx)(t.p,{children:"On the client side, largely the same code is required to handle the incoming objects and to marshal the response:"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsx)(t.p,{children:"Define the custom object that is used for compute job:"}),"\n",(0,l.jsxs)(s.A,{children:[(0,l.jsx)(i.A,{value:"java",label:"Java",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",children:"class ArgumentCustomClientObject {\nint arg1;\nString arg2;\n}\n"})})}),(0,l.jsx)(i.A,{value:"dotnet",label:".NET",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:"record ArgumentCustomClientObject(int arg1, string arg2);\n"})})})]}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsx)(t.p,{children:"Define the marshaller for the object:"}),"\n",(0,l.jsxs)(s.A,{children:[(0,l.jsx)(i.A,{value:"java",label:"Java",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",children:"final ObjectMapper MAPPER = new ObjectMapper();\n\nclass ArgumentCustomClientObjectMarshaller implements Marshaller<ArgumentCustomClientObject, byte[]> {\n@Override\npublic byte @Nullable [] marshal(@Nullable ArgumentCustomClientObject object) throws UnsupportedObjectTypeMarshallingException {\ntry {\nreturn MAPPER.writeValueAsBytes(object);\n} catch (JsonProcessingException e) {\nthrow new RuntimeException(e);\n}\n}\n\n    @Override\n    public @Nullable ArgumentCustomClientObject unmarshal(byte @Nullable [] raw) throws UnsupportedObjectTypeMarshallingException {\n        try {\n            return MAPPER.readValue(raw, ArgumentCustomClientObject.class);\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n"})})}),(0,l.jsx)(i.A,{value:"dotnet",label:".NET",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:"class MyJsonMarshaller<T> : IMarshaller<T>\n{\n    public void Marshal(T obj, IBufferWriter<byte> writer)\n    {\n        using var utf8JsonWriter = new Utf8JsonWriter(writer);\n        JsonSerializer.Serialize(utf8JsonWriter, obj);\n    }\n\n    public T Unmarshal(ReadOnlySpan<byte> bytes) =>\n        JsonSerializer.Deserialize<T>(bytes)!;\n}\n"})})})]}),"\n"]}),"\n",(0,l.jsxs)(t.li,{children:["\n",(0,l.jsx)(t.p,{children:"Do the same for the result object:"}),"\n",(0,l.jsxs)(s.A,{children:[(0,l.jsx)(i.A,{value:"java",label:"Java",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",children:"class ResultCustomClientObject {\nint res1;\nString res2;\nlong res3;\n}\n\n\nclass ResultCustomClientObjectMarshaller implements Marshaller<ResultCustomClientObject, byte[]> {\n@Override\npublic byte @Nullable [] marshal(@Nullable ResultCustomClientObject object) throws UnsupportedObjectTypeMarshallingException {\ntry {\nreturn MAPPER.writeValueAsBytes(object);\n} catch (JsonProcessingException e) {\nthrow new RuntimeException(e);\n}\n}\n\n    @Override\n    public @Nullable ResultCustomClientObject unmarshal(byte @Nullable [] raw) throws UnsupportedObjectTypeMarshallingException {\n        try {\n            return MAPPER.readValue(raw, ResultCustomClientObject.class);\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n\n// ....\n"})})}),(0,l.jsx)(i.A,{value:"dotnet",label:".NET",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:"record ResultCustomClientObject(int res1, string res2, long res3);\n\n// Use the same generic MyJsonMarshaller class (see above) for the result object.\n"})})})]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(t.p,{children:"Now that all marshallers are defined, you can start working with the custom objects and handle marshalling of arguments and results in your compute jobs:"}),"\n",(0,l.jsxs)(s.A,{children:[(0,l.jsx)(i.A,{value:"java",label:"Java",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",children:'try (IgniteClient client = IgniteClient.builder().addresses("address/to/cluster:port").build()) {\n// Marshalling example of pojo.\nResultCustomClientObject resultPojo = client.compute().execute(\nJobTarget.anyNode(client.clusterNodes()),\nJobDescriptor.<ArgumentCustomClientObject, ResultCustomClientObject>builder(PojoComputeJob.class.getName())\n.argumentMarshaller(new ArgumentCustomClientObjectMarshaller())\n.resultMarshaller(new ResultCustomClientObjectMarshaller())\n.build(),\nnew ArgumentCustomClientObject()\n);\n}\n'})})}),(0,l.jsx)(i.A,{value:"dotnet",label:".NET",children:(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-csharp",children:'using var client = await IgniteClient.StartAsync(\nnew IgniteClientConfiguration("address/to/cluster:port"));\n\nIJobExecution<ResultCustomClientObject> jobExec = await client.Compute.SubmitAsync(\nJobTarget.AnyNode(await client.GetClusterNodesAsync()),\nnew JobDescriptor<ArgumentCustomClientObject, ResultCustomClientObject>("org.example.PojoComputeJob")\n{\nArgMarshaller = new MyJsonMarshaller<ArgumentCustomClientObject>(),\nResultMarshaller = new MyJsonMarshaller<ResultCustomClientObject>()\n},\nnew ArgumentCustomClientObject(1, "abc"));\n\nResultCustomClientObject result = await jobExec.GetResultAsync();\n'})})})]})]})}function p(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}}}]);