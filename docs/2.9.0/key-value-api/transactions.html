<!DOCTYPE html>

      
      
<html lang="en">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-61232409-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-61232409-1');
    </script>

    

    <meta charset="UTF-8">
    <meta name="ignite-version" content="2.9.0" />
    <title>Performing Transactions | Ignite Documentation</title>
    
    <link rel="canonical" href="/docs/2.9.0/key-value-api/transactions" />
    
	
	<link rel="stylesheet" href="/assets/css/styles.css?1598892243">
    <link rel="stylesheet" href="/assets/css/asciidoc-pygments.css">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name='viewport' content='width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0'>

	<script type="text/javascript" src="/assets/js/anchor.min.js?1598892243"></script>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />


</head>
<body>
    <header>
    <div class="container">
        <button type='button' class='menu' title='Docs menu'>
        <img src="/assets/images/menu-icon.svg"/>
        </button>
        <div class='home'>
            <a href="/" class='home' title='Apache Ignite home'>
                <img src="/assets/images/apache_ignite_logo.svg" alt="Apache Ignite logo" width="103" >
            </a>
        </div>
        
        <nav>
            
        </nav>
        
        <select id="version-selector">
            <option value="2.9.0">2.9.0</option>
        </select>
        
        <a href="https://github.com/apache/ignite" title='GitHub' class='github' target="_blank">
            <img src="/assets/images/github-gray.svg" alt="GitHub logo">
        </a>
        
        <form class='search'>
            <button class="search-close" type='button'><img src='/assets/images/cancel.svg'></button>
            <input type="search" placeholder="Search…" id="search-input">
        </form>
        <button type='button' class='search-toggle'><img src='/assets/images/search.svg'></button>
        <button type='button' class='top-nav-toggle'>⋮</button>

        
        
    </div>
</header>


    	 <link rel="stylesheet" href="/assets/css/docs.css">
<section class='page-docs'>
    



<nav class='left-nav' data-swiftype-index='false'>

      
        <li>
            

            <a href="/docs/2.9.0/preface" class='' >Preface</a>
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="" class='group-toggle collapsed '>Quick Start Guides<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/quick-start/java"

                                class=''
                            >Java</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/quick-start/dotnet"

                                class=''
                            >.NET/C#</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/quick-start/cpp"

                                class=''
                            >C++</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/quick-start/python"

                                class=''
                            >Python</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/quick-start/nodejs"

                                class=''
                            >Node.JS</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/quick-start/sql"

                                class=''
                            >SQL</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/quick-start/php"

                                class=''
                            >PHP</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/quick-start/restapi"

                                class=''
                            >REST API</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="/installation" class='group-toggle collapsed '>Installation<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/installation/installing-using-zip"

                                class=''
                            >Installing Using ZIP Archive</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/installation/installing-using-docker"

                                class=''
                            >Installing Using Docker</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/installation/deb-rpm"

                                class=''
                            >Installing DEB or RPM package</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>Kubernetes<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
                            <nav class="sub_pages collapsed">

                            
                                  

								  <li><a href="/docs/2.9.0/installation/kubernetes/amazon-eks-deployment" class=''>Amazon EKS</a></li>
                            
                                  

								  <li><a href="/docs/2.9.0/installation/kubernetes/azure-deployment" class=''>Azure Kubernetes Service</a></li>
                            
                                  

								  <li><a href="/docs/2.9.0/installation/kubernetes/gke-deployment" class=''>Google Kubernetes Engine</a></li>
                            
                            </nav>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="" class='group-toggle collapsed '>Setting Up<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/setup"

                                class=''
                            >Setting Up Ignite for Java</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/setup-dotnet"

                                class=''
                            >Setting Up Ignite for .NET/C#</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/understanding-configuration" class='' >Understanding Configuration</a>
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/logging" class='' >Configuring Logging</a>
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/starting-nodes" class='' >Starting and Stopping Nodes</a>
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="" class='group-toggle collapsed '>Clustering<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/clustering/clustering"

                                class=''
                            >Overview</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/clustering/tcp-ip-discovery"

                                class=''
                            >TCP/IP Discovery</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/clustering/zookeeper-discovery"

                                class=''
                            >ZooKeeper Discovery</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/clustering/discovery-in-the-cloud"

                                class=''
                            >Discovery in the Cloud</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/clustering/network-configuration"

                                class=''
                            >Network Configuration</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/clustering/connect-client-nodes"

                                class=''
                            >Connecting Client Nodes</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/clustering/running-client-nodes-behind-nat"

                                class=''
                            >Running Client Nodes Behind NAT</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="" class='group-toggle collapsed '>Data Modeling<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/data-modeling/data-modeling"

                                class=''
                            >Introduction</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/data-modeling/data-partitioning"

                                class=''
                            >Data Partitioning</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/data-modeling/affinity-collocation"

                                class=''
                            >Affinity Colocation</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="" class='group-toggle collapsed '>Configuring Memory<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/memory-architecture"

                                class=''
                            >Memory Architecture</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/memory-configuration/data-regions"

                                class=''
                            >Configuring Data Regions</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/memory-configuration/eviction-policies"

                                class=''
                            >Eviction Policies</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="" class='group-toggle collapsed '>Configuring Caches<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/configuring-caches/configuration-overview"

                                class=''
                            >Cache Configuration</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/configuring-caches/configuring-backups"

                                class=''
                            >Configuring Partition Backups</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/configuring-caches/atomicity-modes"

                                class=''
                            >Atomicity Modes</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/configuring-caches/expiry-policies"

                                class=''
                            >Expiry Policy</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/configuring-caches/on-heap-caching"

                                class=''
                            >On-Heap Caching</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/configuring-caches/cache-groups"

                                class=''
                            >Cache Groups</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="" class='group-toggle collapsed '>Persistence<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/persistence/native-persistence"

                                class=''
                            >Ignite Persistence</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/persistence/external-storage"

                                class=''
                            >External Storage</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/persistence/swap"

                                class=''
                            >Swapping</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/persistence/custom-cache-store"

                                class=''
                            >Implementing Custom Cache Store</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/persistence/disk-compression"

                                class=''
                            >Disk Compression</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/persistence/persistence-tuning"

                                class=''
                            >Tuning Persistence</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/baseline-topology" class='' >Baseline Topology</a>
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/cluster-states" class='' >Cluster States</a>
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/data-rebalancing" class='' >Data Rebalancing</a>
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/partition-loss-policy" class='' >Partition Loss Policy</a>
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/peer-class-loading" class='' >Peer Class Loading</a>
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/data-streaming" class='' >Data Streaming</a>
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="" class='group-toggle collapsed '>Using Key-Value Cache API<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/key-value-api/basic-cache-operations"

                                class=''
                            >Basic Cache Operations</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/key-value-api/binary-objects"

                                class=''
                            >Working with Binary Objects</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/key-value-api/using-scan-queries"

                                class=''
                            >Using Scan Queries</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/key-value-api/continuous-queries" class='' >Using Continuous Queries</a>
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/key-value-api/transactions" class='active' >Performing Transactions</a>
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="" class='group-toggle collapsed '>Working with SQL<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/sql-introduction"

                                class=''
                            >Introduction</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/schemas"

                                class=''
                            >Understanding Schemas</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/indexes"

                                class=''
                            >Defining Indexes</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/sql-api"

                                class=''
                            >Using SQL API</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/distributed-joins"

                                class=''
                            >Distributed Joins</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/sql-transactions"

                                class=''
                            >SQL Transactions</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/custom-sql-func"

                                class=''
                            >Custom SQL Functions</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/JDBC/jdbc-driver"

                                class=''
                            >JDBC Driver</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/JDBC/jdbc-client-driver"

                                class=''
                            >JDBC Client Driver</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/transactions/mvcc"

                                class=''
                            >Multiversion Concurrency Control</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="" class='group-toggle collapsed '>Distributed Computing<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/distributed-computing/distributed-computing"

                                class=''
                            >Distributed Computing API</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/distributed-computing/cluster-groups"

                                class=''
                            >Cluster Groups</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/distributed-computing/executor-service"

                                class=''
                            >Executor Service</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/distributed-computing/map-reduce"

                                class=''
                            >MapReduce API</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/distributed-computing/load-balancing"

                                class=''
                            >Load Balancing</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/distributed-computing/fault-tolerance"

                                class=''
                            >Fault Tolerance</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/distributed-computing/job-scheduling"

                                class=''
                            >Job Scheduling</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/collocated-computations" class='' >Colocating Computations with Data</a>
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="" class='group-toggle collapsed '>Working with Events<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/events/listening-to-events"

                                class=''
                            >Enabling and Listenting to Events</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/events/events"

                                class=''
                            >Events</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/near-cache" class='' >Near Caches</a>
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/platform-cache" class='' >.NET Platform Cache</a>
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="" class='group-toggle collapsed '>Monitoring<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/monitoring-metrics/intro"

                                class=''
                            >Introduction</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/monitoring-metrics/cluster-id"

                                class=''
                            >Cluster ID and Tag</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>Metrics<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
                            <nav class="sub_pages collapsed">

                            
                                  

								  <li><a href="/docs/2.9.0/monitoring-metrics/configuring-metrics" class=''>Configuring Metrics</a></li>
                            
                                  

								  <li><a href="/docs/2.9.0/monitoring-metrics/metrics" class=''>JMX Metrics</a></li>
                            
                            </nav>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>New Metrics System<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
                            <nav class="sub_pages collapsed">

                            
                                  

								  <li><a href="/docs/2.9.0/monitoring-metrics/new-metrics-system" class=''>Introduction</a></li>
                            
                                  

								  <li><a href="/docs/2.9.0/monitoring-metrics/new-metrics" class=''>Metrics</a></li>
                            
                            </nav>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/monitoring-metrics/system-views"

                                class=''
                            >System Views</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/monitoring-metrics/tracing"

                                class=''
                            >Tracing</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="/security" class='group-toggle collapsed '>Security<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/security/authentication"

                                class=''
                            >Authentication</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/security/ssl-tls"

                                class=''
                            >SSL/TLS</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>Transparent Data Encryption<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
                            <nav class="sub_pages collapsed">

                            
                                  

								  <li><a href="/docs/2.9.0/security/tde" class=''>Introduction</a></li>
                            
                                  

								  <li><a href="/docs/2.9.0/security/master-key-rotation" class=''>Master key rotation</a></li>
                            
                            </nav>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="" class='group-toggle collapsed '>Thin Clients<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/thin-clients/getting-started-with-thin-clients"

                                class=''
                            >Thin Clients Overview</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/thin-clients/java-thin-client"

                                class=''
                            >Java Thin Client</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/thin-clients/dotnet-thin-client"

                                class=''
                            >.NET Thin Client</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/thin-clients/cpp-thin-client"

                                class=''
                            >C++ Thin Client</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/thin-clients/python-thin-client"

                                class=''
                            >Python Thin Client</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/thin-clients/php-thin-client"

                                class=''
                            >PHP Thin Client</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/thin-clients/nodejs-thin-client"

                                class=''
                            >Node.js Thin Client</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="" class='group-toggle collapsed '>ODBC Driver<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/ODBC/odbc-driver"

                                class=''
                            >ODBC Driver</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/ODBC/connection-string-dsn"

                                class=''
                            >Connection String and DSN</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/ODBC/querying-modifying-data"

                                class=''
                            >Querying and Modifying Data</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/ODBC/specification"

                                class=''
                            >Specification</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/ODBC/data-types"

                                class=''
                            >Data Types</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/SQL/ODBC/error-codes"

                                class=''
                            >Error Codes</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/restapi" class='' >REST API</a>
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/control-script" class='' >Control Script</a>
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/plugins" class='' >Plugins</a>
            
        </li>
    
        <li>
            

            <a href="/docs/2.9.0/sqlline" class='' >SQLLine</a>
            
        </li>
    
        <li>
            

            

            

			<button type='button' data-guide-url="/sql-reference/sql-reference-overview" class='group-toggle collapsed '>SQL Reference<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/sql-reference/ddl"

                                class=''
                            >Data Definition Language (DDL)</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/sql-reference/dml"

                                class=''
                            >Data Manipulation Language (DML)</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/sql-reference/transactions"

                                class=''
                            >Transactions</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/sql-reference/operational-commands"

                                class=''
                            >Operational Commands</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/sql-reference/aggregate-functions"

                                class=''
                            >Aggregate functions</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/sql-reference/numeric-functions"

                                class=''
                            >Numeric Functions</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/sql-reference/string-functions"

                                class=''
                            >String Functions</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/sql-reference/date-time-functions"

                                class=''
                            >Data and Time Functions</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/sql-reference/system-functions"

                                class=''
                            >System Functions</a>
                        
                    </li>
                

                    
                    

                    <li> 
                        
                            <a href="/docs/2.9.0/sql-reference/data-types"

                                class=''
                            >Data Types</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
</nav>
<div class="left-nav__overlay"></div>


    <article data-swiftype-index='true'>
      <a class='edit-link' href="https://github.com/apache/ignite/tree/IGNITE-7595/docs/_docs/key-value-api/transactions.adoc" target="_blank">Edit</a>
        
            <h1>Performing Transactions</h1>
        
        <div class="sect1">
<h2 id="overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable transactional support for a specific cache, set the <code>atomicityMode</code> parameter in the cache configuration to <code>TRANSACTIONAL</code>.
See <a href="/docs/2.9.0/configuring-caches/atomicity-modes">Atomicity Modes</a> for details.</p>
</div>
<div class="paragraph">
<p>Transactions allow you to group multiple cache operations, on one or more keys, into a single atomic transaction.
These operations are executed without any other interleaved operations on the specified keys, and either all succeed or all fail.
There is no partial execution of the operations.</p>
</div>
<div class="paragraph">
<p>You can enable transactions for a specific cache in the cache configuration.</p>
</div>
<code-tabs><code-tab data-tab='XML'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.apache.ignite.configuration.IgniteConfiguration"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"transactionConfiguration"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.apache.ignite.configuration.TransactionConfiguration"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!--Set the timeout to 20 seconds--&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"TxTimeoutOnPartitionMapExchange"</span> <span class="na">value=</span><span class="s">"20000"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/property&gt;</span>

<span class="nt">&lt;/bean&gt;</span></code></pre>
</div>
</div></code-tab><code-tab data-tab='Java'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CacheConfiguration</span> <span class="n">cacheCfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CacheConfiguration</span><span class="o">();</span>

<span class="n">cacheCfg</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"cacheName"</span><span class="o">);</span>

<span class="n">cacheCfg</span><span class="o">.</span><span class="na">setAtomicityMode</span><span class="o">(</span><span class="nc">CacheAtomicityMode</span><span class="o">.</span><span class="na">TRANSACTIONAL</span><span class="o">);</span>

<span class="nc">IgniteConfiguration</span> <span class="n">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IgniteConfiguration</span><span class="o">();</span>

<span class="n">cfg</span><span class="o">.</span><span class="na">setCacheConfiguration</span><span class="o">(</span><span class="n">cacheCfg</span><span class="o">);</span>

<span class="c1">// Optional transaction configuration. Configure TM lookup here.</span>
<span class="nc">TransactionConfiguration</span> <span class="n">txCfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TransactionConfiguration</span><span class="o">();</span>

<span class="n">cfg</span><span class="o">.</span><span class="na">setTransactionConfiguration</span><span class="o">(</span><span class="n">txCfg</span><span class="o">);</span>

<span class="c1">// Start a node</span>
<span class="nc">Ignition</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="n">cfg</span><span class="o">);</span></code></pre>
</div>
</div></code-tab><code-tab data-tab='C#/.NET'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="kt">var</span> <span class="n">cfg</span> <span class="p">=</span> <span class="k">new</span> <span class="n">IgniteConfiguration</span>
<span class="p">{</span>
    <span class="n">CacheConfiguration</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span>
    <span class="p">{</span>
        <span class="k">new</span> <span class="nf">CacheConfiguration</span><span class="p">(</span><span class="s">"txCache"</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">AtomicityMode</span> <span class="p">=</span> <span class="n">CacheAtomicityMode</span><span class="p">.</span><span class="n">Transactional</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="n">TransactionConfiguration</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TransactionConfiguration</span>
    <span class="p">{</span>
        <span class="n">DefaultTransactionConcurrency</span> <span class="p">=</span> <span class="n">TransactionConcurrency</span><span class="p">.</span><span class="n">Optimistic</span>
    <span class="p">}</span>
<span class="p">};</span></code></pre>
</div>
</div></code-tab><code-tab data-tab='C++' data-unavailable='true'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>This API is not presently available for C++. You can use XML configuration.</code></pre>
</div>
</div></code-tab></code-tabs>
</div>
</div>
<div class="sect1">
<h2 id="executing-transactions">Executing Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The key-value API provides an interface for starting and completing transactions as well as getting transaction-related metrics. The interface can be obtained from an instance of <code>Ignite</code>.</p>
</div>
<code-tabs><code-tab data-tab='Java'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Ignite</span> <span class="n">ignite</span> <span class="o">=</span> <span class="nc">Ignition</span><span class="o">.</span><span class="na">ignite</span><span class="o">();</span>

<span class="nc">IgniteTransactions</span> <span class="n">transactions</span> <span class="o">=</span> <span class="n">ignite</span><span class="o">.</span><span class="na">transactions</span><span class="o">();</span>

<span class="k">try</span> <span class="o">(</span><span class="nc">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">transactions</span><span class="o">.</span><span class="na">txStart</span><span class="o">())</span> <span class="o">{</span>
    <span class="nc">Integer</span> <span class="n">hello</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"Hello"</span><span class="o">);</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">hello</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span>
        <span class="n">cache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"Hello"</span><span class="o">,</span> <span class="mi">11</span><span class="o">);</span>

    <span class="n">cache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"World"</span><span class="o">,</span> <span class="mi">22</span><span class="o">);</span>

    <span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div></code-tab><code-tab data-tab='C#/.NET'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="kt">var</span> <span class="n">cfg</span> <span class="p">=</span> <span class="k">new</span> <span class="n">IgniteConfiguration</span>
<span class="p">{</span>
    <span class="n">DiscoverySpi</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TcpDiscoverySpi</span>
    <span class="p">{</span>
        <span class="n">LocalPort</span> <span class="p">=</span> <span class="m">48500</span><span class="p">,</span>
        <span class="n">LocalPortRange</span> <span class="p">=</span> <span class="m">20</span><span class="p">,</span>
        <span class="n">IpFinder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TcpDiscoveryStaticIpFinder</span>
        <span class="p">{</span>
            <span class="n">Endpoints</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span>
            <span class="p">{</span>
                <span class="s">"127.0.0.1:48500..48520"</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="n">CacheConfiguration</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span>
    <span class="p">{</span>
        <span class="k">new</span> <span class="n">CacheConfiguration</span>
        <span class="p">{</span>
            <span class="n">Name</span> <span class="p">=</span> <span class="s">"cacheName"</span><span class="p">,</span>
            <span class="n">AtomicityMode</span> <span class="p">=</span> <span class="n">CacheAtomicityMode</span><span class="p">.</span><span class="n">Transactional</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="n">TransactionConfiguration</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TransactionConfiguration</span>
    <span class="p">{</span>
        <span class="n">DefaultTimeoutOnPartitionMapExchange</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromSeconds</span><span class="p">(</span><span class="m">20</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">var</span> <span class="n">ignite</span> <span class="p">=</span> <span class="n">Ignition</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="n">cfg</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">cache</span> <span class="p">=</span> <span class="n">ignite</span><span class="p">.</span><span class="n">GetCache</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;(</span><span class="s">"cacheName"</span><span class="p">);</span>
<span class="n">cache</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">transactions</span> <span class="p">=</span> <span class="n">ignite</span><span class="p">.</span><span class="nf">GetTransactions</span><span class="p">();</span>

<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">tx</span> <span class="p">=</span> <span class="n">transactions</span><span class="p">.</span><span class="nf">TxStart</span><span class="p">())</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">hello</span> <span class="p">=</span> <span class="n">cache</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">hello</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">cache</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">,</span> <span class="m">11</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">cache</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="s">"World"</span><span class="p">,</span> <span class="m">22</span><span class="p">);</span>

    <span class="n">tx</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
<span class="p">}</span></code></pre>
</div>
</div></code-tab><code-tab data-tab='C++'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="cpp"><span class="n">Transactions</span> <span class="n">transactions</span> <span class="o">=</span> <span class="n">ignite</span><span class="p">.</span><span class="n">GetTransactions</span><span class="p">();</span>

<span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">transactions</span><span class="p">.</span><span class="n">TxStart</span><span class="p">();</span>
<span class="kt">int</span> <span class="n">hello</span> <span class="o">=</span> <span class="n">cache</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">hello</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">Put</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>

<span class="n">cache</span><span class="p">.</span><span class="n">Put</span><span class="p">(</span><span class="s">"World"</span><span class="p">,</span> <span class="mi">22</span><span class="p">);</span>

<span class="n">tx</span><span class="p">.</span><span class="n">Commit</span><span class="p">();</span></code></pre>
</div>
</div></code-tab></code-tabs>
</div>
</div>
<div class="sect1">
<h2 id="concurrency-modes-and-isolation-levels">Concurrency Modes and Isolation Levels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Caches with the <code>TRANSACTIONAL</code> atomicity mode support both <code>OPTIMISTIC</code> and <code>PESSIMISTIC</code> concurrency modes for transactions. Concurrency mode determines when an entry-level transaction lock is acquired: at the time of data access or during the prepare phase. Locking prevents concurrent access to an object. For example, when you attempt to update a ToDo list item with pessimistic locking, the server places a lock on the object until you either commit or rollback the transaction and no other transaction or operation is allowed to update the same entry. Regardless of the concurrency mode used in a transaction, there exists a moment in time when all entries enlisted in the transaction are locked before the commit.</p>
</div>
<div class="paragraph">
<p>Isolation level defines how concurrent transactions 'see' and handle operations on the same keys. Ignite supports <code>READ_COMMITTED</code>, <code>REPEATABLE_READ</code> and <code>SERIALIZABLE</code> isolation levels.</p>
</div>
<div class="paragraph">
<p>All combinations of concurrency modes and isolation levels are allowed. Below is the description of the system behavior and the guarantees provided by each concurrency-isolation combination.</p>
</div>
<div class="sect2">
<h3 id="pessimistic-transactions">Pessimistic Transactions</h3>
<div class="paragraph">
<p>In <code>PESSIMISTIC</code> transactions, locks are acquired during the first read or write access (depending on the isolation level) and held by the transaction until it is committed or rolled back. In this mode locks are acquired on primary nodes first and then promoted to backup nodes during the prepare stage. The following isolation levels can be configured with the <code>PESSIMISTIC</code> concurrency mode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>READ_COMMITTED</code> - Data is read without a lock and is never cached in the transaction itself. The data may be read from a backup node if this is allowed in the cache configuration. In this isolation mode you can have the so-called Non-Repeatable Reads</p>
</li>
<li>
<p>because a concurrent transaction can change the data when you are reading the data twice in your transaction. The lock is only acquired at the time of first write access (this includes <code>EntryProcessor</code> invocation). This means that an entry that has been read during the transaction may have a different value by the time the transaction is committed. No exception is thrown in this case.</p>
</li>
<li>
<p><code>REPEATABLE_READ</code> - Entry lock is acquired and data is fetched from the primary node on the first read or write access and stored in the local transactional map. All consecutive access to the same data is local and returns the last read or updated transaction value. This means no other concurrent transactions can make changes to the locked data, and you are getting Repeatable Reads for your transaction.</p>
</li>
<li>
<p><code>SERIALIZABLE</code> - In the <code>PESSIMISTIC</code> mode, this isolation level works the same way as <code>REPEATABLE_READ</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that in the <code>PESSIMISTIC</code> mode, the order of locking is important. Moreover, locks are acquired sequentially and exactly in the specified order.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<h3 id="topology-change-restrictions" class="discrete">Topology Change Restrictions</h3>
<div class="paragraph">
<p>Note that if at least one <code>PESSIMISTIC</code> transaction lock is acquired, it is impossible to change the cache topology until the transaction is committed or rolled back.
Therefore, you should avoid holding transaction locks for long periods of time.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="optimistic-transactions">Optimistic Transactions</h3>
<div class="paragraph">
<p>In <code>OPTIMISTIC</code> transactions, entry locks are acquired on primary nodes during the first phase of 2PC, at the <code>prepare</code> step, and then promoted to backup nodes and released once the transaction is committed. The locks are never acquired if you roll back the transaction and no commit attempt was made. The following isolation levels can be configured with the <code>OPTIMISTIC</code> concurrency mode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>READ_COMMITTED</code> - Changes that should be applied to the cache are collected on the originating node and applied upon the transaction commit. Transaction data is read without a lock and is never cached in the transaction. The data may be read from a backup node if this is allowed in the cache configuration. In this isolation you can have so-called Non-Repeatable Reads because a concurrent transaction can change the data when you are reading the data twice in your transaction. This mode combination does not check if the entry value has been modified since the first read or write access and never raises an optimistic exception.</p>
</li>
<li>
<p><code>REPEATABLE_READ</code> - Transactions at this isolation level work similar to <code>OPTIMISTIC</code> <code>READ_COMMITTED</code> transactions with only one difference: read values are cached on the originating node and all subsequent reads are guaranteed to be local. This mode combination does not check if the entry value has been modified since the first read or write access and never raises an optimistic exception.</p>
</li>
<li>
<p><code>SERIALIZABLE</code> - Stores an entry version upon first read access. Ignite fails a transaction at the commit stage if the Ignite engine detects that at least one of the entries used as part of the initiated transaction has been modified. In short, this means that if Ignite detects that there is a conflict at the commit stage of a transaction, it fails the transaction, throwing <code>TransactionOptimisticException</code> and rolling back any changes made. Make sure you handle this exception and retry the transaction.</p>
</li>
</ul>
</div>
<code-tabs><code-tab data-tab='Java'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CacheConfiguration</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CacheConfiguration</span><span class="o">&lt;&gt;();</span>
<span class="n">cfg</span><span class="o">.</span><span class="na">setAtomicityMode</span><span class="o">(</span><span class="nc">CacheAtomicityMode</span><span class="o">.</span><span class="na">TRANSACTIONAL</span><span class="o">);</span>
<span class="n">cfg</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"myCache"</span><span class="o">);</span>
<span class="nc">IgniteCache</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">ignite</span><span class="o">.</span><span class="na">getOrCreateCache</span><span class="o">(</span><span class="n">cfg</span><span class="o">);</span>

<span class="c1">// Re-try the transaction a limited number of times.</span>
<span class="kt">int</span> <span class="n">retryCount</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">retries</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

<span class="c1">// Start a transaction in the optimistic mode with the serializable isolation</span>
<span class="c1">// level.</span>
<span class="k">while</span> <span class="o">(</span><span class="n">retries</span> <span class="o">&lt;</span> <span class="n">retryCount</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">retries</span><span class="o">++;</span>
    <span class="k">try</span> <span class="o">(</span><span class="nc">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">ignite</span><span class="o">.</span><span class="na">transactions</span><span class="o">().</span><span class="na">txStart</span><span class="o">(</span><span class="nc">TransactionConcurrency</span><span class="o">.</span><span class="na">OPTIMISTIC</span><span class="o">,</span>
            <span class="nc">TransactionIsolation</span><span class="o">.</span><span class="na">SERIALIZABLE</span><span class="o">))</span> <span class="o">{</span>
        <span class="c1">// modify cache entries as part of this transaction.</span>
        <span class="n">cache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"foo"</span><span class="o">);</span>
        <span class="n">cache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">);</span>
        <span class="c1">// commit the transaction</span>
        <span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>

        <span class="c1">// the transaction succeeded. Leave the while loop.</span>
        <span class="k">break</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">TransactionOptimisticException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Transaction has failed. Retry.</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div></code-tab><code-tab data-tab='C#/.NET'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="kt">var</span> <span class="n">cfg</span> <span class="p">=</span> <span class="k">new</span> <span class="n">IgniteConfiguration</span>
<span class="p">{</span>
    <span class="n">DiscoverySpi</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TcpDiscoverySpi</span>
    <span class="p">{</span>
        <span class="n">LocalPort</span> <span class="p">=</span> <span class="m">48500</span><span class="p">,</span>
        <span class="n">LocalPortRange</span> <span class="p">=</span> <span class="m">20</span><span class="p">,</span>
        <span class="n">IpFinder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TcpDiscoveryStaticIpFinder</span>
        <span class="p">{</span>
            <span class="n">Endpoints</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span>
            <span class="p">{</span>
                <span class="s">"127.0.0.1:48500..48520"</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="n">CacheConfiguration</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span>
    <span class="p">{</span>
        <span class="k">new</span> <span class="n">CacheConfiguration</span>
        <span class="p">{</span>
            <span class="n">Name</span> <span class="p">=</span> <span class="s">"cacheName"</span><span class="p">,</span>
            <span class="n">AtomicityMode</span> <span class="p">=</span> <span class="n">CacheAtomicityMode</span><span class="p">.</span><span class="n">Transactional</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="n">TransactionConfiguration</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TransactionConfiguration</span>
    <span class="p">{</span>
        <span class="n">DefaultTimeoutOnPartitionMapExchange</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromSeconds</span><span class="p">(</span><span class="m">20</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">var</span> <span class="n">ignite</span> <span class="p">=</span> <span class="n">Ignition</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="n">cfg</span><span class="p">);</span>
<span class="c1">// Re-try the transaction a limited number of times</span>
<span class="kt">var</span> <span class="n">retryCount</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">retries</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

<span class="c1">// Start a transaction in the optimistic mode with the serializable isolation level</span>
<span class="k">while</span> <span class="p">(</span><span class="n">retries</span> <span class="p">&lt;</span> <span class="n">retryCount</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">retries</span><span class="p">++;</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">tx</span> <span class="p">=</span> <span class="n">ignite</span><span class="p">.</span><span class="nf">GetTransactions</span><span class="p">().</span><span class="nf">TxStart</span><span class="p">(</span><span class="n">TransactionConcurrency</span><span class="p">.</span><span class="n">Optimistic</span><span class="p">,</span>
            <span class="n">TransactionIsolation</span><span class="p">.</span><span class="n">Serializable</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// modify cache entries as part of this transaction.</span>

            <span class="c1">// commit the transaction</span>
            <span class="n">tx</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>

            <span class="c1">// the transaction succeeded. Leave the while loop.</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">TransactionOptimisticException</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Transaction has failed. Retry.</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre>
</div>
</div></code-tab><code-tab data-tab='C++'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="cpp"><span class="c1">// Re-try the transaction a limited number of times.</span>
<span class="kt">int</span> <span class="k">const</span> <span class="n">retryCount</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">retries</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// Start a transaction in the optimistic mode with the serializable isolation level.</span>
<span class="k">while</span> <span class="p">(</span><span class="n">retries</span> <span class="o">&lt;</span> <span class="n">retryCount</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">retries</span><span class="o">++</span><span class="p">;</span>

    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">ignite</span><span class="p">.</span><span class="n">GetTransactions</span><span class="p">().</span><span class="n">TxStart</span><span class="p">(</span>
                <span class="n">TransactionConcurrency</span><span class="o">::</span><span class="n">OPTIMISTIC</span><span class="p">,</span> <span class="n">TransactionIsolation</span><span class="o">::</span><span class="n">SERIALIZABLE</span><span class="p">);</span>

        <span class="c1">// commit the transaction</span>
        <span class="n">tx</span><span class="p">.</span><span class="n">Commit</span><span class="p">();</span>

        <span class="c1">// the transaction succeeded. Leave the while loop.</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">IgniteError</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Transaction has failed. Retry.</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div></code-tab></code-tabs>
<div class="paragraph">
<p>Another important point to note here is that a transaction fails even if an entry was read without being modified (<code>cache.put(&#8230;&#8203;)</code>), since the value of the entry could be important to the logic within the initiated transaction.</p>
</div>
<div class="paragraph">
<p>Note that the key order is important for <code>READ_COMMITTED</code> and <code>REPEATABLE_READ</code> transactions since the locks are still acquired sequentially in these modes.</p>
</div>
</div>
<div class="sect2">
<h3 id="read-consistency">Read Consistency</h3>
<div class="paragraph">
<p>In order to achieve full read consistency in PESSIMISTIC mode, read-locks need to be acquired. This means that full consistency between reads in the PESSIMISTIC mode can be achieved only with PESSIMISTIC REPEATABLE_READ (or SERIALIZABLE) transactions.</p>
</div>
<div class="paragraph">
<p>When using OPTIMISTIC transactions, full read consistency can be achieved by disallowing potential conflicts between reads.
This behavior is provided by OPTIMISTIC SERIALIZABLE mode.
Note, however, that until the commit happens you can still read a partial transaction state, so the transaction logic must protect against it.
Only during the commit phase, in case of any conflict, a <code>TransactionOptimisticException</code> is thrown allowing you to retry the transaction.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If you are not using PESSIMISTIC REPEATABLE_READ or SERIALIZABLE transactions or OPTIMISTIC SERIALIZABLE transactions, then it is possible to see a partial transaction state. This means that if one transaction updates objects A and B, then another transaction may see the new value for A and the old value for B.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deadlock-detection">Deadlock Detection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One major rule that you must follow when working with distributed transactions is that locks for the keys participating in a transaction must be acquired in the same order. Violating this rule can lead to a distributed deadlock.</p>
</div>
<div class="paragraph">
<p>Ignite does not avoid distributed deadlocks, but rather has built-in functionality that makes it easier to debug and fix such situations.</p>
</div>
<div class="paragraph">
<p>In the code snippet below, a transaction has been started with a timeout.
If the timeout expires, the deadlock detection procedure tries to find a possible deadlock that might have caused the timeout.
When the timeout expires, <code>TransactionTimeoutException</code> is generated and propagated to the application code as the cause of <code>CacheException</code> regardless of a deadlock.
However, if a deadlock is detected, the cause of the returned <code>TransactionTimeoutException</code> will be <code>TransactionDeadlockException</code> (at least for one transaction involved in the deadlock).</p>
</div>
<code-tabs><code-tab data-tab='Java'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CacheConfiguration</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CacheConfiguration</span><span class="o">&lt;&gt;();</span>
<span class="n">cfg</span><span class="o">.</span><span class="na">setAtomicityMode</span><span class="o">(</span><span class="nc">CacheAtomicityMode</span><span class="o">.</span><span class="na">TRANSACTIONAL</span><span class="o">);</span>
<span class="n">cfg</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"myCache"</span><span class="o">);</span>
<span class="nc">IgniteCache</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">ignite</span><span class="o">.</span><span class="na">getOrCreateCache</span><span class="o">(</span><span class="n">cfg</span><span class="o">);</span>

<span class="k">try</span> <span class="o">(</span><span class="nc">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">ignite</span><span class="o">.</span><span class="na">transactions</span><span class="o">().</span><span class="na">txStart</span><span class="o">(</span><span class="nc">TransactionConcurrency</span><span class="o">.</span><span class="na">PESSIMISTIC</span><span class="o">,</span>
        <span class="nc">TransactionIsolation</span><span class="o">.</span><span class="na">READ_COMMITTED</span><span class="o">,</span> <span class="mi">300</span><span class="o">,</span> <span class="mi">0</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">cache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
    <span class="n">cache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>

    <span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">CacheException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getCause</span><span class="o">()</span> <span class="k">instanceof</span> <span class="nc">TransactionTimeoutException</span>
            <span class="o">&amp;&amp;</span> <span class="n">e</span><span class="o">.</span><span class="na">getCause</span><span class="o">().</span><span class="na">getCause</span><span class="o">()</span> <span class="k">instanceof</span> <span class="nc">TransactionDeadlockException</span><span class="o">)</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getCause</span><span class="o">().</span><span class="na">getCause</span><span class="o">().</span><span class="na">getMessage</span><span class="o">());</span>
<span class="o">}</span></code></pre>
</div>
</div></code-tab><code-tab data-tab='C#/.NET'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="kt">var</span> <span class="n">cfg</span> <span class="p">=</span> <span class="k">new</span> <span class="n">IgniteConfiguration</span>
<span class="p">{</span>
    <span class="n">DiscoverySpi</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TcpDiscoverySpi</span>
    <span class="p">{</span>
        <span class="n">LocalPort</span> <span class="p">=</span> <span class="m">48500</span><span class="p">,</span>
        <span class="n">LocalPortRange</span> <span class="p">=</span> <span class="m">20</span><span class="p">,</span>
        <span class="n">IpFinder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TcpDiscoveryStaticIpFinder</span>
        <span class="p">{</span>
            <span class="n">Endpoints</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span>
            <span class="p">{</span>
                <span class="s">"127.0.0.1:48500..48520"</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="n">CacheConfiguration</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span>
    <span class="p">{</span>
        <span class="k">new</span> <span class="n">CacheConfiguration</span>
        <span class="p">{</span>
            <span class="n">Name</span> <span class="p">=</span> <span class="s">"cacheName"</span><span class="p">,</span>
            <span class="n">AtomicityMode</span> <span class="p">=</span> <span class="n">CacheAtomicityMode</span><span class="p">.</span><span class="n">Transactional</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="n">TransactionConfiguration</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TransactionConfiguration</span>
    <span class="p">{</span>
        <span class="n">DefaultTimeoutOnPartitionMapExchange</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromSeconds</span><span class="p">(</span><span class="m">20</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">var</span> <span class="n">ignite</span> <span class="p">=</span> <span class="n">Ignition</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="n">cfg</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">intCache</span> <span class="p">=</span> <span class="n">ignite</span><span class="p">.</span><span class="n">GetOrCreateCache</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;(</span><span class="s">"intCache"</span><span class="p">);</span>
<span class="k">try</span>
<span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">tx</span> <span class="p">=</span> <span class="n">ignite</span><span class="p">.</span><span class="nf">GetTransactions</span><span class="p">().</span><span class="nf">TxStart</span><span class="p">(</span><span class="n">TransactionConcurrency</span><span class="p">.</span><span class="n">Pessimistic</span><span class="p">,</span>
        <span class="n">TransactionIsolation</span><span class="p">.</span><span class="n">ReadCommitted</span><span class="p">,</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMilliseconds</span><span class="p">(</span><span class="m">300</span><span class="p">),</span> <span class="m">0</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">intCache</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
        <span class="n">intCache</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
        <span class="n">tx</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">TransactionTimeoutException</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">TransactionDeadlockException</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div></code-tab><code-tab data-tab='C++'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="cpp"><span class="k">try</span> <span class="p">{</span>
    <span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">ignite</span><span class="p">.</span><span class="n">GetTransactions</span><span class="p">().</span><span class="n">TxStart</span><span class="p">(</span>
        <span class="n">TransactionConcurrency</span><span class="o">::</span><span class="n">PESSIMISTIC</span><span class="p">,</span> <span class="n">TransactionIsolation</span><span class="o">::</span><span class="n">READ_COMMITTED</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">Put</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="n">cache</span><span class="p">.</span><span class="n">Put</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="n">tx</span><span class="p">.</span><span class="n">Commit</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">IgniteError</span><span class="o">&amp;</span> <span class="n">err</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"An error occurred: "</span> <span class="o">&lt;&lt;</span> <span class="n">err</span><span class="p">.</span><span class="n">GetText</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">err</span><span class="p">.</span><span class="n">GetCode</span><span class="p">();</span>
<span class="p">}</span></code></pre>
</div>
</div></code-tab></code-tabs>
<div class="paragraph">
<p>The <code>TransactionDeadlockException</code> message contains useful information that can help you find the reason for the deadlock.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">Deadlock detected:

K1: TX1 holds lock, TX2 waits lock.
K2: TX2 holds lock, TX1 waits lock.

Transactions:

TX1 <span class="o">[</span><span class="nv">txId</span><span class="o">=</span>GridCacheVersion <span class="o">[</span><span class="nv">topVer</span><span class="o">=</span>74949328, <span class="nb">time</span><span class="o">=</span>1463469328421, <span class="nv">order</span><span class="o">=</span>1463469326211, <span class="nv">nodeOrder</span><span class="o">=</span>1], <span class="nv">nodeId</span><span class="o">=</span>ad68354d-07b8-4be5-85bb-f5f2362fbb88, <span class="nv">threadId</span><span class="o">=</span>73]
TX2 <span class="o">[</span><span class="nv">txId</span><span class="o">=</span>GridCacheVersion <span class="o">[</span><span class="nv">topVer</span><span class="o">=</span>74949328, <span class="nb">time</span><span class="o">=</span>1463469328421, <span class="nv">order</span><span class="o">=</span>1463469326210, <span class="nv">nodeOrder</span><span class="o">=</span>1], <span class="nv">nodeId</span><span class="o">=</span>ad68354d-07b8-4be5-85bb-f5f2362fbb88, <span class="nv">threadId</span><span class="o">=</span>74]

Keys:

K1 <span class="o">[</span><span class="nv">key</span><span class="o">=</span>1, <span class="nv">cache</span><span class="o">=</span>default]
K2 <span class="o">[</span><span class="nv">key</span><span class="o">=</span>2, <span class="nv">cache</span><span class="o">=</span>default]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deadlock detection is a multi-step procedure that can take many iterations depending on the number of nodes in the cluster, keys, and transactions that are involved in a possible deadlock. A deadlock detection initiator is a node where a transaction was started and failed with a <code>TransactionTimeoutException</code>.
This node investigates if a deadlock has occurred by exchanging requests/responses with other remote nodes, and then prepares a deadlock related report that is provided with the <code>TransactionDeadlockException</code>.
Each such message (request/response) is known as an iteration.</p>
</div>
<div class="paragraph">
<p>Since a transaction is not rolled back until the deadlock detection procedure is completed, it sometimes makes sense to tune the parameters (shown below), if you want to have a predictable time for a transaction&#8217;s rollback.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IgniteSystemProperties.IGNITE_TX_DEADLOCK_DETECTION_MAX_ITERS</code> - Specifies the maximum number of iterations for the deadlock detection procedure. If the value of this property is less than or equal to zero, deadlock detection is disabled (1000 by default);</p>
</li>
<li>
<p><code>IgniteSystemProperties.IGNITE_TX_DEADLOCK_DETECTION_TIMEOUT</code> - Specifies the timeout for the deadlock detection mechanism (1 minute by default).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that if there are too few iterations, you may get an incomplete deadlock-report.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deadlock-free-transactions">Deadlock-free Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For <code>OPTIMISTIC</code> <code>SERIALIZABLE</code> transactions, locks are not acquired sequentially. In this mode, keys can be accessed in any order because transaction locks are acquired in parallel with an additional check allowing Ignite to avoid deadlocks.</p>
</div>
<div class="paragraph">
<p>We need to introduce some concepts in order to describe how locks in <code>SERIALIZABLE</code> transactions work.
In Ignite, each transaction is assigned a comparable version called <code>XidVersion</code>.
Upon transaction commit, each entry that is written in the transaction is assigned a new comparable version called <code>EntryVersion</code>.
An <code>OPTIMISTIC</code> <code>SERIALIZABLE</code> transaction with version <code>XidVersionA</code> fails with a <code>TransactionOptimisticException</code> if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is an ongoing <code>PESSIMISTIC</code> or non-serializable <code>OPTIMISTIC</code> transaction holding a lock on an entry of the <code>SERIALIZABLE</code> transaction.</p>
</li>
<li>
<p>There is another ongoing <code>OPTIMISTIC</code> <code>SERIALIZABLE</code> transaction with version <code>XidVersionB</code> such that <code>XidVersionB &gt; XidVersionA</code> and this transaction holds a lock on an entry of the <code>SERIALIZABLE</code> transaction.</p>
</li>
<li>
<p>By the time the <code>OPTIMISTIC</code> <code>SERIALIZABLE</code> transaction acquires all required locks, there exists an entry with the current version different from the observed version before commit.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In a highly concurrent environment, optimistic locking might lead to a high transaction failure rate but pessimistic locking can lead to deadlocks if locks are acquired in a different order by transactions.</p>
</div>
<div class="paragraph">
<p>However, in a contention-free environment optimistic serializable locking may provide better performance for large transactions because the number of network trips depends only on the number of nodes that the transaction spans and does not depend on the number of keys in the transaction.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="handling-failed-transactions">Handling Failed Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A transaction might fail with the following exceptions:</p>
</div>
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Exception</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheException</code> caused by <code>TransactionTimeoutException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TransactionTimeoutException</code> is generated if the transaction times out.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To solve this exception, increase the timeout or make the transaction shorter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CacheException</code> caused by <code>TransactionTimeoutException</code>, which is caused by <code>TransactionDeadlockException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is thrown if the optimistic transaction fails for some reason. In most cases, this exception occurs when the data the transaction was trying to update was changed concurrently.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rerun the transaction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TransactionOptimisticException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception is thrown if the optimistic transaction fails for some reason. In most of the scenarios, this exception occurs when the data the transaction was trying to update was changed concurrently.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rerun the transaction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TransactionRollbackException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This exception occurs when a transaction is rolled back (automatically or manually). In this case, the data is consistent.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Since the data is in a consistent state, you can retry the transaction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TransactionHeuristicException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An unlikely exception that happens due to an unexpected internal or communication issue. The exception exists to report problematic scenarios that were not foreseen by the transactional subsystem and were not handled by it properly.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data might not stay consistent if the exception occurs. Reload the data and report to Ignite development community.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="long-running-transactions-termination">Long Running Transactions Termination</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some cluster events trigger partition map exchange process and data rebalancing within an Ignite cluster to ensure even data distribution cluster-wide. An example of one such event is the cluster-topology-change event that takes place whenever a new node joins the cluster or an existing one leaves it. Plus, every time a new cache or SQL table is created, the partition map exchange gets triggered.</p>
</div>
<div class="paragraph">
<p>When the partition map exchange starts, Ignite acquires a global lock at a particular stage. The lock can&#8217;t be obtained while incomplete transactions are running in parallel. These transactions prevent the partition map exchange process from moving forward​, thus, blocking some operations such as a new node join process.</p>
</div>
<div class="paragraph">
<p>Use the <code>TransactionConfiguration.setTxTimeoutOnPartitionMapExchange(&#8230;&#8203;)</code> method to set the maximum time allowed for your long-running transactions to block the partition map exchange.
Once the timeout fires, all incomplete transactions are rolled back letting the partition map exchange proceed.</p>
</div>
<div class="paragraph">
<p>This example shows how to configure the timeout:</p>
</div>
<code-tabs><code-tab data-tab='XML'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.apache.ignite.configuration.IgniteConfiguration"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"transactionConfiguration"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.apache.ignite.configuration.TransactionConfiguration"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!--Set the timeout to 20 seconds--&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"TxTimeoutOnPartitionMapExchange"</span> <span class="na">value=</span><span class="s">"20000"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/property&gt;</span>

<span class="nt">&lt;/bean&gt;</span></code></pre>
</div>
</div></code-tab><code-tab data-tab='Java'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// Create a configuration</span>
<span class="nc">IgniteConfiguration</span> <span class="n">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IgniteConfiguration</span><span class="o">();</span>

<span class="c1">// Create a Transaction configuration</span>
<span class="nc">TransactionConfiguration</span> <span class="n">txCfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TransactionConfiguration</span><span class="o">();</span>

<span class="c1">// Set the timeout to 20 seconds</span>
<span class="n">txCfg</span><span class="o">.</span><span class="na">setTxTimeoutOnPartitionMapExchange</span><span class="o">(</span><span class="mi">20000</span><span class="o">);</span>

<span class="n">cfg</span><span class="o">.</span><span class="na">setTransactionConfiguration</span><span class="o">(</span><span class="n">txCfg</span><span class="o">);</span>

<span class="c1">// Start the node</span>
<span class="nc">Ignition</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="n">cfg</span><span class="o">);</span></code></pre>
</div>
</div></code-tab><code-tab data-tab='C#/.NET'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="kt">var</span> <span class="n">cfg</span> <span class="p">=</span> <span class="k">new</span> <span class="n">IgniteConfiguration</span>
<span class="p">{</span>
    <span class="n">TransactionConfiguration</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TransactionConfiguration</span>
    <span class="p">{</span>
        <span class="n">DefaultTimeoutOnPartitionMapExchange</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromSeconds</span><span class="p">(</span><span class="m">20</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="n">Ignition</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="n">cfg</span><span class="p">);</span></code></pre>
</div>
</div></code-tab><code-tab data-tab='C++' data-unavailable='true'><div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>This API is not presently available for C++. You can use XML configuration.</code></pre>
</div>
</div></code-tab></code-tabs>
</div>
</div>
<div class="sect1">
<h2 id="monitoring-transactions">Monitoring Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Refer to the <a href="/docs/2.9.0/monitoring-metrics/metrics#monitoring-transactions">Monitoring Transactions</a> section for the list of metrics that expose some transaction-related information.</p>
</div>
<div class="paragraph">
<p>For the information on how to trace transactions, refer to the <a href="/docs/2.9.0/monitoring-metrics/tracing">Tracing</a> section.</p>
</div>
<div class="paragraph">
<p>You can also use the <a href="/docs/2.9.0/control-script#transaction-management">control script</a> to get information about, or cancel, specific transactions being executed in the cluster.</p>
</div>
</div>
</div>
    </article>
    <nav class="right-nav" data-swiftype-index='false'>
    <ul class="sectlevel1">
<li><a href="#overview">Overview</a></li>
<li><a href="#executing-transactions">Executing Transactions</a></li>
<li><a href="#concurrency-modes-and-isolation-levels">Concurrency Modes and Isolation Levels</a>
<ul class="sectlevel2">
<li><a href="#pessimistic-transactions">Pessimistic Transactions</a></li>
<li><a href="#optimistic-transactions">Optimistic Transactions</a></li>
<li><a href="#read-consistency">Read Consistency</a></li>
</ul>
</li>
<li><a href="#deadlock-detection">Deadlock Detection</a></li>
<li><a href="#deadlock-free-transactions">Deadlock-free Transactions</a></li>
<li><a href="#handling-failed-transactions">Handling Failed Transactions</a></li>
<li><a href="#long-running-transactions-termination">Long Running Transactions Termination</a></li>
<li><a href="#monitoring-transactions">Monitoring Transactions</a></li>
</ul>
          
      
<footer>
</footer>

</nav>
    
</section>
<script type='module' src='/assets/js/code-copy-to-clipboard.js' async crossorigin></script>

    <script>
    // inits deep anchors -- needs to be done here because of https://www.bryanbraun.com/anchorjs/#dont-run-it-too-late 
    anchors.add('.page-docs h1, .page-docs h2, .page-docs h3:not(.discrete), .page-docs h4, .page-docs h5');
    anchors.options = {
        placement: 'right',
        visible: 'always'
    };
    </script>
    <!-- load google fonts async -->
    <script type="text/javascript">
    WebFontConfig = {
      google: { families: [ 'Open+Sans:300,400,600,700&display=swap' ] }
    };
    (function() {
      var wf = document.createElement('script');
      wf.src = 'https://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
      wf.type = 'text/javascript';
      wf.async = 'true';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(wf, s);
    })(); </script>
    <script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script>
      docsearch({
        // Your apiKey and indexName will be given to you once
        // we create your config
        apiKey: '3eee686c0ebe39eff3baeb18c56fa5f8', 
        indexName: 'apache_ignite',
        // Replace inputSelector with a CSS selector
        // matching your search input
        inputSelector: '#search-input',
        // algoliaOptions: { 'facetFilters': ["version:$VERSION"] },

        // Set debug to true to inspect the dropdown
        debug: false,
      });
    </script>
<script type='module' src='/assets/js/index.js?1598892243' async crossorigin></script>
<script type='module' src='/assets/js/versioning.js?1598892243' async crossorigin></script>
</body>

</html>
