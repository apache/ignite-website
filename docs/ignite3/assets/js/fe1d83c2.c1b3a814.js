"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[9435],{11470:(n,e,a)=>{a.d(e,{A:()=>A});var t=a(96540),r=a(34164),s=a(17559),c=a(23104),o=a(56347),i=a(205),l=a(57485),u=a(31682),d=a(70679);function h(n){return t.Children.toArray(n).filter(n=>"\n"!==n).map(n=>{if(!n||(0,t.isValidElement)(n)&&function(n){const{props:e}=n;return!!e&&"object"==typeof e&&"value"in e}(n))return n;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof n.type?n.type:n.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function p(n){const{values:e,children:a}=n;return(0,t.useMemo)(()=>{const n=e??function(n){return h(n).map(({props:{value:n,label:e,attributes:a,default:t}})=>({value:n,label:e,attributes:a,default:t}))}(a);return function(n){const e=(0,u.XI)(n,(n,e)=>n.value===e.value);if(e.length>0)throw new Error(`Docusaurus error: Duplicate values "${e.map(n=>n.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(n),n},[e,a])}function m({value:n,tabValues:e}){return e.some(e=>e.value===n)}function g({queryString:n=!1,groupId:e}){const a=(0,o.W6)(),r=function({queryString:n=!1,groupId:e}){if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!e)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return e??null}({queryString:n,groupId:e});return[(0,l.aZ)(r),(0,t.useCallback)(n=>{if(!r)return;const e=new URLSearchParams(a.location.search);e.set(r,n),a.replace({...a.location,search:e.toString()})},[r,a])]}function x(n){const{defaultValue:e,queryString:a=!1,groupId:r}=n,s=p(n),[c,o]=(0,t.useState)(()=>function({defaultValue:n,tabValues:e}){if(0===e.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!m({value:n,tabValues:e}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${e.map(n=>n.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const a=e.find(n=>n.default)??e[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:e,tabValues:s})),[l,u]=g({queryString:a,groupId:r}),[h,x]=function({groupId:n}){const e=function(n){return n?`docusaurus.tab.${n}`:null}(n),[a,r]=(0,d.Dv)(e);return[a,(0,t.useCallback)(n=>{e&&r.set(n)},[e,r])]}({groupId:r}),b=(()=>{const n=l??h;return m({value:n,tabValues:s})?n:null})();(0,i.A)(()=>{b&&o(b)},[b]);return{selectedValue:c,selectValue:(0,t.useCallback)(n=>{if(!m({value:n,tabValues:s}))throw new Error(`Can't select invalid tab value=${n}`);o(n),u(n),x(n)},[u,x,s]),tabValues:s}}var b=a(92303);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=a(74848);function y({className:n,block:e,selectedValue:a,selectValue:t,tabValues:s}){const o=[],{blockElementScrollPositionUntilNextRender:i}=(0,c.a_)(),l=n=>{const e=n.currentTarget,r=o.indexOf(e),c=s[r].value;c!==a&&(i(e),t(c))},u=n=>{let e=null;switch(n.key){case"Enter":l(n);break;case"ArrowRight":{const a=o.indexOf(n.currentTarget)+1;e=o[a]??o[0];break}case"ArrowLeft":{const a=o.indexOf(n.currentTarget)-1;e=o[a]??o[o.length-1];break}}e?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":e},n),children:s.map(({value:n,label:e,attributes:t})=>(0,f.jsx)("li",{role:"tab",tabIndex:a===n?0:-1,"aria-selected":a===n,ref:n=>{o.push(n)},onKeyDown:u,onClick:l,...t,className:(0,r.A)("tabs__item",v.tabItem,t?.className,{"tabs__item--active":a===n}),children:e??n},n))})}function j({lazy:n,children:e,selectedValue:a}){const s=(Array.isArray(e)?e:[e]).filter(Boolean);if(n){const n=s.find(n=>n.props.value===a);return n?(0,t.cloneElement)(n,{className:(0,r.A)("margin-top--md",n.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:s.map((n,e)=>(0,t.cloneElement)(n,{key:e,hidden:n.props.value!==a}))})}function w(n){const e=x(n);return(0,f.jsxs)("div",{className:(0,r.A)(s.G.tabs.container,"tabs-container",v.tabList),children:[(0,f.jsx)(y,{...e,...n}),(0,f.jsx)(j,{...e,...n})]})}function A(n){const e=(0,b.A)();return(0,f.jsx)(w,{...n,children:h(n.children)},String(e))}},18041:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>u,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"developers-guide/transactions","title":"Performing Transactions","description":"{/*","source":"@site/versioned_docs/version-3.0.0/developers-guide/transactions.md","sourceDirName":"developers-guide","slug":"/developers-guide/transactions","permalink":"/docs/ignite3/3.0.0/developers-guide/transactions","draft":false,"unlisted":false,"tags":[],"version":"3.0.0","frontMatter":{"title":"Performing Transactions","sidebar_label":"Performing Transactions"},"sidebar":"tutorialSidebar","previous":{"title":"Object Serialization","permalink":"/docs/ignite3/3.0.0/developers-guide/compute/serialization"},"next":{"title":"Streaming Data","permalink":"/docs/ignite3/3.0.0/developers-guide/data-streamer"}}');var r=a(74848),s=a(28453),c=a(11470),o=a(19365);const i={title:"Performing Transactions",sidebar_label:"Performing Transactions"},l=void 0,u={},d=[{value:"Transaction Lifecycle",id:"transaction-lifecycle",level:2},{value:"Transaction Isolation and Concurrency",id:"transaction-isolation-and-concurrency",level:2},{value:"Deadlock Prevention",id:"deadlock-prevention",level:3},{value:"Executing Transactions",id:"executing-transactions",level:2},{value:"Transaction Management",id:"transaction-management",level:2},{value:"Read-Only Transactions",id:"read-only-transactions",level:2},{value:"Transaction Timeout",id:"transaction-timeout",level:2}];function h(n){const e={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:["\n","\n",(0,r.jsx)(e.p,{children:"All queries in Apache Ignite are transactional. You can provide an explicit transaction as a first argument of any Table and SQL API call. If you do not provide an explicit transaction, an implicit one will be created for every call."}),"\n",(0,r.jsx)(e.h2,{id:"transaction-lifecycle",children:"Transaction Lifecycle"}),"\n",(0,r.jsxs)(e.p,{children:["When the transaction is created, the node that the transaction was started from is chosen as ",(0,r.jsx)(e.strong,{children:"transaction coordinator"}),". The coordinator finds the required partitions and sends the read or write requests to the nodes holding primary partitions. For correct transaction operation, all nodes in cluster must have similar time, that can be different by no more than ",(0,r.jsx)(e.code,{children:"schemaSync.maxClockSkewMillis"}),"."]}),"\n",(0,r.jsxs)(e.p,{children:["If the key is not locked by a different transaction, the node gets the locks on the involved keys, and attempts to apply the changes in the transaction. When the operation finishes, the lock is removed. This way, several transactions can work on the same partition, while changing separate keys. Additionally, some operations may perform ",(0,r.jsx)(e.strong,{children:"short-term"})," locks on the keys in advance, to ensure operations proceed correctly."]}),"\n",(0,r.jsxs)(e.p,{children:["If the node with the primary replica of a partition involved in the transaction fails, the transaction is eventually automatically rolled back. Apache Ignite will return ",(0,r.jsx)(e.code,{children:"TransactionException"})," on commit attempt."]}),"\n",(0,r.jsx)(e.h2,{id:"transaction-isolation-and-concurrency",children:"Transaction Isolation and Concurrency"}),"\n",(0,r.jsxs)(e.p,{children:["All read-write transactions in Apache Ignite acquire locks during the first read or write access, and hold the lock until the transaction is committed or rolled back. All read-write transactions are ",(0,r.jsx)(e.code,{children:"SERIALIZABLE"}),", so as long as the lock persists, no other transaction can make changes to locked data, however data can still be read by ",(0,r.jsx)(e.a,{href:"#read-only-transactions",children:"Read-Only Transactions"}),"."]}),"\n",(0,r.jsx)(e.h3,{id:"deadlock-prevention",children:"Deadlock Prevention"}),"\n",(0,r.jsxs)(e.p,{children:["Apache Ignite uses the ",(0,r.jsx)(e.code,{children:"WAIT_DIE"})," deadlock prevention algorithm. When a newer transaction requests data that is already locked by a different transaction, it is cancelled and the transaction operation is retried with the same timestamp. If the transaction is older, it is not cancelled and is allowed to wait for the lock to be freed."]}),"\n",(0,r.jsx)(e.h2,{id:"executing-transactions",children:"Executing Transactions"}),"\n",(0,r.jsx)(e.p,{children:"Here is how you  can provide a transaction explicitly:"}),"\n",(0,r.jsxs)(c.A,{groupId:"programming-languages",children:[(0,r.jsx)(o.A,{value:"java",label:"Java",children:(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"KeyValueView<Long, Account> accounts =\n  table.keyValueView(Mapper.of(Long.class), Mapper.of(Account.class));\n\naccounts.put(null, 42, new Account(16_000));\n\nvar tx = client.transactions().begin();\n\nAccount account = accounts.get(tx, 42);\naccount.balance += 500;\naccounts.put(tx, 42, account);\n\nassert accounts.get(tx, 42).balance == 16_500;\n\ntx.rollback();\n\nassert accounts.get(tx, 42).balance == 16_000;\n"})})}),(0,r.jsx)(o.A,{value:"dotnet",label:".NET",children:(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:"var accounts = table.GetKeyValueView<long, Account>();\nawait accounts.PutAsync(transaction: null, 42, new Account(16_000));\n\nawait using ITransaction tx = await client.Transactions.BeginAsync();\n\n(Account account, bool hasValue) = await accounts.GetAsync(tx, 42);\naccount = account with { Balance = account.Balance + 500 };\n\nawait accounts.PutAsync(tx, 42, account);\n\nDebug.Assert((await accounts.GetAsync(tx, 42)).Value.Balance == 16_500);\n\nawait tx.RollbackAsync();\n\nDebug.Assert((await accounts.GetAsync(null, 42)).Value.Balance == 16_000);\n\npublic record Account(decimal Balance);\n"})})}),(0,r.jsx)(o.A,{value:"cpp",label:"C++",children:(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-cpp",children:"auto accounts = table.get_key_value_view<account, account>();\n\naccount init_value(42, 16'000);\naccounts.put(nullptr, {42}, init_value);\n\nauto tx = client.get_transactions().begin();\n\nstd::optional<account> res_account = accounts.get(&tx, {42});\nres_account->balance += 500;\naccounts.put(&tx, {42}, res_account);\n\nassert(accounts.get(&tx, {42})->balance == 16'500);\n\ntx.rollback();\n\nassert(accounts.get(&tx, {42})->balance == 16'000);\n"})})})]}),"\n",(0,r.jsx)(e.h2,{id:"transaction-management",children:"Transaction Management"}),"\n",(0,r.jsxs)(e.p,{children:["You can also manage transactions by using the ",(0,r.jsx)(e.code,{children:"runInTransaction"})," method. When using it, the following will be done automatically:"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"The transaction is started and substituted to the closure."}),"\n",(0,r.jsx)(e.li,{children:"The transaction is committed if no exceptions were thrown during the closure."}),"\n",(0,r.jsx)(e.li,{children:"The transaction will be retried in case of recoverable error. Closure must be purely functional, not causing side effects."}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"You can run transactions both synchronously and asynchronously."}),"\n",(0,r.jsx)(e.p,{children:"This example shows how to update an account's balance synchronously:"}),"\n",(0,r.jsx)(c.A,{groupId:"programming-languages",children:(0,r.jsx)(o.A,{value:"java",label:"Java",children:(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"client.transactions().runInTransaction(tx -> {\n    Account acct = accounts.get(tx, key);\n    if (acct != null) {\n        acct.balance += 200.0d;\n    }\n    accounts.put(tx, key, acct);\n});\n\n"})})})}),"\n",(0,r.jsx)(e.p,{children:"And this example performs the same logic in an asynchronous manner:"}),"\n",(0,r.jsx)(c.A,{groupId:"programming-languages",children:(0,r.jsx)(o.A,{value:"java",label:"Java",children:(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"CompletableFuture<Void> future = client.transactions().runInTransactionAsync(tx ->\n        accounts.getAsync(tx, key)\n                .thenCompose(acct -> {\n                    acct.balance += 300.0d;\n                    return accounts.putAsync(tx, key, acct);\n                })\n);\nfuture.join();\n"})})})}),"\n",(0,r.jsx)(e.h2,{id:"read-only-transactions",children:"Read-Only Transactions"}),"\n",(0,r.jsxs)(e.p,{children:["When starting a transaction, you can configure the transaction as a ",(0,r.jsx)(e.strong,{children:"read-only"})," transaction. In these transactions, no data modification can be performed, but they also do not secure locks and can be performed on non-primary partitions, further improving their performance. Read-only transactions always check the data for the moment they were started, even if new data was written to the database."]}),"\n",(0,r.jsx)(e.p,{children:"Here is how you can make a read-only transaction:"}),"\n",(0,r.jsxs)(c.A,{groupId:"programming-languages",children:[(0,r.jsx)(o.A,{value:"java",label:"Java",children:(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"var tx = client.transactions().begin(new TransactionOptions().readOnly(true));\nint balance = accounts.get(tx, 42).balance;\ntx.commit();\n"})})}),(0,r.jsx)(o.A,{value:"dotnet",label:".NET",children:(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:"await using var tx = await client.Transactions.BeginAsync(\n    new TransactionOptions { ReadOnly = true });\nvar account = await accounts.GetAsync(tx, 42);\nint balance = account.Value.Balance;\nawait tx.CommitAsync();\n"})})}),(0,r.jsx)(o.A,{value:"cpp",label:"C++",children:(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-cpp",children:"auto tx_opts = transaction_options()\n        .set_read_only(true);\n\nauto tx = m_client.get_transactions().begin(tx_opts);\n\nrecord_view.get(&tx, 42);\n\ntx.commit();\n"})})})]}),"\n",(0,r.jsx)(e.admonition,{type:"note",children:(0,r.jsx)(e.p,{children:"Read-only transactions read data at a specific time. If new data was written since, old data will still be stored in Version Storage and will be available until low watermark. If low watermark is reached during the transaction, data will be kept available until it is over."})}),"\n",(0,r.jsx)(e.h2,{id:"transaction-timeout",children:"Transaction Timeout"}),"\n",(0,r.jsx)(e.p,{children:"In certain scenarios, it is preferable to drop the transaction if it is taking too long. When the timeout is reached, the transaction is automatically rolled back."}),"\n",(0,r.jsx)(e.p,{children:"Here is how you can configure transaction timeout:"}),"\n",(0,r.jsxs)(c.A,{groupId:"programming-languages",children:[(0,r.jsx)(o.A,{value:"java",label:"Java",children:(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"KeyValueView<Long, Account> accounts =\n  table.keyValueView(Mapper.of(Long.class), Mapper.of(Account.class));\n\nvar tx = client.transactions().begin(new TransactionOptions().timeoutMillis(10000));\naccounts.put(tx, 42, account);\ntx.commit();\n"})})}),(0,r.jsx)(o.A,{value:"dotnet",label:".NET",children:(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:"await using var tx = await Client.Transactions.BeginAsync(\n    new TransactionOptions { TimeoutMillis = 10_000 });\nawait accounts.PutAsync(tx, 42, account);\nawait tx.CommitAsync();\n"})})}),(0,r.jsx)(o.A,{value:"cpp",label:"C++",children:(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-cpp",children:"auto accounts = table.get_key_value_view<account, account>();\n\nauto tx_opts = transaction_options()\n       .set_timeout_millis(10000);\n\nauto tx = m_client.get_transactions().begin(tx_opts);\n\nrecord_view.insert(&tx, 42);\n\ntx.commit();\n"})})})]})]})}function p(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(h,{...n})}):h(n)}},19365:(n,e,a)=>{a.d(e,{A:()=>c});a(96540);var t=a(34164);const r={tabItem:"tabItem_Ymn6"};var s=a(74848);function c({children:n,hidden:e,className:a}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,t.A)(r.tabItem,a),hidden:e,children:n})}},28453:(n,e,a)=>{a.d(e,{R:()=>c,x:()=>o});var t=a(96540);const r={},s=t.createContext(r);function c(n){const e=t.useContext(s);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:c(n.components),t.createElement(s.Provider,{value:e},n.children)}}}]);