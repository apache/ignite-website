<!DOCTYPE html>

      
      
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Bugyard widget embed -->
    <script type="text/javascript">
        !function(){
            if("function" != typeof window.bugyard){
                var a = function(){ a.c(arguments) };
                a.q = [], a.c = function(b){ a.q.push(b) };
                window.bugyard = a;

                var b = document.createElement("script");
                b.setAttribute("data-bugyard", "610961912c35ff001493163a");
                b.setAttribute("async", "async");
                b.setAttribute("defer", "defer");
                b.setAttribute("src", "/assets/js/bugyard.min.js");
                document.getElementsByTagName("head")[0].appendChild(b);
            }
        }();
        window.bugyard("hideButton");
    </script>
    <!-- Bugyard widget embed -->

    <link rel="preload" href='/assets/js/code-tabs.js?1' as="script" crossorigin>
    <link rel="preload" href='/assets/js/page-nav.js' as="script" crossorigin>
    <link rel="preload" href='/assets/js/docs-menu.js?20201005' as="script" crossorigin>

    <style>:root{--gg-red:#ec1c24;--gg-orange:#ec1c24;--gg-orange-dark:#bc440b;--gg-orange-filter:invert(47%) sepia(61%) saturate(1950%) hue-rotate(345deg) brightness(100%) contrast(95%);--gg-dark-gray:#333333;--orange-line-thickness:3px;--block-code-background:rgba(241, 241, 241, 20%);--inline-code-background:rgba(241, 241, 241, 90%);--padding-top:25px;--link-color:#ec1c24;--body-background:#fcfcfc}header{min-height:var(--header-height);background:#fff;box-shadow:0 4px 10px 0 #eee,0 0 4px 0 #d5d5d5;z-index:1}header>.container{display:grid;grid-template-columns:auto auto 1fr auto auto auto;grid-template-areas:'left-toggle home nav ver api search lang';grid-template-rows:40px;flex-direction:row;align-items:center;justify-content:flex-start;padding:12px 20px;max-width:1400px;margin:0 auto}header nav>ul{padding:0;margin:0;list-style:none;display:inherit}header .dropdown{display:none;position:fixed;top:calc(var(--header-height) - 12px);width:auto;background:#fff;box-shadow:0 4px 4px 0 rgba(0,0,0,.24),0 0 4px 0 rgba(0,0,0,.12);border-radius:4px;padding-top:10px;padding-bottom:12px;z-index:2}header .dropdown li{display:flex}header .dropdown a{color:grey!important;font-size:16px;padding-top:5px;padding-bottom:4px}header .menu{border:none;background:0 0;width:40px;height:40px;margin-right:12px;grid-area:left-toggle}header .menu img{width:18px;height:12px}header .search-close,header .top-nav-toggle{background:0 0;border:none;padding:0;width:36px;height:36px;display:inline-flex;align-items:center;justify-content:center;color:var(--gg-dark-gray);font-size:26px}header .search-toggle{grid-area:search}header .top-nav-toggle{grid-area:top-toggle}header .home{grid-area:home;margin-right:auto}header .home img{height:36px}header #api-docs{grid-area:api;margin:0;display:flex}header #api-docs .dropdown{padding:.5em 0}header #api-docs a{padding:9px 14px;color:var(--gg-dark-gray)!important;text-decoration:none;white-space:nowrap}header #api-docs .dropdown-item a{font-weight:400;display:block;width:100%;min-width:150px}header #lang-selector li{list-style:none;display:flex;padding:9px 14px}header #lang-selector li a{display:flex;color:#000;align-items:center}header #lang-selector li a span{font-size:10px;margin-left:5px}header #lang-selector li a img{width:25px}header #lang-selector li .dropdown{margin-left:-70px}header #lang-selector li .dropdown .dropdown-item{padding:0 1em;margin-bottom:8px}header #lang-selector li .dropdown .dropdown-item a span{font-size:14px}header .search{margin-left:auto;margin-right:20px;grid-area:search}header .search input[type=search]{color:var(--gg-dark-gray);background:rgba(255,255,255,.8);border:1px solid #ccc;padding:10px 15px;font-family:inherit;max-width:148px;height:37px;font-size:14px;-webkit-appearance:unset;appearance:unset}header #version-selector{list-style:none;grid-area:ver;line-height:28px;border-radius:0;margin-right:10px;border:none;color:var(--gg-dark-gray);padding:5px 16px 5px 10px;white-space:nowrap;font-size:14px;width:auto;text-align:right;box-sizing:border-box;text-align-last:right;-moz-appearance:none;-webkit-appearance:none;appearance:none;direction:rtl}header #version-selector option{direction:ltr}header>nav{grid-area:nav;font-size:18px;display:flex;flex-direction:row;margin:0 20px}header #lang-selector{grid-area:lang}header .search-close{margin-right:10px}@media (max-width:600px){header .search{margin-right:5px}header .search input[type=search]{max-width:110px}}header:not(.narrow-header) .search-close,header:not(.narrow-header) .top-nav-toggle{display:none}@media (max-width:670px){header>.container{grid-template-columns:auto 1fr auto;grid-template-areas:'left-toggle home search' 'ver api lang'}header #lang-selector li{justify-content:flex-end}}pre,pre.rouge{padding:8px 15px;background:var(--block-code-background)!important;border-radius:5px;border:1px solid #e5e5e5;overflow-x:auto;min-height:36px;line-height:18px;color:#545454}code{color:#545454}pre.rouge code{background:0 0!important}:not(pre)>code{background:var(--inline-code-background);padding:.1em .5em;background-clip:padding-box;border-radius:3px;color:#545454;font-size:90%}.listingblock .content{position:relative}.highlight{color:#586e75}.highlight .c1{color:#657b83}.highlight .nt{color:#b58900}.highlight .o{color:#93a1a1}.highlight .k{color:#6c71c4}.highlight .kt{color:#cb4b16}.highlight .s,.highlight .s1{color:#859900}.highlight .nc{color:#b58900}.highlight .na{color:#268bd2}body{font-family:'Open Sans',sans-serif}h1,h2{color:#000;font-weight:400;font-family:'Open Sans'}h1{font-size:36px;line-height:40px}a{text-decoration:none;color:var(--link-color)}section{color:#545454}.admonitionblock .icon .title{display:none}body{--header-height:64px;--promotion-bar-height:35px;--footer-height:104px;--footer-gap:60px;padding:0;margin:0;display:flex;flex-direction:column;min-height:100vh;background-color:var(--body-background);font-family:'Open Sans',sans-serif}body>section{flex:1}header{position:-webkit-sticky;position:sticky;top:0;z-index:2}*{box-sizing:border-box}@media (max-width:670px){body{--header-height:97px}}.left-nav{padding:10px 20px;width:289px;overflow-y:auto;top:calc(var(--header-height) + var(--promotion-bar-height));height:calc(100vh - var(--header-height) - var(--promotion-bar-height));font-family:'Open Sans';padding-top:var(--padding-top);background-color:var(--body-background)}.left-nav li{list-style:none}.left-nav a,.left-nav button{text-decoration:none;color:#757575;font-size:16px;display:inline-flex;width:100%;margin:2px 0;padding:.25em .375em;background:0 0;border:none;font:inherit;text-align:left}.left-nav a.active{color:var(--link-color)}.left-nav .nav-group{margin-left:6px;font-size:14px}.left-nav nav{border-left:2px solid #ddd;margin-bottom:5px}.left-nav nav.collapsed{display:none}.left-nav nav>li>a,.left-nav nav>li>button{padding-left:20px;text-align:left}.left-nav nav>li>a.active{border-left:var(--orange-line-thickness) solid var(--active-color);padding-left:calc(20px - var(--orange-line-thickness))}.left-nav nav.sub_pages{border:none}.left-nav nav.sub_pages a{padding-left:32px}.left-nav .state-indicator{margin-left:auto;margin-top:5px;width:6.2px;height:10px;flex:0 0 auto;filter:invert(49%) sepia(4%) saturate(5%) hue-rotate(23deg) brightness(92%) contrast(90%)}.left-nav button.expanded .state-indicator{transform:rotate(90deg)}.right-nav{width:289px;padding:12px 26px;overflow-y:auto;height:calc(100vh - var(--header-height));top:0;position:-webkit-sticky;position:sticky;display:flex;flex-direction:column;font-family:'Open sans';padding-top:var(--padding-top);background-color:#fff}.right-nav ul{list-style:none;padding:0;margin:0}.right-nav li{padding:0}.right-nav a{--border-width:0px;font-size:14px;color:#757575;padding-left:calc(15px * var(--nesting-level) + 8px - var(--border-width));margin:.3em 0;display:inline-block}.right-nav .sectlevel1{border-left:2px solid #ddd}.right-nav .sectlevel1{--nesting-level:0}.right-nav .sectlevel2{--nesting-level:1}.right-nav .sectlevel3{--nesting-level:2}@media (max-width:1200px){.right-nav{width:230px}}.right-nav footer{font-size:12px;padding:calc(var(--footer-gap) * .3) 0 5px;text-align:left;margin:auto 0 0}section.page-docs{display:grid;grid-template-columns:auto 1fr auto;grid-template-rows:100%;grid-template-areas:'left-nav content right-nav';line-height:20px;max-width:1440px;margin:auto;width:100%}section.page-docs>article{border-left:1px solid #eee;background-color:#fff;padding:0 50px 30px;grid-area:content;overflow:hidden;font-family:sans-serif;font-size:16px;color:#545454;line-height:1.6em}section.page-docs>article h1,section.page-docs>article h2{font-family:'Open Sans'}@media (max-width:800px){section.page-docs>article{padding-left:15px;padding-right:15px}}section.page-docs .edit-link{position:relative;top:10px;right:10px;float:right;padding-top:calc(var(--header-height) + var(--padding-top));margin-top:calc((-1 * var(--header-height)))}section.page-docs h1,section.page-docs h2{margin-bottom:0}section.page-docs h2[id]{margin-top:var(--margin-top);margin-bottom:calc(var(--margin-top) * .5);z-index:-1}section.page-docs .title{font-style:italic}section.page-docs h2[id]{--margin-top:1.2em}.left-nav{bottom:0;position:-webkit-sticky;position:sticky}.left-nav{grid-area:left-nav}.right-nav{grid-area:right-nav}.left-nav__overlay{display:none;background:rgba(0,0,0,.5);z-index:1;position:fixed;top:var(--header-height);bottom:0;left:0;right:0}@media (max-width:990px){body:not(.hide-left-nav) .left-nav__overlay{display:block}nav.left-nav{background:#fafafa;grid-area:left-nav;box-shadow:0 4px 4px 0 rgba(0,0,0,.24),0 0 4px 0 rgba(0,0,0,.12);min-height:calc(100vh - var(--header-height));max-height:calc(100vh - var(--header-height));position:fixed;bottom:0;top:var(--header-height);z-index:2}section.page-docs>article{grid-column-start:left-nav;grid-column-end:content;grid-row:content}}@media (max-width:800px){nav.right-nav{display:none}}:target:before{content:"";display:block;margin-top:calc(var(--header-height) * -1);height:var(--header-height);width:1px}@media (min-width:600px) and (max-width:900px){:target:before{content:"";display:block;width:1px;margin-top:-150px;height:150px}}
#header #promotion-bar { background-color: #333333; padding: 8px; }
#header #promotion-bar p { font-size: 14px; line-height: 1.4em; font-weight: 600; padding: 0; margin: 0; color: #f0f0f0; text-align: center;}
#header #promotion-bar p a { color: #FCB903; } </style>

    

    
    <meta name="ignite-version" content="3.1.0" />
    <title>How to Improve Queries With EXPLAIN Command | Ignite Documentation</title>
    
    <link rel="canonical" href="/docs/latest/sql-tuning/using-explain" />
    
	
	  <link rel="shortcut icon" href="/favicon.ico">
    <meta name='viewport' content='width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0'>

    <link rel="preload" as="style" href="/assets/css/fonts.css" />
    <link rel="stylesheet" href="/assets/css/fonts.css" media="print" onload="this.media='all'">
    <noscript>
        <link rel="stylesheet" href="/assets/css/fonts.css">
    </noscript>
    <link href="/docs/pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/docs/pagefind/pagefind-ui.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', () => {
            new PagefindUI({
                element: "#search",
                showSubResults: true,
                showImages: false,
            });
        });
    </script>
    <script src="/assets/js/mermaid.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const blocks = document.querySelectorAll('.mermaid');
            if (blocks.length) {
                mermaid.initialize({ startOnLoad: false });
                mermaid.run();
            }
        });
    </script>

	<script>
    // AnchorJS - v4.2.0 - 2019-01-01
    // https://github.com/bryanbraun/anchorjs
    // Copyright (c) 2019 Bryan Braun; Licensed MIT
    !function(A,e){"use strict";"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():(A.AnchorJS=e(),A.anchors=new A.AnchorJS)}(this,function(){"use strict";return function(A){function f(A){A.icon=A.hasOwnProperty("icon")?A.icon:"",A.visible=A.hasOwnProperty("visible")?A.visible:"hover",A.placement=A.hasOwnProperty("placement")?A.placement:"right",A.ariaLabel=A.hasOwnProperty("ariaLabel")?A.ariaLabel:"Anchor",A.class=A.hasOwnProperty("class")?A.class:"",A.base=A.hasOwnProperty("base")?A.base:"",A.truncate=A.hasOwnProperty("truncate")?Math.floor(A.truncate):64,A.titleText=A.hasOwnProperty("titleText")?A.titleText:""}function p(A){var e;if("string"==typeof A||A instanceof String)e=[].slice.call(document.querySelectorAll(A));else{if(!(Array.isArray(A)||A instanceof NodeList))throw new Error("The selector provided to AnchorJS was invalid.");e=[].slice.call(A)}return e}this.options=A||{},this.elements=[],f(this.options),this.isTouchDevice=function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)},this.add=function(A){var e,t,i,n,o,s,a,r,c,h,l,u,d=[];if(f(this.options),"touch"===(l=this.options.visible)&&(l=this.isTouchDevice()?"always":"hover"),A||(A="h2, h3, h4, h5, h6"),0===(e=p(A)).length)return this;for(function(){if(null===document.head.querySelector("style.anchorjs")){var A,e=document.createElement("style");e.className="anchorjs",e.appendChild(document.createTextNode("")),void 0===(A=document.head.querySelector('[rel="stylesheet"], style'))?document.head.appendChild(e):document.head.insertBefore(e,A),e.sheet.insertRule(" .anchorjs-link {   opacity: 0;   text-decoration: none;   -webkit-font-smoothing: antialiased;   -moz-osx-font-smoothing: grayscale; }",e.sheet.cssRules.length),e.sheet.insertRule(" *:hover > .anchorjs-link, .anchorjs-link:focus  {   opacity: 1; }",e.sheet.cssRules.length),e.sheet.insertRule(" [data-anchorjs-icon]::after {   content: attr(data-anchorjs-icon); }",e.sheet.cssRules.length),e.sheet.insertRule(' @font-face {   font-family: "anchorjs-icons";   src: url(data:n/a;base64,AAEAAAALAIAAAwAwT1MvMg8yG2cAAAE4AAAAYGNtYXDp3gC3AAABpAAAAExnYXNwAAAAEAAAA9wAAAAIZ2x5ZlQCcfwAAAH4AAABCGhlYWQHFvHyAAAAvAAAADZoaGVhBnACFwAAAPQAAAAkaG10eASAADEAAAGYAAAADGxvY2EACACEAAAB8AAAAAhtYXhwAAYAVwAAARgAAAAgbmFtZQGOH9cAAAMAAAAAunBvc3QAAwAAAAADvAAAACAAAQAAAAEAAHzE2p9fDzz1AAkEAAAAAADRecUWAAAAANQA6R8AAAAAAoACwAAAAAgAAgAAAAAAAAABAAADwP/AAAACgAAA/9MCrQABAAAAAAAAAAAAAAAAAAAAAwABAAAAAwBVAAIAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAMCQAGQAAUAAAKZAswAAACPApkCzAAAAesAMwEJAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAQAAg//0DwP/AAEADwABAAAAAAQAAAAAAAAAAAAAAIAAAAAAAAAIAAAACgAAxAAAAAwAAAAMAAAAcAAEAAwAAABwAAwABAAAAHAAEADAAAAAIAAgAAgAAACDpy//9//8AAAAg6cv//f///+EWNwADAAEAAAAAAAAAAAAAAAAACACEAAEAAAAAAAAAAAAAAAAxAAACAAQARAKAAsAAKwBUAAABIiYnJjQ3NzY2MzIWFxYUBwcGIicmNDc3NjQnJiYjIgYHBwYUFxYUBwYGIwciJicmNDc3NjIXFhQHBwYUFxYWMzI2Nzc2NCcmNDc2MhcWFAcHBgYjARQGDAUtLXoWOR8fORYtLTgKGwoKCjgaGg0gEhIgDXoaGgkJBQwHdR85Fi0tOAobCgoKOBoaDSASEiANehoaCQkKGwotLXoWOR8BMwUFLYEuehYXFxYugC44CQkKGwo4GkoaDQ0NDXoaShoKGwoFBe8XFi6ALjgJCQobCjgaShoNDQ0NehpKGgobCgoKLYEuehYXAAAADACWAAEAAAAAAAEACAAAAAEAAAAAAAIAAwAIAAEAAAAAAAMACAAAAAEAAAAAAAQACAAAAAEAAAAAAAUAAQALAAEAAAAAAAYACAAAAAMAAQQJAAEAEAAMAAMAAQQJAAIABgAcAAMAAQQJAAMAEAAMAAMAAQQJAAQAEAAMAAMAAQQJAAUAAgAiAAMAAQQJAAYAEAAMYW5jaG9yanM0MDBAAGEAbgBjAGgAbwByAGoAcwA0ADAAMABAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAH//wAP) format("truetype"); }',e.sheet.cssRules.length)}}(),t=document.querySelectorAll("[id]"),i=[].map.call(t,function(A){return A.id}),o=0;o<e.length;o++)if(this.hasAnchorJSLink(e[o]))d.push(o);else{if(e[o].hasAttribute("id"))n=e[o].getAttribute("id");else if(e[o].hasAttribute("data-anchor-id"))n=e[o].getAttribute("data-anchor-id");else{for(c=r=this.urlify(e[o].textContent),a=0;void 0!==s&&(c=r+"-"+a),a+=1,-1!==(s=i.indexOf(c)););s=void 0,i.push(c),e[o].setAttribute("id",c),n=c}n.replace(/-/g," "),(h=document.createElement("a")).className="anchorjs-link "+this.options.class,h.setAttribute("aria-label",this.options.ariaLabel),h.setAttribute("data-anchorjs-icon",this.options.icon),this.options.titleText&&(h.title=this.options.titleText),u=document.querySelector("base")?window.location.pathname+window.location.search:"",u=this.options.base||u,h.href=u+"#"+n,"always"===l&&(h.style.opacity="1"),""===this.options.icon&&(h.style.font="1em/1 anchorjs-icons","left"===this.options.placement&&(h.style.lineHeight="inherit")),"left"===this.options.placement?(h.style.position="absolute",h.style.marginLeft="-1em",h.style.paddingRight="0.5em",e[o].insertBefore(h,e[o].firstChild)):(h.style.paddingLeft="0.375em",e[o].appendChild(h))}for(o=0;o<d.length;o++)e.splice(d[o]-o,1);return this.elements=this.elements.concat(e),this},this.remove=function(A){for(var e,t,i=p(A),n=0;n<i.length;n++)(t=i[n].querySelector(".anchorjs-link"))&&(-1!==(e=this.elements.indexOf(i[n]))&&this.elements.splice(e,1),i[n].removeChild(t));return this},this.removeAll=function(){this.remove(this.elements)},this.urlify=function(A){return this.options.truncate||f(this.options),A.trim().replace(/\'/gi,"").replace(/[& +$,:;=?@"#{}|^~[`%!'<>\]\.\/\(\)\*\\\n\t\b\v]/g,"-").replace(/-{2,}/g,"-").substring(0,this.options.truncate).replace(/^-+|-+$/gm,"").toLowerCase()},this.hasAnchorJSLink=function(A){var e=A.firstChild&&-1<(" "+A.firstChild.className+" ").indexOf(" anchorjs-link "),t=A.lastChild&&-1<(" "+A.lastChild.className+" ").indexOf(" anchorjs-link ");return e||t||!1}}});
    </script>
  
</head>
<body>
    <header>
    <!--#include virtual="/includes/promotion_banner.html" -->
    <div class="container">
        <button type='button' class='menu' title='Docs menu'>
        <img src="/assets/images/menu-icon.svg" width="18" height="12" alt="menu icon" />
        </button>
        <div class='home'>
            <a href="/" class='home' title='Apache Ignite home'>
                <img src="/assets/images/apache_ignite_logo.svg" alt="Apache Ignite logo" width="103" height="36" >
            </a>
        </div>

        
        
        <select id="product-selector">
            <option value="/docs/ignite2/latest" >Ignite 2</option>
            <option value="/docs/ignite3/latest"selected>Ignite 3</option>
        </select>

        <select id="version-selector">
            <option value="3.1.0">3.1.0</option>
        </select>


        <nav id="api-docs"><ul>
            <li><a href="#">APIs</a>
                <nav class='dropdown'>
                    <ul>
                    
                    <li class="dropdown-item"><a href="/releases/ignite3/3.1.0/javadoc/">Java</a></li>
                    <li class="dropdown-item"><a href="/releases/ignite3/3.1.0/dotnetdoc/">C#/.NET</a></li>
                    <li class="dropdown-item"><a href="/releases/ignite3/3.1.0/cppdoc/">C++</a></li>
                    <li class="dropdown-item"><a href="/releases/ignite3/3.1.0/openapi.yaml">OpenAPI</a></li>
                    
                    </ul>
                </nav>
            </li>

            <li><a href="#">Examples</a>
                <nav class="dropdown">
                    <ul>
                    <li class="dropdown-item"><a href="https://github.com/apache/ignite/tree/master/examples" target="_blank" rel="noopener" title="Apache Ignite Java examples">Java</a></li>

                    <li class="dropdown-item"><a href="https://github.com/apache/ignite/tree/master/modules/platforms/dotnet/examples" target="_blank" rel="noopener" title="Apache Ignite C#/.NET examples">C#/.NET</a></li>

                    <li class="dropdown-item"><a href="https://github.com/apache/ignite/tree/master/modules/platforms/cpp/examples" target="_blank" rel="noopener" title="Apache Ignite C++ examples">C++</a></li>

                    <li class="dropdown-item"><a href="https://github.com/apache/ignite/tree/master/modules/platforms/python/examples" target="_blank" rel="noopener" title="Apache Ignite Python examples">Python</a></li>

                    <li class="dropdown-item"><a href="https://github.com/apache/ignite/tree/master/modules/platforms/nodejs/examples" target="_blank" rel="noopener" title="Apache Ignite NodeJS examples">NodeJS</a></li>

                    <li class="dropdown-item"><a href="https://github.com/apache/ignite/tree/master/modules/platforms/php/examples" target="_blank" rel="noopener" title="Apache Ignite PHP examples">PHP</a></li>
                </ul>
                </nav>
                </li></ul>
        </nav>



        <div id="search-button"></div>

        <nav id="lang-selector"><ul>
            <li><a href="#"><img src="/assets/images/icon_lang_en_75x75.jpg" alt="English language icon"  width="25" height="25" /><span>▼</span></a>
                <nav class="dropdown">
                    <li class="dropdown-item"><a href="/docs/latest/" ><img src="/assets/images/icon_lang_en_75x75.jpg" alt="English language icon" width="25" height="25" /><span>English</span></a></li>
                    <li class="dropdown-item"><a href="https://www.ignite-service.cn/doc/java/" target="_blank" rel="noopener"><img src="/assets/images/icon_lang_cn_75x75.jpg"  width="25" height="25" alt="Chinese language icon" /><span>Chinese</span></a></li>
                </nav>
            </li></ul>
        </nav>

        <button type='button' class='top-nav-toggle'>⋮</button>
        
    </div>
    <div id="search-wrapper">
        <div id="search"></div>
    </div>
</header>

    	 <link rel="stylesheet" href="/assets/css/docs.css">
<section class='page-docs'>
    





<nav class='left-nav' data-swiftype-index='false'>
    
    
        <li>
            
                
                <a href="/docs/ignite3/latest/index" class='' >About Apache Ignite 3</a>
            
        </li>
    
        <li>
            

            

            

			<button type='button' class='group-toggle collapsed '>Installation<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"  width="6" height="10"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/installation/installing-using-zip"
                                class=''
                            >Installing Using ZIP Archive</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/installation/deb-rpm"
                                class=''
                            >Installing DEB or RPM package</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/installation/installing-using-docker"
                                class=''
                            >Installing Docker</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>Migration From Ignite 2<img class="state-indicator" src="/assets/images/left-nav-arrow.svg" width="6" height="10"></button>
                            <nav class="sub_pages collapsed">

                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/installation/migration-from-ai2/config" class=''>Configuration Migration</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/installation/migration-from-ai2/persistent-migration" class=''>Persistent Data Migration</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/installation/migration-from-ai2/ai2-functions" class=''>SQL Function Comparison</a></li>
                            
                            </nav>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            

            

			<button type='button' class='group-toggle collapsed '>Getting Started<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"  width="6" height="10"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/quick-start/getting-started-guide"
                                class=''
                            >Quick Start</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/quick-start/start-cluster"
                                class=''
                            >Start Ignite 3 Cluster</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/quick-start/explore-sql"
                                class=''
                            >Explore SQL Capabilities</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/quick-start/persist-data"
                                class=''
                            >Persist Your Data</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/quick-start/java-api"
                                class=''
                            >Use Java API</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            
                
                <a href="/docs/ignite3/latest/quick-start/embedded-mode" class='' >Embedded Mode</a>
            
        </li>
    
        <li>
            
                
                <a href="/docs/ignite3/latest/ignite-cli-tool" class='' >Ignite CLI Tool</a>
            
        </li>
    
        <li>
            

            

            

			<button type='button' class='group-toggle collapsed '>Developers Guide<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"  width="6" height="10"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/developers-guide/table-api"
                                class=''
                            >Table API</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>Clients<img class="state-indicator" src="/assets/images/left-nav-arrow.svg" width="6" height="10"></button>
                            <nav class="sub_pages collapsed">

                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/clients/overview" class=''>Overview</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/clients/java" class=''>Java Clients</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/clients/dotnet" class=''>.NET Clients</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/clients/cpp" class=''>C++ Clients</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/clients/python" class=''>Python Clients</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/clients/ado" class=''>ADO.NET Integration</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/clients/linq" class=''>.NET LINQ Queries</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/clients/jdbc-driver" class=''>JDBC Driver</a></li>
                            
                            </nav>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>Working with SQL<img class="state-indicator" src="/assets/images/left-nav-arrow.svg" width="6" height="10"></button>
                            <nav class="sub_pages collapsed">

                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/sql/calcite-based-sql-engine" class=''>Introduction</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/sql/sql-api" class=''>SQL API</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/sql/jdbc-driver" class=''>JDBC Driver</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/sql/odbc/odbc-driver" class=''>ODBC Driver</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/sql/odbc/connection-string" class=''>ODBC Connection String</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/sql/odbc/querying-modifying-data" class=''>Querying and Modifying Data</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/sql/odbc/specification" class=''>Standard Conformance</a></li>
                            
                            </nav>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/developers-guide/java-to-tables"
                                class=''
                            >Tables from Java Classes</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>Distributed Computing<img class="state-indicator" src="/assets/images/left-nav-arrow.svg" width="6" height="10"></button>
                            <nav class="sub_pages collapsed">

                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/compute/compute" class=''>Compute API</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/compute/serialization" class=''>Serialization</a></li>
                            
                            </nav>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/developers-guide/transactions"
                                class=''
                            >Transactions</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/developers-guide/data-streamer"
                                class=''
                            >Data Streaming</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/developers-guide/code-deployment/code-deployment"
                                class=''
                            >Code Deployment</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>Events<img class="state-indicator" src="/assets/images/left-nav-arrow.svg" width="6" height="10"></button>
                            <nav class="sub_pages collapsed">

                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/events/overview" class=''>Overview</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/developers-guide/events/events-list" class=''>Events List</a></li>
                            
                            </nav>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/developers-guide/rest/rest-api"
                                class=''
                            >REST API</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            

            

			<button type='button' class='group-toggle collapsed '>Administrator's Guide<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"  width="6" height="10"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>Ignite Configuration<img class="state-indicator" src="/assets/images/left-nav-arrow.svg" width="6" height="10"></button>
                            <nav class="sub_pages collapsed">

                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/config/node-config" class=''>Node Configuration Parameters</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/config/cluster-config" class=''>Cluster Configuration Parameters</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/config/cli-config" class=''>CLI Configuration</a></li>
                            
                            </nav>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>Distributed Storage<img class="state-indicator" src="/assets/images/left-nav-arrow.svg" width="6" height="10"></button>
                            <nav class="sub_pages collapsed">

                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/storage/storage-overview" class=''>Storage Overview</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/storage/storage-profiles" class=''>Storage Profiles</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/storage/data-partitions" class=''>Data Partitions</a></li>
                            
                            </nav>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>Storage Engines<img class="state-indicator" src="/assets/images/left-nav-arrow.svg" width="6" height="10"></button>
                            <nav class="sub_pages collapsed">

                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/storage/engines/storage-engines" class=''>Storage Engines Overview</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/storage/engines/aipersist" class=''>AIPersist Engine</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/storage/engines/rocksdb" class=''>RocksDB Engine</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/storage/engines/aimem" class=''>AIMem Engine</a></li>
                            
                            </nav>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/administrators-guide/lifecycle"
                                class=''
                            >Cluster Lifecycle</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/administrators-guide/colocation"
                                class=''
                            >Data Colocation</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/administrators-guide/disaster-recovery"
                                class=''
                            >Disaster Recovery for Partitions</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/administrators-guide/system-groups-recovery"
                                class=''
                            >Disaster Recovery for System Groups</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/administrators-guide/cluster-security"
                                class=''
                            >Cluster Security</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>Security and Authentication<img class="state-indicator" src="/assets/images/left-nav-arrow.svg" width="6" height="10"></button>
                            <nav class="sub_pages collapsed">

                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/security/ssl-tls" class=''>SSL/TLS</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/security/authentication" class=''>Authentication</a></li>
                            
                            </nav>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>Metrics and Monitoring<img class="state-indicator" src="/assets/images/left-nav-arrow.svg" width="6" height="10"></button>
                            <nav class="sub_pages collapsed">

                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/metrics/configuring-metrics" class=''>Configuring Metrics</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/metrics/metrics-list" class=''>Metrics List</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/administrators-guide/metrics/system-views" class=''>System Views</a></li>
                            
                            </nav>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/administrators-guide/handling-exceptions"
                                class=''
                            >Handling Exceptions</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            

            

			<button type='button' class='group-toggle collapsed '>SQL Reference<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"  width="6" height="10"></button>
             <nav class='nav-group collapsed'>
            
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/sql-reference/ddl"
                                class=''
                            >Data Definition Language (DDL)</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/sql-reference/dml"
                                class=''
                            >Data Manipulation Language (DML)</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/sql-reference/transactions"
                                class=''
                            >Transactions</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/sql-reference/distribution-zones"
                                class=''
                            >Distribution Zones</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/sql-reference/data-types"
                                class=''
                            >Data Types</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/sql-reference/operators-and-functions"
                                class=''
                            >Supported Operators and Functions</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/sql-reference/operational-commands"
                                class=''
                            >Operational Commands</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/sql-reference/grammar-reference"
                                class=''
                            >Grammar Reference</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/sql-reference/keywords"
                                class=''
                            >Keywords</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/sql-reference/sql-conformance"
                                class=''
                            >SQL Conformance</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            
                            
                            <button
                                type='button'
                                class='collapsed '>Explain Statement<img class="state-indicator" src="/assets/images/left-nav-arrow.svg" width="6" height="10"></button>
                            <nav class="sub_pages collapsed">

                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/sql-reference/explain-statement" class=''>Explain Statement</a></li>
                            
                                
                                  

								  <li><a href="/docs/ignite3/latest/sql-reference/explain-operators-list" class=''>List Of Operators</a></li>
                            
                            </nav>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            

            

            

			<button type='button' class='group-toggle expanded '>SQL Performance Tuning<img class="state-indicator" src="/assets/images/left-nav-arrow.svg"  width="6" height="10"></button>
             <nav class='nav-group expanded'>
            
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/sql-tuning/sql-tuning"
                                class=''
                            >SQL Performance Tuning</a>
                        
                    </li>
                

                    
                    
                    

                    <li> 
                        
                            <a href="/docs/ignite3/latest/sql-tuning/using-explain"
                                class='active'
                            >Improving Queries</a>
                        
                    </li>
                
              
                     
             </nav>   
            
        </li>
    
        <li>
            
                
                <a href="/docs/ignite3/latest/general-tips" class='' >General Configuration Tips</a>
            
        </li>
    
        <li>
            
                
                <a href="/docs/ignite3/latest/glossary/glossary" class='' >Glossary</a>
            
        </li>
    
</nav>
<div class="left-nav__overlay"></div>


    <article data-swiftype-index='true'>
      <a class='edit-link' href="https://github.com/apache/ignite-3/tree/main/docs/_docs/sql-tuning/using-explain.adoc" target="_blank">Edit</a>
        
            <h1>How to Improve Queries With EXPLAIN Command</h1>
        
        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The SQL <code>EXPLAIN</code> command is a powerful tool used to analyze and understand the execution plan of a query without actually executing it.</p>
</div>
<div class="paragraph">
<p>When you use the EXPLAIN command, it returns the query execution plan, which includes details such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The order in which tables are accessed.</p>
</li>
<li>
<p>The type of join operations used (for example, nested loops, hash joins, or merge joins).</p>
</li>
<li>
<p>Any indexes that are used to speed up data retrieval.</p>
</li>
<li>
<p>Estimated costs and row counts for different parts of the query.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This information is crucial for optimizing query performance, identifying bottlenecks, and making informed decisions about database schema design and indexing strategies.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="explain-command-syntax">EXPLAIN Command Syntax</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Ignite supports two variations of the <code>EXPLAIN</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">EXPLAIN</span> <span class="p">[</span><span class="n">PLAN</span> <span class="o">|</span> <span class="n">MAPPING</span><span class="p">]</span> <span class="k">FOR</span> <span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If neither <code>PLAN</code> nor <code>MAPPING</code> is specified, then <code>PLAN</code> is implicit.</p>
</div>
<div class="paragraph">
<p>Parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PLAN</code> - explains query in terms of relational operators tree. This representation is suitable for investigation of performance issues related to the optimizer.</p>
</li>
<li>
<p><code>MAPPING</code> - explains query in terms of mapping of query fragment to a particular node of the cluster. This representation is suitable for investigation of performance issues related to the data colocation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">EXPLAIN</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">lineitem</span><span class="p">;</span>
<span class="k">EXPLAIN</span> <span class="n">PLAN</span> <span class="k">FOR</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">lineitem</span><span class="p">;</span>
<span class="k">EXPLAIN</span> <span class="n">MAPPING</span> <span class="k">FOR</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">lineitem</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding-the-output">Understanding The Output</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each query plan is represented as a tree-like structure composed of relational operators.</p>
</div>
<div class="paragraph">
<p>A node in the plan includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <strong>name</strong>, indicating the relational operator (e.g., <code>TableScan</code>, <code>IndexScan</code>, <code>Sort</code>, <code>Join</code> types)</p>
</li>
<li>
<p>A set of <strong>attributes</strong>, relevant to that specific operator</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">OperatorName
    attribute1: value1
    attribute2: value2</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="operator-naming">Operator Naming</h3>
<div class="paragraph">
<p>The operator name reflects the specific algorithm or strategy used. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TableScan</code> – Full scan of a base table.</p>
</li>
<li>
<p><code>IndexScan</code> – Access via index, possibly sorted.</p>
</li>
<li>
<p><code>Sort</code> – Explicit sorting step.</p>
</li>
<li>
<p><code>HashJoin</code>, <code>MergeJoin</code>, <code>NestedLoopJoin</code> – Types of join algorithms.</p>
</li>
<li>
<p><code>Limit</code>, <code>Project</code>, <code>Exchange</code> – Execution-related transformations and controls.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hierarchical-plan-structure">Hierarchical Plan Structure</h3>
<div class="paragraph">
<p>The plan is structured as a <strong>tree</strong>, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Leaf nodes</strong> represent data sources (e.g., <code>TableScan</code>)</p>
</li>
<li>
<p><strong>Internal nodes</strong> represent data transformations (e.g., <code>Join</code>, <code>Sort</code>)</p>
</li>
<li>
<p><strong>The root node</strong> (topmost) is the final operator that produces the result</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="common-query-optimization-issues">Common Query Optimization Issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SQL EXPLAIN output analysis can help you optimize slow query execution. You can avoid common bottlenecks in SQL execution by following these guidelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Avoid scanning an entire table.</p>
</li>
<li>
<p>Avoid scanning non-optimal indexes.</p>
</li>
<li>
<p>Avoid suboptimal join ordering or join algorithm.</p>
</li>
<li>
<p>Ensure optimal data colocation for your queries.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following sections, we will see some common issues with queries and ways to identify and fix them.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="full-scan-instead-of-index-scan">Full Scan Instead of Index Scan</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Suppose related sql execution flow looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t</span> <span class="p">(</span><span class="n">id</span> <span class="nb">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">col1</span> <span class="nb">VARCHAR</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">t_col1_idx</span> <span class="k">ON</span> <span class="n">t</span><span class="p">(</span><span class="n">col1</span><span class="p">);</span>

<span class="k">SELECT</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">col1</span> <span class="o">=</span> <span class="s1">'1'</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And possible EXPLAIN output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">   <span class="n">TableScan</span>
       <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">T</span>
       <span class="n">predicate</span><span class="p">:</span> <span class="o">=</span><span class="p">(</span><span class="n">COL1</span><span class="p">,</span> <span class="n">_UTF</span><span class="o">-</span><span class="mi">8</span><span class="s1">'1'</span><span class="p">)</span>
       <span class="n">fieldNames</span><span class="p">:</span> <span class="p">[</span><span class="n">ID</span><span class="p">]</span>
       <span class="n">est</span><span class="p">:</span> <span class="p">(</span><span class="k">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For simplicity, here and below, information that is not related to the example is omitted from the EXPLAIN output.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can see a full scan (<strong>TableScan</strong> operator) with predicate.
The execution planner chooses which scan implementation (<strong>TableScan</strong> or <strong>IndexScan</strong>) to use.
If you expect that index scan is preferable, you can use the <code>FORCE_INDEX</code> hint to manually force <code>IndexScan</code> approach:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="cm">/*+ FORCE_INDEX(t_col1_idx) */</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">col1</span> <span class="o">=</span> <span class="s1">'1'</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Will show a different plan, like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">   <span class="n">IndexScan</span>
       <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">T</span>
       <span class="k">index</span><span class="p">:</span> <span class="n">T_COL1_IDX</span>
       <span class="k">type</span><span class="p">:</span> <span class="n">SORTED</span>
       <span class="n">predicate</span><span class="p">:</span> <span class="o">=</span><span class="p">(</span><span class="n">COL1</span><span class="p">,</span> <span class="n">_UTF</span><span class="o">-</span><span class="mi">8</span><span class="s1">'1'</span><span class="p">)</span>
       <span class="n">searchBounds</span><span class="p">:</span> <span class="p">[</span><span class="n">ExactBounds</span> <span class="p">[</span><span class="n">bound</span><span class="o">=</span><span class="n">_UTF</span><span class="o">-</span><span class="mi">8</span><span class="s1">'1'</span><span class="p">]]</span>
       <span class="n">ieldNames</span><span class="p">:</span> <span class="p">[</span><span class="n">ID</span><span class="p">]</span>
       <span class="k">collation</span><span class="p">:</span> <span class="p">[]</span>
       <span class="n">est</span><span class="p">:</span> <span class="p">(</span><span class="k">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="suboptimal-indexes">Suboptimal Indexes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Indexes with less prediction can be chosen, for example schema and query may look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t</span> <span class="p">(</span><span class="n">id</span> <span class="nb">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">col1</span> <span class="nb">VARCHAR</span><span class="p">,</span> <span class="n">col2</span> <span class="nb">VARCHAR</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">t_col1_col2_idx</span> <span class="k">ON</span> <span class="n">T</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">t_col1_idx</span> <span class="k">ON</span> <span class="n">t</span><span class="p">(</span><span class="n">col1</span><span class="p">);</span>

<span class="k">SELECT</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">col1</span> <span class="o">=</span> <span class="s1">'1'</span> <span class="k">AND</span> <span class="n">col2</span> <span class="o">=</span> <span class="s1">'2'</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and a possible plan would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">   <span class="n">IndexScan</span>
       <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">T</span>
       <span class="k">index</span><span class="p">:</span> <span class="n">T_COL1_IDX</span>
       <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see that the execution uses the <strong>T_COL1_IDX</strong> index, through both predicates <strong>COL1 = '1' AND COL2 = '2'</strong> are involved and the <strong>T_COL1_COL2_IDX</strong> is preferable. In this case, the optimal plan would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">   <span class="n">IndexScan</span>
       <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">T</span>
       <span class="k">index</span><span class="p">:</span> <span class="n">T_COL1_COL2_IDX</span>
       <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>FORCE_INDEX</code> hint to achieve this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="cm">/*+ FORCE_INDEX(t_col1_col2_idx) */</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">col1</span> <span class="o">=</span> <span class="s1">'1'</span> <span class="k">AND</span> <span class="n">col2</span> <span class="o">=</span> <span class="s1">'2'</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="unexpected-sort-operation">Unexpected Sort Operation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, sorted indexes store their entries in ascending order.
You can adjust the ordering of a sorted index by including the options ASC or DESC.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s suppose the schema and related query look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="p">(</span><span class="n">id</span> <span class="nb">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">col1</span> <span class="nb">VARCHAR</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t2</span> <span class="p">(</span><span class="n">id</span> <span class="nb">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">col1</span> <span class="nb">VARCHAR</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">t1_col1_desc_idx</span> <span class="k">ON</span> <span class="n">t1</span><span class="p">(</span><span class="n">col1</span> <span class="k">DESC</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">t2_col1_idx</span> <span class="k">ON</span> <span class="n">t2</span><span class="p">(</span><span class="n">col1</span><span class="p">);</span>

<span class="k">SELECT</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="k">as</span> <span class="n">t1id</span><span class="p">,</span> <span class="n">t2</span><span class="p">.</span><span class="n">id</span> <span class="k">as</span> <span class="n">t2id</span> <span class="k">FROM</span> <span class="n">t1</span> <span class="k">JOIN</span> <span class="n">t2</span> <span class="k">USING</span> <span class="p">(</span><span class="n">col1</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the possible execution plan looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">   <span class="n">MergeJoin</span>
         <span class="p">...</span>
       <span class="n">Sort</span>
           <span class="k">collation</span><span class="p">:</span> <span class="p">[</span><span class="n">COL1</span> <span class="k">ASC</span><span class="p">]</span>
           <span class="p">...</span>
       <span class="n">IndexScan</span>
           <span class="k">index</span><span class="p">:</span> <span class="n">T2_COL1_IDX</span>
           <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the planner adds the <strong>Sort</strong> operation before performing the <strong>IndexScan</strong>,
as the index used is sorted in descending order, while ascending order is required.</p>
</div>
<div class="paragraph">
<p>Extra <strong>Sort</strong> operations adds performance costs, and we can avoid it by creating an index with the appropriate sort ordering:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">t1_col1_idx</span> <span class="k">ON</span> <span class="n">t1</span><span class="p">(</span><span class="n">col1</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And plan will no longer display the <strong>Sort</strong> operation, improving query execution speed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">   <span class="n">MergeJoin</span>
         <span class="p">...</span>
       <span class="n">IndexScan</span>
           <span class="k">index</span><span class="p">:</span> <span class="n">T1_COL1_IDX</span>
           <span class="p">...</span>
       <span class="n">IndexScan</span>
           <span class="k">index</span><span class="p">:</span> <span class="n">T2_COL1_IDX</span>
           <span class="p">...</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="performance-impact-of-correlated-subqueries">Performance Impact of Correlated Subqueries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The SQL-99 standard allows for nested subqueries at nearly all places within a query, so Ignite 3 supports nested subqueries, both correlated and not.
Performance of certain complex correlated subqueries may be insufficient. Let`s consider a correlated query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">emp</span><span class="p">(</span><span class="n">dept_id</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">,</span> <span class="n">salary</span> <span class="nb">INTEGER</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">dept</span><span class="p">(</span><span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">);</span>

<span class="k">SELECT</span> <span class="n">emp</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">dept</span><span class="p">.</span><span class="n">name</span> <span class="k">FROM</span> <span class="n">dept</span> <span class="k">WHERE</span> <span class="n">emp</span><span class="p">.</span><span class="n">dept_id</span><span class="o">=</span><span class="n">dept</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">emp</span>
<span class="k">WHERE</span> <span class="n">emp</span><span class="p">.</span><span class="n">salary</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see nested correlated subquery here, lets check the plan:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">   <span class="n">CorrelatedNestedLoopJoin</span>
         <span class="p">...</span>
       <span class="n">TableScan</span>
           <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">EMP</span>
           <span class="n">predicate</span><span class="p">:</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">SALARY</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
           <span class="p">...</span>
     <span class="n">ColocatedHashAggregate</span>
         <span class="p">...</span>
         <span class="n">TableScan</span>
             <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">DEPT</span>
             <span class="n">predicate</span><span class="p">:</span> <span class="o">=</span><span class="p">(</span><span class="err">$</span><span class="n">cor1</span><span class="p">.</span><span class="n">DEPT_ID</span><span class="p">,</span> <span class="n">ID</span><span class="p">)</span>
             <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows the slow <strong>CorrelatedNestedLoopJoin</strong> operation. Queries with this operation may cause a number of issues:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Such subqueries may become bottlenecks.</p>
</li>
<li>
<p>Queries can cause high CPU load.</p>
</li>
<li>
<p>Certain queries may perform slower than expected.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If performance issues are found in similar queries, it would be more
efficient to rewrite the query without nested subqueries, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">emp</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dept</span><span class="p">.</span><span class="n">name</span>
<span class="k">FROM</span> <span class="n">emp</span><span class="p">,</span> <span class="n">dept</span>
<span class="k">WHERE</span> <span class="n">emp</span><span class="p">.</span><span class="n">salary</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="k">AND</span> <span class="n">emp</span><span class="p">.</span><span class="n">dept_id</span><span class="o">=</span><span class="n">dept</span><span class="p">.</span><span class="n">id</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And new plan becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">     <span class="n">HashJoin</span>
         <span class="n">predicate</span><span class="p">:</span> <span class="o">=</span><span class="p">(</span><span class="n">DEPT_ID</span><span class="p">,</span> <span class="n">ID</span><span class="p">)</span>
         <span class="p">...</span>
       <span class="n">TableScan</span>
           <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">EMP</span>
           <span class="n">predicate</span><span class="p">:</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">SALARY</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
           <span class="p">...</span>
         <span class="n">TableScan</span>
             <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">DEPT</span>
             <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Without the <strong>CorrelatedNestedLoopJoin</strong> operation, the query should perform much better than the previous one.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="excessive-sorting">Excessive Sorting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lets explain we have an index involved two columns one of them is participate in predicate and other in ordering, or in sql terms:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">emp</span><span class="p">(</span><span class="n">dept_id</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">,</span> <span class="n">salary</span> <span class="nb">INTEGER</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">emp_salary_name_idx</span> <span class="k">ON</span> <span class="n">emp</span><span class="p">(</span><span class="n">salary</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>

<span class="k">SELECT</span> <span class="n">dept_id</span> <span class="k">FROM</span> <span class="n">emp</span> <span class="k">WHERE</span> <span class="n">salary</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Expectations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Index need to be used here.</p>
</li>
<li>
<p>No additional sort is needed because index is ordered by <strong>name</strong> column is satisfies initial query ordering.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But the real execution plan shows a different result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">     <span class="n">Sort</span>
         <span class="k">collation</span><span class="p">:</span> <span class="p">[</span><span class="n">NAME</span> <span class="k">ASC</span><span class="p">]</span>
         <span class="p">...</span>
       <span class="n">TableScan</span>
           <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">EMP</span>
           <span class="n">predicate</span><span class="p">:</span> <span class="o">=</span><span class="p">(</span><span class="n">SALARY</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
           <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see a redundant <strong>Sort</strong> operator. A bit query refactoring can help to avoid excessive sorting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">dept_id</span> <span class="k">FROM</span> <span class="n">emp</span> <span class="k">WHERE</span> <span class="n">salary</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">salary</span><span class="p">,</span> <span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the plan becomes as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">     <span class="n">IndexScan</span>
         <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">EMP</span>
         <span class="k">index</span><span class="p">:</span> <span class="n">EMP_SALARY_NAME_IDX</span>
         <span class="n">predicate</span><span class="p">:</span> <span class="o">=</span><span class="p">(</span><span class="n">SALARY</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
         <span class="p">...</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="select-count-optimization">Select Count Optimization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some queries can be optimized to use more optimal plans which brings performance speed up. For example, plan for:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">emp</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Can look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"> <span class="n">SelectCount</span>
     <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">EMP</span>
     <span class="n">est</span><span class="p">:</span> <span class="p">(</span><span class="k">rows</span><span class="o">=</span><span class="mi">43</span><span class="p">)</span>
     <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But there are numerous cases where such optimization is not applicable. In such a cases, a plan can be different and the execution may require more time.</p>
</div>
<div class="paragraph">
<p>The same query as above, but with explicit transaction may produce a different plan, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">   <span class="n">ReduceSortAggregate</span>
       <span class="p">...</span>
       <span class="n">MapSortAggregate</span>
           <span class="p">...</span>
         <span class="n">TableScan</span>
             <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">EMP</span>
             <span class="n">est</span><span class="p">:</span> <span class="p">(</span><span class="k">rows</span><span class="o">=</span><span class="mi">43</span><span class="p">)</span>
             <span class="p">...</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="index-scan-without-exact-search-bounds">Index Scan Without Exact Search Bounds</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Table scans are available in two implementations: direct table scan and scan through index.
Index scans contain predicate and search bounds.
Predicate provides final rows comparison. If search bounds are absentm the query degenerates into table scan through index scan (requiring an additional store look up), with further predicate comparison, that incurs additional performance overhead costs.</p>
</div>
<div class="paragraph">
<p>Let`s suppose we have schema and query like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t</span> <span class="p">(</span><span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">col1</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">t_col1_idx</span> <span class="k">ON</span> <span class="n">t</span><span class="p">(</span><span class="n">col1</span><span class="p">);</span>

<span class="k">SELECT</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">col1</span> <span class="o">=</span> <span class="mi">43</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And possible plan would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">   <span class="n">IndexScan</span>
       <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">T</span>
       <span class="k">index</span><span class="p">:</span> <span class="n">T_COL1_IDX</span>
       <span class="n">predicate</span><span class="p">:</span> <span class="o">=</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">COL1</span><span class="p">):</span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">43</span><span class="p">.</span><span class="mi">000</span><span class="p">)</span>
       <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see here - only <strong>predicate</strong> (and no <strong>searchBounds</strong>) which means that <strong>all</strong> rows from index will go through predicate and bring additional performance penalty.</p>
</div>
<div class="paragraph">
<p>Two type of solutions are possible here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can prohibit suboptimal index usage;</p>
</li>
<li>
<p>You can explicitly help the planner with type derivation.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="prohibit-index-usage">Prohibit Index Usage</h3>
<div class="paragraph">
<p>For the first approach, use the <strong>NO_INDEX</strong> hint to prohibit index usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="cm">/*+ NO_INDEX */</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">col1</span> <span class="o">=</span> <span class="mi">43</span><span class="p">;</span>

<span class="c1">-- or with direct index mention:</span>

<span class="k">SELECT</span> <span class="cm">/*+ NO_INDEX(t_col1_idx) */</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">col1</span> <span class="o">=</span> <span class="mi">43</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result, you will have a plan similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">   <span class="n">TableScan</span>
       <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">T</span>
       <span class="n">predicate</span><span class="p">:</span> <span class="o">=</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">COL1</span><span class="p">):</span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">43</span><span class="p">.</span><span class="mi">000</span><span class="p">)</span>
       <span class="p">...</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="manual-type-casting">Manual Type Casting</h3>
<div class="paragraph">
<p>You can append additional cast to the same query to explicitly cast data as a specific type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">col1</span> <span class="o">=</span> <span class="mi">43</span><span class="p">::</span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">   <span class="n">IndexScan</span>
       <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">T</span>
       <span class="k">index</span><span class="p">:</span> <span class="n">T_COL1_IDX</span>
       <span class="n">predicate</span><span class="p">:</span> <span class="o">=</span><span class="p">(</span><span class="n">COL1</span><span class="p">,</span> <span class="mi">43</span><span class="p">.</span><span class="mi">000</span><span class="p">)</span>
       <span class="n">searchBounds</span><span class="p">:</span> <span class="p">[</span><span class="n">ExactBounds</span> <span class="p">[</span><span class="n">bound</span><span class="o">=</span><span class="mi">43</span><span class="p">.</span><span class="mi">000</span><span class="p">:</span><span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]]</span>
       <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see here both <strong>searchBounds</strong> and <strong>predicate</strong> which means that only exact lookup through index will be involved.</p>
</div>
<div class="paragraph">
<p>The same case as above but for a bit complicated query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t</span> <span class="p">(</span><span class="n">id</span> <span class="nb">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">col1</span> <span class="nb">INT</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">t_col1_asc_idx</span> <span class="k">ON</span> <span class="n">t</span> <span class="p">(</span><span class="n">col1</span><span class="p">);</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">col1</span><span class="p">::</span><span class="nb">varchar</span> <span class="o">=</span> <span class="n">SUBSTR</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">::</span><span class="nb">varchar</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Possible plan:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">   <span class="n">IndexScan</span>
       <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">T</span>
       <span class="k">index</span><span class="p">:</span> <span class="n">T_COL1_IDX</span>
       <span class="n">predicate</span><span class="p">:</span> <span class="o">=</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">COL1</span><span class="p">):</span><span class="nb">VARCHAR</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="nv">"UTF-8"</span><span class="p">,</span> <span class="n">SUBSTR</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">):</span><span class="nb">VARCHAR</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="nv">"UTF-8"</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
       <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And we also can see that no <strong>search bounds</strong> are involved here.</p>
</div>
<div class="paragraph">
<p>Try to change it like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t</span> <span class="k">WHERE</span> <span class="n">col1</span> <span class="o">=</span> <span class="n">SUBSTR</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">::</span><span class="nb">varchar</span><span class="p">,</span> <span class="mi">4</span><span class="p">)::</span><span class="nb">int</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the possible plan will become:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">   <span class="n">IndexScan</span>
       <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">T</span>
       <span class="k">index</span><span class="p">:</span> <span class="n">T_COL1_ASC_IDX</span>
       <span class="n">predicate</span><span class="p">:</span> <span class="o">=</span><span class="p">(</span><span class="n">COL1</span><span class="p">,</span> <span class="k">CAST</span><span class="p">(</span><span class="n">SUBSTR</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">):</span><span class="nb">VARCHAR</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="nv">"UTF-8"</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span><span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">)</span>
       <span class="n">searchBounds</span><span class="p">:</span> <span class="p">[</span><span class="n">ExactBounds</span> <span class="p">[</span><span class="n">bound</span><span class="o">=</span><span class="k">CAST</span><span class="p">(</span><span class="n">SUBSTR</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="k">CURRENT_DATE</span><span class="p">):</span><span class="nb">VARCHAR</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="nv">"UTF-8"</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span><span class="nb">INTEGER</span><span class="p">]]</span>
       <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see that <strong>searchBounds</strong> are present - thus more productive execution flow is expected here.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="colocation-usage">Colocation Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As mentioned above, right colocated columns choice plays a significant role in query execution performance.
For example, if initially tables are created without any thoughts about further usage columns colocation you can have the following scenario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- by default, the table is implicitly colocated by PRIMARY KEY</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">emp</span><span class="p">(</span><span class="n">dept_id</span> <span class="nb">INTEGER</span><span class="p">,</span> <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">,</span> <span class="n">salary</span> <span class="nb">INTEGER</span><span class="p">,</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">dept_id</span><span class="p">,</span> <span class="n">name</span><span class="p">));</span>

<span class="c1">-- implicitly colocated by PRIMARY KEY</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">dept</span><span class="p">(</span><span class="n">id</span> <span class="nb">INTEGER</span><span class="p">,</span> <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">,</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">id</span><span class="p">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And query as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">emp</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dept</span><span class="p">.</span><span class="n">name</span> <span class="k">FROM</span> <span class="n">emp</span> <span class="k">JOIN</span> <span class="n">dept</span> <span class="k">ON</span> <span class="n">emp</span><span class="p">.</span><span class="n">dept_id</span> <span class="o">=</span> <span class="n">dept</span><span class="p">.</span><span class="n">id</span> <span class="k">AND</span> <span class="n">emp</span><span class="p">.</span><span class="n">salary</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Bring plan like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">   <span class="n">HashJoin</span>
       <span class="n">predicate</span><span class="p">:</span> <span class="o">=</span><span class="p">(</span><span class="n">DEPT_ID</span><span class="p">,</span> <span class="n">ID</span><span class="p">)</span>
       <span class="p">...</span>
     <span class="n">Exchange</span>
         <span class="p">...</span>
       <span class="n">TableScan</span>
           <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">EMP</span>
           <span class="p">...</span>
     <span class="n">Exchange</span>
         <span class="p">...</span>
       <span class="n">TableScan</span>
           <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">DEPT</span>
           <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see two <strong>Exchange</strong> operators, which means that all rows are transferred into a single node and then are joined.
This execution flow brings a performance cost and slows down query execution.</p>
</div>
<div class="paragraph">
<p>Let`s try to improve it by adding explicit colocation for the <strong>dept</strong> table by the <strong>ID</strong> column:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- implicitly colocated by PRIMARY KEY</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">emp</span><span class="p">(</span><span class="n">dept_id</span> <span class="nb">INTEGER</span><span class="p">,</span> <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">,</span> <span class="n">salary</span> <span class="nb">INTEGER</span><span class="p">,</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">dept_id</span><span class="p">,</span> <span class="n">name</span><span class="p">));</span>
<span class="c1">-- explicitly colocated by ID</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">dept</span><span class="p">(</span><span class="n">id</span> <span class="nb">INTEGER</span><span class="p">,</span> <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">,</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">id</span><span class="p">))</span> <span class="n">COLOCATE</span> <span class="k">BY</span> <span class="p">(</span><span class="n">id</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the dependent rows from <strong>emp</strong> table are transferred into the appropriate
node where <strong>dept</strong> holds the rows according to <strong>DEPT.ID</strong> distribution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">     <span class="n">HashJoin</span>
         <span class="n">predicate</span><span class="p">:</span> <span class="o">=</span><span class="p">(</span><span class="n">DEPT_ID</span><span class="p">,</span> <span class="n">ID</span><span class="p">)</span>
         <span class="p">...</span>
       <span class="n">Exchange</span>
           <span class="n">distribution</span><span class="p">:</span> <span class="k">table</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">DEPT</span> <span class="k">in</span> <span class="k">zone</span> <span class="nv">"Default"</span> <span class="k">by</span> <span class="p">[</span><span class="n">DEPT_ID</span><span class="p">]</span>
           <span class="p">...</span>
         <span class="n">TableScan</span>
             <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">EMP</span>
             <span class="p">...</span>
       <span class="n">TableScan</span>
           <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">DEPT</span>
           <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Only one <strong>Exchange</strong> operator for now, which, once again, mean only rows transferring
from <strong>emp</strong> table to appropriate <strong>dept</strong> one.</p>
</div>
<div class="paragraph">
<p>And finally, both join predicate related columns are colocated:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The following colocation example will only work if the <strong>emp</strong> and <strong>dept</strong> tables belong to the same distribution zone.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- explicitly colocated by DEPT_ID</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">emp</span><span class="p">(</span><span class="n">dept_id</span> <span class="nb">INTEGER</span><span class="p">,</span> <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">,</span> <span class="n">salary</span> <span class="nb">INTEGER</span><span class="p">,</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">dept_id</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="n">COLOCATE</span> <span class="k">BY</span><span class="p">(</span><span class="n">dept_id</span><span class="p">);</span>
<span class="c1">-- explicitly colocated by ID</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">dept</span><span class="p">(</span><span class="n">id</span> <span class="nb">INTEGER</span><span class="p">,</span> <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">,</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="n">COLOCATE</span> <span class="k">BY</span><span class="p">(</span><span class="n">id</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, the <strong>emp</strong> and <strong>dept</strong> tables are both colocated.</p>
</div>
<div class="paragraph">
<p>And the final plan will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">     <span class="n">HashJoin</span>
        <span class="n">predicate</span><span class="p">:</span> <span class="o">=</span><span class="p">(</span><span class="n">DEPT_ID</span><span class="p">,</span> <span class="n">ID</span><span class="p">)</span>
         <span class="p">...</span>
       <span class="n">TableScan</span>
           <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">EMP</span>
           <span class="p">...</span>
       <span class="n">TableScan</span>
           <span class="k">table</span><span class="p">:</span> <span class="k">PUBLIC</span><span class="p">.</span><span class="n">DEPT</span>
           <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>No <strong>Exchange</strong> operators are involved in the explanation, which means that no excessive rows transfer has occurred.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="comprehensive-explain-examples">Comprehensive EXPLAIN Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="example-complex-join-query">Example: Complex Join Query</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">EXPLAIN</span> <span class="n">PLAN</span> <span class="k">FOR</span>
 <span class="k">SELECT</span>
      <span class="n">U</span><span class="p">.</span><span class="n">UserName</span><span class="p">,</span> <span class="n">P</span><span class="p">.</span><span class="n">ProductName</span><span class="p">,</span> <span class="n">R</span><span class="p">.</span><span class="n">ReviewText</span><span class="p">,</span> <span class="n">R</span><span class="p">.</span><span class="n">Rating</span>
   <span class="k">FROM</span> <span class="n">Users</span> <span class="n">U</span><span class="p">,</span> <span class="n">Reviews</span> <span class="n">R</span><span class="p">,</span> <span class="n">Products</span> <span class="n">P</span>
  <span class="k">WHERE</span> <span class="n">U</span><span class="p">.</span><span class="n">UserID</span> <span class="o">=</span> <span class="n">R</span><span class="p">.</span><span class="n">UserID</span>
    <span class="k">AND</span> <span class="n">R</span><span class="p">.</span><span class="n">ProductID</span> <span class="o">=</span> <span class="n">P</span><span class="p">.</span><span class="n">ProductID</span>
    <span class="k">AND</span> <span class="n">P</span><span class="p">.</span><span class="n">ProductName</span> <span class="o">=</span> <span class="s1">'Product_'</span> <span class="o">||</span> <span class="o">?</span><span class="p">::</span><span class="nb">varchar</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting output is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">Project
    fieldNames: [USERNAME, PRODUCTNAME, REVIEWTEXT, RATING]
    projection: [USERNAME, PRODUCTNAME, REVIEWTEXT, RATING]
    est: (rows=16650)
  HashJoin
      predicate: =(USERID$0, USERID)
      fieldNames: [PRODUCTID, USERID, REVIEWTEXT, RATING, PRODUCTID$0, PRODUCTNAME, USERID$0, USERNAME]
      type: inner
      est: (rows=16650)
    HashJoin
        predicate: =(PRODUCTID, PRODUCTID$0)
        fieldNames: [PRODUCTID, USERID, REVIEWTEXT, RATING, PRODUCTID$0, PRODUCTNAME]
        type: inner
        est: (rows=16650)
      Exchange
          distribution: single
          est: (rows=50000)
        TableScan
            table: PUBLIC.REVIEWS
            fieldNames: [PRODUCTID, USERID, REVIEWTEXT, RATING]
            est: (rows=50000)
      Exchange
          distribution: single
          est: (rows=1665)
        TableScan
            table: PUBLIC.PRODUCTS
            predicate: =(PRODUCTNAME, ||(_UTF-8'Product_', CAST(?0):VARCHAR CHARACTER SET "UTF-8"))
            fieldNames: [PRODUCTID, PRODUCTNAME]
            est: (rows=1665)
    Exchange
        distribution: single
        est: (rows=10000)
      TableScan
          table: PUBLIC.USERS
          fieldNames: [USERID, USERNAME]
          est: (rows=10000)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This execution plan represents a query that joins three tables: <code>USERS</code>, <code>REVIEWS</code>, and <code>PRODUCTS</code>, and selects four fields after filtering by product name.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Project</strong> (root node): Outputs the final selected fields — <code>USERNAME</code>, <code>PRODUCTNAME</code>, <code>REVIEWTEXT</code>, and <code>RATING</code>.</p>
</li>
<li>
<p><strong>HashJoins</strong> (two levels): Perform the inner joins.</p>
<div class="ulist">
<ul>
<li>
<p>The first (bottom-most) joins <code>REVIEWS</code> with <code>PRODUCTS</code> on <code>PRODUCTID</code>.</p>
</li>
<li>
<p>The second joins the result with <code>USERS</code> on <code>USERID</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>TableScans</strong>: Each table is scanned:</p>
<div class="ulist">
<ul>
<li>
<p><code>REVIEWS</code> is fully scanned.</p>
</li>
<li>
<p><code>PRODUCTS</code> is scanned with a filter on <code>PRODUCTNAME</code>.</p>
</li>
<li>
<p><code>USERS</code> is fully scanned.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Exchange</strong> nodes: Indicate data redistribution between operators.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each node includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fieldNames</code>: Output columns at that stage.</p>
</li>
<li>
<p><code>predicate</code>: Join or filter condition.</p>
</li>
<li>
<p><code>est</code>: Estimated number of rows at that point in the plan.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="example-query-mapping">Example: Query Mapping</h3>
<div class="paragraph">
<p>A result of EXPLAIN MAPPING command includes additional metadata providing insight at how the query is mapped on cluster topology. So, for the command like below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">EXPLAIN</span> <span class="n">MAPPING</span> <span class="k">FOR</span>
 <span class="k">SELECT</span>
      <span class="n">U</span><span class="p">.</span><span class="n">UserName</span><span class="p">,</span> <span class="n">P</span><span class="p">.</span><span class="n">ProductName</span><span class="p">,</span> <span class="n">R</span><span class="p">.</span><span class="n">ReviewText</span><span class="p">,</span> <span class="n">R</span><span class="p">.</span><span class="n">Rating</span>
   <span class="k">FROM</span> <span class="n">Users</span> <span class="n">U</span><span class="p">,</span> <span class="n">Reviews</span> <span class="n">R</span><span class="p">,</span> <span class="n">Products</span> <span class="n">P</span>
  <span class="k">WHERE</span> <span class="n">U</span><span class="p">.</span><span class="n">UserID</span> <span class="o">=</span> <span class="n">R</span><span class="p">.</span><span class="n">UserID</span>
    <span class="k">AND</span> <span class="n">R</span><span class="p">.</span><span class="n">ProductID</span> <span class="o">=</span> <span class="n">P</span><span class="p">.</span><span class="n">ProductID</span>
    <span class="k">AND</span> <span class="n">P</span><span class="p">.</span><span class="n">ProductName</span> <span class="o">=</span> <span class="s1">'Product_'</span> <span class="o">||</span> <span class="o">?</span><span class="p">::</span><span class="nb">varchar</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting output is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">Fragment#0 root
  distribution: single
  executionNodes: [node_1]
  tree:
    Project
        fieldNames: [USERNAME, PRODUCTNAME, REVIEWTEXT, RATING]
        projection: [USERNAME, PRODUCTNAME, REVIEWTEXT, RATING]
        est: (rows=1)
      HashJoin
          predicate: =(USERID$0, USERID)
          fieldNames: [PRODUCTID, USERID, REVIEWTEXT, RATING, PRODUCTID$0, PRODUCTNAME, USERID$0, USERNAME]
          type: inner
          est: (rows=1)
        HashJoin
            predicate: =(PRODUCTID, PRODUCTID$0)
            fieldNames: [PRODUCTID, USERID, REVIEWTEXT, RATING, PRODUCTID$0, PRODUCTNAME]
            type: inner
            est: (rows=1)
          Receiver
              fieldNames: [PRODUCTID, USERID, REVIEWTEXT, RATING]
              sourceFragmentId: 1
              est: (rows=1)
          Receiver
              fieldNames: [PRODUCTID, PRODUCTNAME]
              sourceFragmentId: 2
              est: (rows=1)
        Receiver
            fieldNames: [USERID, USERNAME]
            sourceFragmentId: 3
            est: (rows=1)

Fragment#1
  distribution: random
  executionNodes: [node_1, node_2, node_3]
  partitions: [REVIEWS=[node_1={0, 2, 5, 6, 7, 8, 9, 10, 12, 13, 20}, node_2={1, 3, 11, 19, 21, 22, 23, 24}, node_3={4, 14, 15, 16, 17, 18}]]
  tree:
    Sender
        distribution: single
        targetFragmentId: 0
        est: (rows=50000)
      TableScan
          table: PUBLIC.REVIEWS
          fieldNames: [PRODUCTID, USERID, REVIEWTEXT, RATING]
          est: (rows=50000)

Fragment#2
  distribution: table PUBLIC.PRODUCTS in zone "Default"
  executionNodes: [node_1, node_2, node_3]
  partitions: [PRODUCTS=[node_1={0, 2, 5, 6, 7, 8, 9, 10, 12, 13, 20}, node_2={1, 3, 11, 19, 21, 22, 23, 24}, node_3={4, 14, 15, 16, 17, 18}]]
  tree:
    Sender
        distribution: single
        targetFragmentId: 0
        est: (rows=1665)
      TableScan
          table: PUBLIC.PRODUCTS
          predicate: =(PRODUCTNAME, ||(_UTF-8'Product_', CAST(?0):VARCHAR CHARACTER SET "UTF-8"))
          fieldNames: [PRODUCTID, PRODUCTNAME]
          est: (rows=1665)

Fragment#3
  distribution: table PUBLIC.USERS in zone "Default"
  executionNodes: [node_1, node_2, node_3]
  partitions: [USERS=[node_1={0, 2, 5, 6, 7, 8, 9, 10, 12, 13, 20}, node_2={1, 3, 11, 19, 21, 22, 23, 24}, node_3={4, 14, 15, 16, 17, 18}]]
  tree:
    Sender
        distribution: single
        targetFragmentId: 0
        est: (rows=10000)
      TableScan
          table: PUBLIC.USERS
          fieldNames: [USERID, USERNAME]
          est: (rows=10000)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Fragment#0</strong> means fragment with id=0</p>
</li>
<li>
<p>A <strong>root</strong> marks a fragment which is considered as root fragment, i.e. a fragment which represents user&#8217;s cursor</p>
</li>
<li>
<p>A <strong>distribution</strong> attribute provides an insight into which mapping strategy was applied to this particular fragment</p>
</li>
<li>
<p>A <strong>executionNodes</strong> attribute provides a list of nodes this fragment will be executed on</p>
</li>
<li>
<p>A <strong>partitions</strong> attribute provides an insight into which partitions of which tables will be read from which nodes</p>
</li>
<li>
<p>A <strong>tree</strong> attribute specifies which part of the relational tree corresponds to this fragment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The output above shows how the query is broken into multiple execution fragments and distributed across the cluster. It gives insight into both the logical execution plan and how it maps to the physical topology.</p>
</div>
<div class="paragraph">
<p>The query starts execution in <strong>Fragment#0</strong>, which serves as the root of the plan — this is where the final result is produced. It runs on a single node (<code>node_1</code>) and contains the main logic of the query, including the projection and two nested hash joins. Instead of scanning tables directly, it receives data from other fragments through <code>Receiver</code> operators. These incoming streams correspond to the <code>REVIEWS</code>, <code>PRODUCTS</code>, and <code>USERS</code> tables.</p>
</div>
<div class="paragraph">
<p>The actual table scans happen in <strong>Fragments 1 through 3</strong>, each responsible for one of the involved tables. These fragments operate in parallel across the cluster. Each performs a scan on its respective table and then sends the results back to Fragment#0.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Fragment#1</strong> handles the <code>REVIEWS</code> table. It runs on all nodes and uses a random distribution strategy. Data is partitioned across nodes, and after scanning the table, results are sent upstream.</p>
</li>
<li>
<p><strong>Fragment#2</strong> is in charge of the <code>PRODUCTS</code> table. It also spans all nodes but follows a zone-based distribution linked to the table&#8217;s partitioning. There&#8217;s a filter applied to <code>PRODUCTNAME</code>, which limits the amount of data sent to the root.</p>
</li>
<li>
<p><strong>Fragment#3</strong> covers the <code>USERS</code> table. Like the others, it&#8217;s distributed and reads from table partitions spread across the cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each fragment includes metadata such as the nodes it&#8217;s executed on, how data is partitioned, and how results are sent between fragments. This layout provides a clear view of not only how the query is logically processed, but also how the workload is split and coordinated in a distributed environment.</p>
</div>
</div>
</div>
</div>
        <div class="copyright">
 © 2025 The Apache Software Foundation.<br/>
Apache, Apache Ignite, the Apache feather and the Apache Ignite logo are either registered trademarks or trademarks of The Apache Software Foundation. 

</div>

    </article>
    <nav class="right-nav" data-swiftype-index='false'>
    <div class="toc-wrapper">
    <ul class="sectlevel1">
<li><a href="#explain-command-syntax">EXPLAIN Command Syntax</a></li>
<li><a href="#understanding-the-output">Understanding The Output</a>
<ul class="sectlevel2">
<li><a href="#operator-naming">Operator Naming</a></li>
<li><a href="#hierarchical-plan-structure">Hierarchical Plan Structure</a></li>
</ul>
</li>
<li><a href="#common-query-optimization-issues">Common Query Optimization Issues</a></li>
<li><a href="#full-scan-instead-of-index-scan">Full Scan Instead of Index Scan</a></li>
<li><a href="#suboptimal-indexes">Suboptimal Indexes</a></li>
<li><a href="#unexpected-sort-operation">Unexpected Sort Operation</a></li>
<li><a href="#performance-impact-of-correlated-subqueries">Performance Impact of Correlated Subqueries</a></li>
<li><a href="#excessive-sorting">Excessive Sorting</a></li>
<li><a href="#select-count-optimization">Select Count Optimization</a></li>
<li><a href="#index-scan-without-exact-search-bounds">Index Scan Without Exact Search Bounds</a>
<ul class="sectlevel2">
<li><a href="#prohibit-index-usage">Prohibit Index Usage</a></li>
<li><a href="#manual-type-casting">Manual Type Casting</a></li>
</ul>
</li>
<li><a href="#colocation-usage">Colocation Usage</a></li>
<li><a href="#comprehensive-explain-examples">Comprehensive EXPLAIN Examples</a>
<ul class="sectlevel2">
<li><a href="#example-complex-join-query">Example: Complex Join Query</a></li>
<li><a href="#example-query-mapping">Example: Query Mapping</a></li>
</ul>
</li>
</ul>
    </div>
          
      
      <nav class="promo-nav">
            <!--#include virtual="/includes/docs_rightnav_promotion.html" -->
            <!--a href="#" data-trigger-bugyard-feedback="true" id="doc-feedback-btn">Docs Feedback</a-->
        </nav>
        
</nav>
    
</section>
<script type='module' src='/assets/js/code-copy-to-clipboard.js' async crossorigin></script>

    <script>
    // inits deep anchors -- needs to be done here because of https://www.bryanbraun.com/anchorjs/#dont-run-it-too-late 
    anchors.add('.page-docs h1, .page-docs h2, .page-docs h3:not(.discrete), .page-docs h4, .page-docs h5');
    anchors.options = {
        placement: 'right',
        visible: 'always'
    };
    </script>

<script type='module' src='/assets/js/index.js?1761833941' async crossorigin></script>
<script type='module' src='/assets/js/versioning.js?1761833941' async crossorigin></script>
<script type='module' src='/assets/js/railroad-diagram.js?1761833941' async></script>
<script type='module' src='/assets/js/search.js?1761833941' defer crossorigin></script>

<link rel="stylesheet" href="/assets/css/styles.css?1761833941" media="print" onload="this.media='all'">
<noscript><link media="all" rel="stylesheet" href="/assets/css/styles.css?1761833941"></noscript>

<link rel="stylesheet" href="/assets/css/docsearch.min.css" media="print" onload="this.media='all'">
<noscript><link media="all" rel="stylesheet" href="/assets/css/docsearch.min.css"></noscript>

  
</body>

</html>
