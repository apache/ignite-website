<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-understand/performance/using-explain" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Using EXPLAIN Command | Apache Ignite 3 Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ignite.apache.org/docs/ignite3/img/logo.svg"><meta data-rh="true" name="twitter:image" content="https://ignite.apache.org/docs/ignite3/img/logo.svg"><meta data-rh="true" property="og:url" content="https://ignite.apache.org/docs/ignite3/3.1.0/understand/performance/using-explain"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Using EXPLAIN Command | Apache Ignite 3 Documentation"><meta data-rh="true" name="description" content="The EXPLAIN command displays the execution plan for a SQL query without running it. Use this to understand how the query optimizer processes your query and identify performance bottlenecks."><meta data-rh="true" property="og:description" content="The EXPLAIN command displays the execution plan for a SQL query without running it. Use this to understand how the query optimizer processes your query and identify performance bottlenecks."><link data-rh="true" rel="icon" href="/docs/ignite3/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ignite.apache.org/docs/ignite3/3.1.0/understand/performance/using-explain"><link data-rh="true" rel="alternate" href="https://ignite.apache.org/docs/ignite3/3.1.0/understand/performance/using-explain" hreflang="en"><link data-rh="true" rel="alternate" href="https://ignite.apache.org/docs/ignite3/3.1.0/understand/performance/using-explain" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Concepts and Architecture","item":"https://ignite.apache.org/docs/ignite3/3.1.0/understand/"},{"@type":"ListItem","position":2,"name":"Performance","item":"https://ignite.apache.org/docs/ignite3/3.1.0/understand/performance/"},{"@type":"ListItem","position":3,"name":"Using EXPLAIN Command","item":"https://ignite.apache.org/docs/ignite3/3.1.0/understand/performance/using-explain"}]}</script><link rel="stylesheet" href="/docs/ignite3/assets/css/styles.aea0cba5.css">
<script src="/docs/ignite3/assets/js/runtime~main.4360c1c4.js" defer="defer"></script>
<script src="/docs/ignite3/assets/js/main.189970e9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs/ignite3/img/logo.svg"><link rel="preload" as="image" href="/docs/ignite3/img/logo-dark.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/docs/ignite3/"><div class="navbar__logo"><img src="/docs/ignite3/img/logo.svg" alt="Apache Ignite Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/ignite3/img/logo-dark.svg" alt="Apache Ignite Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/ignite3/3.1.0/understand/performance/using-explain">3.1.0 (Latest)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/ignite3/3.1.0/understand/performance/using-explain">3.1.0 (Latest)</a></li><li><a class="dropdown__link" href="/docs/ignite3/3.0.0">3.0.0</a></li></ul></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><a href="https://github.com/apache/ignite-3" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/ignite3/3.1.0"><span title="Apache Ignite 3 Documentation" class="linkLabel_WmDU">Apache Ignite 3 Documentation</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/ignite3/3.1.0/getting-started"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/ignite3/3.1.0/develop"><span title="Develop and Build" class="categoryLinkLabel_W154">Develop and Build</span></a><button aria-label="Expand sidebar category &#x27;Develop and Build&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/ignite3/3.1.0/sql"><span title="Work with SQL" class="categoryLinkLabel_W154">Work with SQL</span></a><button aria-label="Expand sidebar category &#x27;Work with SQL&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/ignite3/3.1.0/configure-and-operate"><span title="Configure and Operate" class="categoryLinkLabel_W154">Configure and Operate</span></a><button aria-label="Expand sidebar category &#x27;Configure and Operate&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/docs/ignite3/3.1.0/understand"><span title="Concepts and Architecture" class="categoryLinkLabel_W154">Concepts and Architecture</span></a><button aria-label="Collapse sidebar category &#x27;Concepts and Architecture&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/ignite3/3.1.0/understand/core-concepts"><span title="Core Concepts" class="categoryLinkLabel_W154">Core Concepts</span></a><button aria-label="Expand sidebar category &#x27;Core Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/ignite3/3.1.0/understand/architecture"><span title="Architecture" class="categoryLinkLabel_W154">Architecture</span></a><button aria-label="Expand sidebar category &#x27;Architecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/ignite3/3.1.0/understand/performance"><span title="Performance" class="categoryLinkLabel_W154">Performance</span></a><button aria-label="Collapse sidebar category &#x27;Performance&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/ignite3/3.1.0/understand/performance/using-explain"><span title="Using EXPLAIN Command" class="linkLabel_WmDU">Using EXPLAIN Command</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ignite3/3.1.0/understand/performance/explain-operators"><span title="EXPLAIN Operators Reference" class="linkLabel_WmDU">EXPLAIN Operators Reference</span></a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/ignite3/3.1.0/api-reference"><span title="Client and API Reference" class="categoryLinkLabel_W154">Client and API Reference</span></a><button aria-label="Expand sidebar category &#x27;Client and API Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/ignite3/3.1.0/tools"><span title="Tools" class="categoryLinkLabel_W154">Tools</span></a><button aria-label="Expand sidebar category &#x27;Tools&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/ignite3/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/ignite3/3.1.0/understand"><span>Concepts and Architecture</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/ignite3/3.1.0/understand/performance"><span>Performance</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Using EXPLAIN Command</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 3.1.0 (Latest)</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Using EXPLAIN Command</h1></header>
<p>The <code>EXPLAIN</code> command displays the execution plan for a SQL query without running it. Use this to understand how the query optimizer processes your query and identify performance bottlenecks.</p>
<!-- -->
<p>The execution plan reveals:</p>
<ul>
<li class="">Table access order and methods (full scan vs index scan)</li>
<li class="">Join algorithms (hash join, merge join, nested loop)</li>
<li class="">Index usage and search bounds</li>
<li class="">Row count estimates at each stage</li>
<li class="">Data distribution across cluster nodes (with MAPPING)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="explain-command-syntax">EXPLAIN Command Syntax<a href="#explain-command-syntax" class="hash-link" aria-label="Direct link to EXPLAIN Command Syntax" title="Direct link to EXPLAIN Command Syntax" translate="no">​</a></h2>
<p>Apache Ignite supports two variations of the <code>EXPLAIN</code> command:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">PLAN</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> MAPPING</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FOR</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">query</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>If neither <code>PLAN</code> nor <code>MAPPING</code> is specified, then <code>PLAN</code> is implicit.</p>
<p>Parameters:</p>
<ul>
<li class=""><code>PLAN</code> - explains query in terms of relational operators tree. This representation is suitable for investigation of performance issues related to the optimizer.</li>
<li class=""><code>MAPPING</code> - explains query in terms of mapping of query fragment to a particular node of the cluster. This representation is suitable for investigation of performance issues related to the data colocation.</li>
</ul>
<p>Examples:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> lineitem</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PLAN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FOR</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> lineitem</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"> MAPPING </span><span class="token keyword" style="color:#00009f">FOR</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> lineitem</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-the-output">Understanding The Output<a href="#understanding-the-output" class="hash-link" aria-label="Direct link to Understanding The Output" title="Direct link to Understanding The Output" translate="no">​</a></h2>
<p>Each query plan is a tree of relational operators. Data flows from leaf nodes (table scans) up through transformation nodes (joins, sorts) to the root node (final result).</p>
<!-- -->
<p>Each operator node includes:</p>
<ul>
<li class=""><strong>Name</strong>: The algorithm used (TableScan, HashJoin, Sort, etc.)</li>
<li class=""><strong>Attributes</strong>: Operator-specific details (table name, predicate, field names)</li>
<li class=""><strong>Estimate</strong>: Expected row count at this stage (<code>est: (rows=N)</code>)</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">OperatorName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    attribute1: value1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    attribute2: value2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    est: (rows=N)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="operator-categories">Operator Categories<a href="#operator-categories" class="hash-link" aria-label="Direct link to Operator Categories" title="Direct link to Operator Categories" translate="no">​</a></h3>
<table><thead><tr><th>Category</th><th>Operators</th><th>Purpose</th></tr></thead><tbody><tr><td><strong>Scan</strong></td><td>TableScan, IndexScan, SystemViewScan</td><td>Read data from tables</td></tr><tr><td><strong>Join</strong></td><td>HashJoin, MergeJoin, NestedLoopJoin</td><td>Combine rows from multiple sources</td></tr><tr><td><strong>Aggregate</strong></td><td>ColocatedHashAggregate, MapSortAggregate</td><td>GROUP BY operations</td></tr><tr><td><strong>Transform</strong></td><td>Project, Filter, Sort, Limit</td><td>Shape and order results</td></tr><tr><td><strong>Distribution</strong></td><td>Exchange, Sender, Receiver</td><td>Move data between nodes</td></tr></tbody></table>
<p>See <a class="" href="/docs/ignite3/3.1.0/understand/performance/explain-operators">EXPLAIN Operators Reference</a> for the complete operator list.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="plan-structure">Plan Structure<a href="#plan-structure" class="hash-link" aria-label="Direct link to Plan Structure" title="Direct link to Plan Structure" translate="no">​</a></h3>
<ul>
<li class=""><strong>Leaf nodes</strong>: Data sources (TableScan, IndexScan)</li>
<li class=""><strong>Internal nodes</strong>: Transformations (Join, Sort, Aggregate)</li>
<li class=""><strong>Root node</strong>: Final operator producing the query result</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-query-optimization-issues">Common Query Optimization Issues<a href="#common-query-optimization-issues" class="hash-link" aria-label="Direct link to Common Query Optimization Issues" title="Direct link to Common Query Optimization Issues" translate="no">​</a></h2>
<p>SQL EXPLAIN output analysis can help you optimize slow query execution. You can avoid common bottlenecks in SQL execution by following these guidelines:</p>
<ul>
<li class="">Avoid scanning an entire table.</li>
<li class="">Avoid scanning non-optimal indexes.</li>
<li class="">Avoid suboptimal join ordering or join algorithm.</li>
<li class="">Ensure optimal data colocation for your queries.</li>
</ul>
<p>In the following sections, we will see some common issues with queries and ways to identify and fix them.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="full-scan-instead-of-index-scan">Full Scan Instead of Index Scan<a href="#full-scan-instead-of-index-scan" class="hash-link" aria-label="Direct link to Full Scan Instead of Index Scan" title="Direct link to Full Scan Instead of Index Scan" translate="no">​</a></h2>
<p>Suppose related sql execution flow looks like:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> t </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col1 </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> t_col1_idx </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> t </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> col1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>And possible EXPLAIN output:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       predicate: </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">COL1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _UTF</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">8</span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       fieldNames: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ID</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       est: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">rows</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>For simplicity, here and below, information that is not related to the example is omitted from the EXPLAIN output.</p></div></div>
<p>We can see a full scan (<em>TableScan</em> operator) with predicate. The execution planner chooses which scan implementation (<strong>TableScan</strong> or <strong>IndexScan</strong>) to use. If you expect that index scan is preferable, you can use the <code>FORCE_INDEX</code> hint to manually force <code>IndexScan</code> approach:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*+ FORCE_INDEX(t_col1_idx) */</span><span class="token plain"> id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> t </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> col1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Will show a different plan, like:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   IndexScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain">: T_COL1_IDX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain">: SORTED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       predicate: </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">COL1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _UTF</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">8</span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       searchBounds: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ExactBounds </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">bound</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">_UTF</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">8</span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       fieldNames: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ID</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       collation: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       est: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">rows</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="suboptimal-indexes">Suboptimal Indexes<a href="#suboptimal-indexes" class="hash-link" aria-label="Direct link to Suboptimal Indexes" title="Direct link to Suboptimal Indexes" translate="no">​</a></h2>
<p>Indexes with less prediction can be chosen, for example schema and query may look as follows:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> t </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col1 </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col2 </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> t_col1_col2_idx </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> T</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> t_col1_idx </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> t </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> col1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> col2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>and a possible plan would be:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   IndexScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain">: T_COL1_IDX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>We can see that the execution uses the <strong>T_COL1_IDX</strong> index, through both predicates <strong>COL1 = &#x27;1&#x27; AND COL2 = &#x27;2&#x27;</strong> are involved and the <strong>T_COL1_COL2_IDX</strong> is preferable. In this case, the optimal plan would be:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   IndexScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain">: T_COL1_COL2_IDX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>You can also use the <code>FORCE_INDEX</code> hint to achieve this:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*+ FORCE_INDEX(t_col1_col2_idx) */</span><span class="token plain"> id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> t </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> col1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> col2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="unexpected-sort-operation">Unexpected Sort Operation<a href="#unexpected-sort-operation" class="hash-link" aria-label="Direct link to Unexpected Sort Operation" title="Direct link to Unexpected Sort Operation" translate="no">​</a></h2>
<p>By default, sorted indexes store their entries in ascending order. You can adjust the ordering of a sorted index by including the options ASC or DESC.</p>
<p>Let&#x27;s suppose the schema and related query look like this:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> t1 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col1 </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> t2 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col1 </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> t1_col1_desc_idx </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> t1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col1 </span><span class="token keyword" style="color:#00009f">DESC</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> t2_col1_idx </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> t1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> t1id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> t2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> t2id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> t1 </span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> t2 </span><span class="token keyword" style="color:#00009f">USING</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>And the possible execution plan looks like this:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   MergeJoin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       Sort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           collation: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">COL1 </span><span class="token keyword" style="color:#00009f">ASC</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       IndexScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain">: T2_COL1_IDX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>In the example above, the planner adds the <strong>Sort</strong> operation before performing the <strong>IndexScan</strong>, as the index used is sorted in descending order, while ascending order is required.</p>
<p>Extra <strong>Sort</strong> operations adds performance costs, and we can avoid it by creating an index with the appropriate sort ordering:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> t1_col1_idx </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> t1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>And plan will no longer display the <strong>Sort</strong> operation, improving query execution speed:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   MergeJoin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       IndexScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain">: T1_COL1_IDX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       IndexScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain">: T2_COL1_IDX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-impact-of-correlated-subqueries">Performance Impact of Correlated Subqueries<a href="#performance-impact-of-correlated-subqueries" class="hash-link" aria-label="Direct link to Performance Impact of Correlated Subqueries" title="Direct link to Performance Impact of Correlated Subqueries" translate="no">​</a></h2>
<p>The SQL-99 standard allows for nested subqueries at nearly all places within a query, so Ignite 3 supports nested subqueries, both correlated and not. Performance of certain complex correlated subqueries may be insufficient. Let&#x27;s consider a correlated query:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dept_id </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> salary </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> dept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> dept</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> dept </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dept_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dept</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> emp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">salary </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>We can see nested correlated subquery here, lets check the plan:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   CorrelatedNestedLoopJoin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EMP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           predicate: </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SALARY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ColocatedHashAggregate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             predicate: </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">$cor1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DEPT_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>The example above shows the slow <strong>CorrelatedNestedLoopJoin</strong> operation. Queries with this operation may cause a number of issues:</p>
<ul>
<li class="">Such subqueries may become bottlenecks.</li>
<li class="">Queries can cause high CPU load.</li>
<li class="">Certain queries may perform slower than expected.</li>
</ul>
<p>If performance issues are found in similar queries, it would be more efficient to rewrite the query without nested subqueries, for example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dept</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">salary </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dept_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dept</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>And new plan becomes:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">     HashJoin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         predicate: </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DEPT_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EMP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           predicate: </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SALARY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>Without the <strong>CorrelatedNestedLoopJoin</strong> operation, the query should perform much better than the previous one.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="excessive-sorting">Excessive Sorting<a href="#excessive-sorting" class="hash-link" aria-label="Direct link to Excessive Sorting" title="Direct link to Excessive Sorting" translate="no">​</a></h2>
<p>Let&#x27;s explain we have an index involved two columns one of them is participate in predicate and other in ordering, or in sql terms:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dept_id </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> salary </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> emp_salary_name_idx </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">salary</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> dept_id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> emp </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> salary </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Expectations:</p>
<ul>
<li class="">Index need to be used here.</li>
<li class="">No additional sort is needed because index is ordered by <strong>name</strong> column is satisfies initial query ordering.</li>
</ul>
<p>But the real execution plan shows a different result:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">     Sort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         collation: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">NAME </span><span class="token keyword" style="color:#00009f">ASC</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EMP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           predicate: </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SALARY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>We can see a redundant <strong>Sort</strong> operator. A bit query refactoring can help to avoid excessive sorting:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> dept_id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> emp </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> salary </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> salary</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>And the plan becomes as follows:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">     IndexScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EMP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain">: EMP_SALARY_NAME_IDX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         predicate: </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SALARY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="select-count-optimization">Select Count Optimization<a href="#select-count-optimization" class="hash-link" aria-label="Direct link to Select Count Optimization" title="Direct link to Select Count Optimization" translate="no">​</a></h2>
<p>Some queries can be optimized to use more optimal plans which brings performance speed up. For example, plan for:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">COUNT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Can look like this:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> SelectCount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EMP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     est: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">rows</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">43</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>But there are numerous cases where such optimization is not applicable. In such a cases, a plan can be different and the execution may require more time.</p>
<p>The same query as above, but with explicit transaction may produce a different plan, for example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   ReduceSortAggregate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       MapSortAggregate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EMP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             est: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">rows</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">43</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="index-scan-without-exact-search-bounds">Index Scan Without Exact Search Bounds<a href="#index-scan-without-exact-search-bounds" class="hash-link" aria-label="Direct link to Index Scan Without Exact Search Bounds" title="Direct link to Index Scan Without Exact Search Bounds" translate="no">​</a></h2>
<p>Table scans are available in two implementations: direct table scan and scan through index. Index scans contain predicate and search bounds. Predicate provides final rows comparison. If search bounds are absent, the query degenerates into table scan through index scan (requiring an additional store look up), with further predicate comparison, that incurs additional performance overhead costs.</p>
<p>Let&#x27;s suppose we have schema and query like this:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> t </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col1 </span><span class="token keyword" style="color:#00009f">DECIMAL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> t_col1_idx </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> t </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> col1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">43</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>And possible plan would look like this:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   IndexScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain">: T_COL1_IDX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       predicate: </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CAST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">COL1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><span class="token keyword" style="color:#00009f">DECIMAL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">13</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">43.000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>We can see here only <strong>predicate</strong> (and no <strong>searchBounds</strong>) which means that <strong>all</strong> rows from index will go through predicate and bring additional performance penalty.</p>
<p>Two type of solutions are possible here:</p>
<ul>
<li class="">You can prohibit suboptimal index usage.</li>
<li class="">You can explicitly help the planner with type derivation.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="prohibit-index-usage">Prohibit Index Usage<a href="#prohibit-index-usage" class="hash-link" aria-label="Direct link to Prohibit Index Usage" title="Direct link to Prohibit Index Usage" translate="no">​</a></h3>
<p>For the first approach, use the <strong>NO_INDEX</strong> hint to prohibit index usage:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*+ NO_INDEX */</span><span class="token plain"> id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> t </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> col1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">43</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- or with direct index mention:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*+ NO_INDEX(t_col1_idx) */</span><span class="token plain"> id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> t </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> col1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">43</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>As a result, you will have a plan similar to this:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       predicate: </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CAST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">COL1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><span class="token keyword" style="color:#00009f">DECIMAL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">13</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">43.000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="manual-type-casting">Manual Type Casting<a href="#manual-type-casting" class="hash-link" aria-label="Direct link to Manual Type Casting" title="Direct link to Manual Type Casting" translate="no">​</a></h3>
<p>You can append additional cast to the same query to explicitly cast data as a specific type:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> t </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> col1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">43</span><span class="token plain">::</span><span class="token keyword" style="color:#00009f">DECIMAL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   IndexScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain">: T_COL1_IDX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       predicate: </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">COL1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">43.000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       searchBounds: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ExactBounds </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">bound</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">43.000</span><span class="token plain">:</span><span class="token keyword" style="color:#00009f">DECIMAL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>We can see here both <strong>searchBounds</strong> and <strong>predicate</strong> which means that only exact lookup through index will be involved.</p>
<p>The same case as above but for a bit complicated query:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> t </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> col1 </span><span class="token keyword" style="color:#00009f">INT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> t_col1_asc_idx </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> t </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> t </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> col1::</span><span class="token keyword" style="color:#00009f">varchar</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SUBSTR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">CURRENT_DATE</span><span class="token plain">::</span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Possible plan:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   IndexScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain">: T_COL1_IDX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       predicate: </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CAST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">COL1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CHARACTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;UTF-8&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SUBSTR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CAST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">CURRENT_DATE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CHARACTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;UTF-8&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>And we also can see that no <strong>search bounds</strong> are involved here.</p>
<p>Try to change it like:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> t </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> col1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SUBSTR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">CURRENT_DATE</span><span class="token plain">::</span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">::</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>And the possible plan will become:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   IndexScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain">: T_COL1_ASC_IDX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       predicate: </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">COL1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SUBSTR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CAST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">CURRENT_DATE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CHARACTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;UTF-8&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       searchBounds: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ExactBounds </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">bound</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">CAST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SUBSTR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CAST</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">CURRENT_DATE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CHARACTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;UTF-8&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>We can see that <strong>searchBounds</strong> are present, thus more productive execution flow is expected here.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="colocation-usage">Colocation Usage<a href="#colocation-usage" class="hash-link" aria-label="Direct link to Colocation Usage" title="Direct link to Colocation Usage" translate="no">​</a></h2>
<p>Data colocation eliminates network transfers during joins by ensuring related rows reside on the same node. The EXPLAIN output shows this through Exchange operators.</p>
<!-- -->
<p>Exchange operators indicate data movement between nodes. Fewer Exchange operators mean less network overhead.</p>
<p>For example, if tables are created without colocation consideration:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- by default, the table is implicitly colocated by PRIMARY KEY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dept_id </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> salary </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dept_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- implicitly colocated by PRIMARY KEY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> dept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>And query as follows:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dept</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> emp </span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> dept </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dept_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dept</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">salary </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Bring plan like:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   HashJoin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       predicate: </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DEPT_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EMP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>We can see two <strong>Exchange</strong> operators, which means that all rows are transferred into a single node and then are joined. This execution flow brings a performance cost and slows down query execution.</p>
<p>Let&#x27;s try to improve it by adding explicit colocation for the <strong>dept</strong> table by the <strong>ID</strong> column:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- implicitly colocated by PRIMARY KEY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dept_id </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> salary </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dept_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- explicitly colocated by ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> dept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> COLOCATE </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Now the dependent rows from <strong>emp</strong> table are transferred into the appropriate node where <strong>dept</strong> holds the rows according to <strong>DEPT.ID</strong> distribution:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">     HashJoin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         predicate: </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DEPT_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       Exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           distribution: </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DEPT </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> zone </span><span class="token string" style="color:#e3116c">&quot;Default&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">DEPT_ID</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EMP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>Only one <strong>Exchange</strong> operator for now, which, once again, mean only rows transferring from <strong>emp</strong> table to appropriate <strong>dept</strong> one.</p>
<p>And finally, both join predicate related columns are colocated:</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The following colocation example will only work if the <strong>emp</strong> and <strong>dept</strong> tables belong to the same distribution zone.</p></div></div>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- explicitly colocated by DEPT_ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> emp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dept_id </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> salary </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dept_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> COLOCATE </span><span class="token keyword" style="color:#00009f">BY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dept_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- explicitly colocated by ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> dept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">INTEGER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> COLOCATE </span><span class="token keyword" style="color:#00009f">BY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Now, the <strong>emp</strong> and <strong>dept</strong> tables are both colocated.</p>
<p>And the final plan will look like this:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">     HashJoin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        predicate: </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DEPT_ID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EMP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain">: </span><span class="token keyword" style="color:#00009f">PUBLIC</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>No <strong>Exchange</strong> operators are involved in the explanation, which means that no excessive rows transfer has occurred.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="additional-explain-examples">Additional EXPLAIN Examples<a href="#additional-explain-examples" class="hash-link" aria-label="Direct link to Additional EXPLAIN Examples" title="Direct link to Additional EXPLAIN Examples" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-complex-join-query">Example: Complex Join Query<a href="#example-complex-join-query" class="hash-link" aria-label="Direct link to Example: Complex Join Query" title="Direct link to Example: Complex Join Query" translate="no">​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PLAN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FOR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      U</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UserName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> P</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProductName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> R</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ReviewText</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> R</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Rating</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> Users U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Reviews R</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Products P</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> U</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UserID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> R</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UserID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> R</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProductID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> P</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProductID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> P</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProductName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Product_&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> ?::</span><span class="token keyword" style="color:#00009f">varchar</span><br></span></code></pre></div></div>
<p>The resulting output is:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fieldNames: [USERNAME, PRODUCTNAME, REVIEWTEXT, RATING]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    projection: [USERNAME, PRODUCTNAME, REVIEWTEXT, RATING]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    est: (rows=16650)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  HashJoin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      predicate: =(USERID$0, USERID)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fieldNames: [PRODUCTID, USERID, REVIEWTEXT, RATING, PRODUCTID$0, PRODUCTNAME, USERID$0, USERNAME]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      type: inner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      est: (rows=16650)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HashJoin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        predicate: =(PRODUCTID, PRODUCTID$0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fieldNames: [PRODUCTID, USERID, REVIEWTEXT, RATING, PRODUCTID$0, PRODUCTNAME]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        type: inner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        est: (rows=16650)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          distribution: single</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          est: (rows=50000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            table: PUBLIC.REVIEWS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fieldNames: [PRODUCTID, USERID, REVIEWTEXT, RATING]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            est: (rows=50000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          distribution: single</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          est: (rows=1665)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            table: PUBLIC.PRODUCTS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            predicate: =(PRODUCTNAME, ||(_UTF-8&#x27;Product_&#x27;, CAST(?0):VARCHAR CHARACTER SET &quot;UTF-8&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fieldNames: [PRODUCTID, PRODUCTNAME]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            est: (rows=1665)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Exchange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        distribution: single</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        est: (rows=10000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          table: PUBLIC.USERS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          fieldNames: [USERID, USERNAME]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          est: (rows=10000)</span><br></span></code></pre></div></div>
<p>This execution plan represents a query that joins three tables: <code>USERS</code>, <code>REVIEWS</code>, and <code>PRODUCTS</code>, and selects four fields after filtering by product name.</p>
<ul>
<li class=""><strong>Project</strong> (root node): Outputs the final selected fields (USERNAME, PRODUCTNAME, REVIEWTEXT, and RATING).</li>
<li class=""><strong>HashJoins</strong> (two levels): Perform the inner joins.<!-- -->
<ul>
<li class="">The first (bottom-most) joins REVIEWS with PRODUCTS on PRODUCTID.</li>
<li class="">The second joins the result with USERS on USERID.</li>
</ul>
</li>
<li class=""><strong>TableScans</strong>: Each table is scanned:<!-- -->
<ul>
<li class="">REVIEWS is fully scanned.</li>
<li class="">PRODUCTS is scanned with a filter on PRODUCTNAME.</li>
<li class="">USERS is fully scanned.</li>
</ul>
</li>
<li class=""><strong>Exchange</strong> nodes: Indicate data redistribution between operators.</li>
</ul>
<p>Each node includes:</p>
<ul>
<li class=""><code>fieldNames</code>: Output columns at that stage.</li>
<li class=""><code>predicate</code>: Join or filter condition.</li>
<li class=""><code>est</code>: Estimated number of rows at that point in the plan.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-query-mapping">Example: Query Mapping<a href="#example-query-mapping" class="hash-link" aria-label="Direct link to Example: Query Mapping" title="Direct link to Example: Query Mapping" translate="no">​</a></h3>
<p>A result of EXPLAIN MAPPING command includes additional metadata providing insight at how the query is mapped on cluster topology. So, for the command like below:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">EXPLAIN</span><span class="token plain"> MAPPING </span><span class="token keyword" style="color:#00009f">FOR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      U</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UserName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> P</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProductName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> R</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ReviewText</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> R</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Rating</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> Users U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Reviews R</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Products P</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> U</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UserID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> R</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UserID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> R</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProductID </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> P</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProductID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> P</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProductName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Product_&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> ?::</span><span class="token keyword" style="color:#00009f">varchar</span><br></span></code></pre></div></div>
<p>The resulting output is:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Fragment#0 root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  distribution: single</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  executionNodes: [node_1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tree:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fieldNames: [USERNAME, PRODUCTNAME, REVIEWTEXT, RATING]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        projection: [USERNAME, PRODUCTNAME, REVIEWTEXT, RATING]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        est: (rows=1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      HashJoin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          predicate: =(USERID$0, USERID)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          fieldNames: [PRODUCTID, USERID, REVIEWTEXT, RATING, PRODUCTID$0, PRODUCTNAME, USERID$0, USERNAME]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          type: inner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          est: (rows=1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HashJoin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            predicate: =(PRODUCTID, PRODUCTID$0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fieldNames: [PRODUCTID, USERID, REVIEWTEXT, RATING, PRODUCTID$0, PRODUCTNAME]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            type: inner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            est: (rows=1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Receiver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              fieldNames: [PRODUCTID, USERID, REVIEWTEXT, RATING]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sourceFragmentId: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              est: (rows=1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Receiver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              fieldNames: [PRODUCTID, PRODUCTNAME]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sourceFragmentId: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              est: (rows=1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Receiver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fieldNames: [USERID, USERNAME]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sourceFragmentId: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            est: (rows=1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fragment#1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  distribution: random</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  executionNodes: [node_1, node_2, node_3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  partitions: [REVIEWS=[node_1={0, 2, 5, 6, 7, 8, 9, 10, 12, 13, 20}, node_2={1, 3, 11, 19, 21, 22, 23, 24}, node_3={4, 14, 15, 16, 17, 18}]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tree:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Sender</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        distribution: single</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        targetFragmentId: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        est: (rows=50000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          table: PUBLIC.REVIEWS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          fieldNames: [PRODUCTID, USERID, REVIEWTEXT, RATING]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          est: (rows=50000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fragment#2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  distribution: table PUBLIC.PRODUCTS in zone &quot;Default&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  executionNodes: [node_1, node_2, node_3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  partitions: [PRODUCTS=[node_1={0, 2, 5, 6, 7, 8, 9, 10, 12, 13, 20}, node_2={1, 3, 11, 19, 21, 22, 23, 24}, node_3={4, 14, 15, 16, 17, 18}]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tree:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Sender</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        distribution: single</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        targetFragmentId: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        est: (rows=1665)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          table: PUBLIC.PRODUCTS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          predicate: =(PRODUCTNAME, ||(_UTF-8&#x27;Product_&#x27;, CAST(?0):VARCHAR CHARACTER SET &quot;UTF-8&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          fieldNames: [PRODUCTID, PRODUCTNAME]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          est: (rows=1665)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fragment#3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  distribution: table PUBLIC.USERS in zone &quot;Default&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  executionNodes: [node_1, node_2, node_3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  partitions: [USERS=[node_1={0, 2, 5, 6, 7, 8, 9, 10, 12, 13, 20}, node_2={1, 3, 11, 19, 21, 22, 23, 24}, node_3={4, 14, 15, 16, 17, 18}]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tree:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Sender</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        distribution: single</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        targetFragmentId: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        est: (rows=10000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      TableScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          table: PUBLIC.USERS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          fieldNames: [USERID, USERNAME]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          est: (rows=10000)</span><br></span></code></pre></div></div>
<p>Where:</p>
<ul>
<li class=""><strong>Fragment#0</strong> means fragment with id=0</li>
<li class="">A <strong>root</strong> marks a fragment which is considered as root fragment, i.e. a fragment which represents user&#x27;s cursor</li>
<li class="">A <strong>distribution</strong> attribute provides an insight into which mapping strategy was applied to this particular fragment</li>
<li class="">A <strong>executionNodes</strong> attribute provides a list of nodes this fragment will be executed on</li>
<li class="">A <strong>partitions</strong> attribute provides an insight into which partitions of which tables will be read from which nodes</li>
<li class="">A <strong>tree</strong> attribute specifies which part of the relational tree corresponds to this fragment</li>
</ul>
<p>The output above shows how the query is broken into multiple execution fragments and distributed across the cluster. It gives insight into both the logical execution plan and how it maps to the physical topology.</p>
<p>The query starts execution in <em>Fragment#0</em>, which serves as the root of the plan (this is where the final result is produced). It runs on a single node (<code>node_1</code>) and contains the main logic of the query, including the projection and two nested hash joins. Instead of scanning tables directly, it receives data from other fragments through <code>Receiver</code> operators. These incoming streams correspond to the <code>REVIEWS</code>, <code>PRODUCTS</code>, and <code>USERS</code> tables.</p>
<p>The actual table scans happen in <em>Fragments 1 through 3</em>, each responsible for one of the involved tables. These fragments operate in parallel across the cluster. Each performs a scan on its respective table and then sends the results back to Fragment#0.</p>
<ul>
<li class=""><em>Fragment#1</em> handles the <code>REVIEWS</code> table. It runs on all nodes and uses a random distribution strategy. Data is partitioned across nodes, and after scanning the table, results are sent upstream.</li>
<li class=""><em>Fragment#2</em> is in charge of the <code>PRODUCTS</code> table. It also spans all nodes but follows a zone-based distribution linked to the table&#x27;s partitioning. There&#x27;s a filter applied to <code>PRODUCTNAME</code>, which limits the amount of data sent to the root.</li>
<li class=""><em>Fragment#3</em> covers the <code>USERS</code> table. Like the others, it&#x27;s distributed and reads from table partitions spread across the cluster.</li>
</ul>
<p>Each fragment includes metadata such as the nodes it&#x27;s executed on, how data is partitioned, and how results are sent between fragments. This layout provides a clear view of not only how the query is logically processed, but also how the workload is split and coordinated in a distributed environment.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/ignite3/3.1.0/understand/performance"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Performance</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/ignite3/3.1.0/understand/performance/explain-operators"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">EXPLAIN Operators Reference</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#explain-command-syntax" class="table-of-contents__link toc-highlight">EXPLAIN Command Syntax</a></li><li><a href="#understanding-the-output" class="table-of-contents__link toc-highlight">Understanding The Output</a><ul><li><a href="#operator-categories" class="table-of-contents__link toc-highlight">Operator Categories</a></li><li><a href="#plan-structure" class="table-of-contents__link toc-highlight">Plan Structure</a></li></ul></li><li><a href="#common-query-optimization-issues" class="table-of-contents__link toc-highlight">Common Query Optimization Issues</a></li><li><a href="#full-scan-instead-of-index-scan" class="table-of-contents__link toc-highlight">Full Scan Instead of Index Scan</a></li><li><a href="#suboptimal-indexes" class="table-of-contents__link toc-highlight">Suboptimal Indexes</a></li><li><a href="#unexpected-sort-operation" class="table-of-contents__link toc-highlight">Unexpected Sort Operation</a></li><li><a href="#performance-impact-of-correlated-subqueries" class="table-of-contents__link toc-highlight">Performance Impact of Correlated Subqueries</a></li><li><a href="#excessive-sorting" class="table-of-contents__link toc-highlight">Excessive Sorting</a></li><li><a href="#select-count-optimization" class="table-of-contents__link toc-highlight">Select Count Optimization</a></li><li><a href="#index-scan-without-exact-search-bounds" class="table-of-contents__link toc-highlight">Index Scan Without Exact Search Bounds</a><ul><li><a href="#prohibit-index-usage" class="table-of-contents__link toc-highlight">Prohibit Index Usage</a></li><li><a href="#manual-type-casting" class="table-of-contents__link toc-highlight">Manual Type Casting</a></li></ul></li><li><a href="#colocation-usage" class="table-of-contents__link toc-highlight">Colocation Usage</a></li><li><a href="#additional-explain-examples" class="table-of-contents__link toc-highlight">Additional EXPLAIN Examples</a><ul><li><a href="#example-complex-join-query" class="table-of-contents__link toc-highlight">Example: Complex Join Query</a></li><li><a href="#example-query-mapping" class="table-of-contents__link toc-highlight">Example: Query Mapping</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/ignite3/3.1.0">Apache Ignite 3</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://ignite.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Apache Ignite<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://ignite.apache.org/community.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">User Mailing List<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Apache Software Foundation</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Apache Software Foundation<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/apache/ignite-3" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 The Apache Software Foundation. Licensed under the Apache License, Version 2.0.</div></div></div></footer></div>
</body>
</html>